<!DOCTYPE html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link href="../Styles/MyEBookStylesheet.css" rel="stylesheet" type="text/css" /></head><body>
<h1 id="willkommen">Willkommen</h1>
<p>Das Arbeiten mit Geodaten und digitalen Landkarten hat durch das 
<a href="https://de.wikipedia.org/w/index.php?title=Global_Positioning_System&amp;oldid=183579881"><strong>g</strong>lobale <strong>P</strong>ositionsbestimmung<strong>s</strong>system GPS</a><sup id="fnref1:1"><a href="#fn%3A1" class="footnote-ref">1</a></sup> 
immer mehr an Relevanz gewonnen. 
Viele Anwendungen bieten heute sogar online geografische Informationen in Echtzeit an. 
So finden Sie auch im Internet immer mehr digitale Karten und Anwendungen 
die mit Geodaten arbeiten.</p>
<blockquote>
<p><a href="https://de.wikipedia.org/w/index.php?title=Geodaten&amp;oldid=181076558">Geodaten</a> 
sind Informationen, die eine Zuordnung zu einer räumlichen Lage besitzen. 
90 % aller Daten können einem Ort zugeordnet werden und sind somit Geodaten.</p>
</blockquote>
<p>Sie lesen dieses Buch sicherlich, weil Sie mit dem Gedanken spielen eine digitale Karte 
anzubieten - höchstwahrscheinlich auf einer Website. Die Grundlagen zu dem, 
was ich in diesem Buch geschrieben habe, finden Sie alle in der 
<a href="https://leafletjs.com/reference">Dokumentation zu Leaflet</a> - oder zu den 
jeweiligen Plugins - öffentlich im Internet. 
Diese Dokumentationen habe ich hier im Buch verlinkt. Warum habe ich trotzdem 
dieses Buch geschrieben?  </p>
<p>Ich habe das Buch geschrieben, 
weil ich manchmal gerne mit Beispielen lerne. Oft komme ich hierbei auf Ideen, 
die trockene Dokumentationen nicht hergeben. Vielleicht geht es Ihnen ja auch 
so und dieses Buch bringt Ihnen einen Mehrwert zu den vorhandenen Dokumentationen. 
Die Quellcode-Dateien zu den im Buch verwendeten Beispielen finden Sie auf der 
Website <a href="https://astrid-guenther.de">https://astrid-guenther.de</a>.</p>
<p>Außerdem finde ich es immer sehr hilfreich, wenn ich ein bisschen über den 
Tellerrand hinaus blicke. Hier im Buch finden Sie ein paar solcher Blicke. 
Wenn es Sie interessiert, können Sie mit mir etwas tiefer in die Welt der 
geografische Koordinaten blicken. Ich erkläre Ihnen auch die unterschiedlichen 
Techniken beim Erstellen der Grafiken für die digitalen Karten. 
Außerdem sehe ich mir mit Ihnen GeoJSON, über die reine Anwendung hinaus, 
etwas genauer an. Ich zeigen Ihnen wie Sie der Karte mit individuellen Markern 
eine persönliche Note geben können. Neben diesen grundlegenden Elementen kommen 
die Visualisierung der Daten mit Heatmaps, Geocoding und Routing nicht zu kurz.</p>
<h2 id="wichtiges-zum-buch">Wichtiges zum Buch</h2>
<p>Ich erkläre Ihnen hier Schritt für Schritt alles das, was ich rund um Leaflet 
als wichtig ansehe – also alles das, was Sie als Entwickler brauchen, um kreativ 
arbeiten zu können.</p>
<p>Ich hoffe, dass Ihnen meine Art zu schreiben gefällt. Ich persönlich hätte mir 
genau dieses Buch zum Start mit Leaflet gewünscht.</p>
<h2 id="was-ist-leaflet">Was ist Leaflet?</h2>
<p><a href="https://leafletjs.com/reference">Leaflet</a> ist eine 
Open Source <a href="https://de.wikipedia.org/w/index.php?title=JavaScript_Object_Notation&amp;oldid=183718070">JavaScript</a>-Bibliothek, 
die Ihnen das 
Bereitstellen von Karten auf Ihrer Webseite einfach macht. 
<a href="https://www.bsi-fuer-buerger.de/BSIFB/DE/Empfehlungen/EinrichtungSoftware/OpenSource/OpenSource.html">Open Source</a> 
bedeutet unter anderem, dass der Programmcode einsehbar ist. 
Jeder mit den notwendigen Kenntnissen kann prüfen, wie die Anwendung genau 
funktioniert. Und was noch wichtiger ist: Jeder kann Leaflet verwenden, 
an seine Bedürfnisse anpassen und verbessern.</p>
<p>Was müssen Sie tun, wenn Sie Leaflet auf Ihrer Website einsetzen möchten? 
Im Grunde genommen müssen Sie nur zwei Dateien – eine JavaScript Datei und die 
dazugehörige CSS-Datei einbinden. Wie Sie das genau machen erkläre ich Ihnen 
im Kapitel <a href="../eine-erste-karte/wir-beginnen-mit-einer-einfachen-karte#IntegrierenSiedienotwendigenJavaScriptundCascadingStyleSheet">Integrieren Sie die notwendigen JavaScript und Cascading Style Sheet 
(CSS) Dateien</a> 
ganz genau.</p>
<p>Das Einbinden der Dateien bietet Ihnen den Zugriff auf eine Reihe von Funktionen. Mithilfe dieser Funktionen können sie unkompliziert eine digitale Karte auf Ihrer Website integrieren. Leaflet unterstützt alle modernen Browser – auch die mobilen Versionen. Das bedeute, dass Sie Ihre Karte so ziemlich überall einsetzen können.</p>
<p>Leaflet selbst legt den Schwerpunkt auf die einfache Bedienbarkeit und die Performance. Außerdem ist es den Entwicklern von Leaflet wichtig, dass die JavaScript Bibliothek unkompliziert von anderen Entwicklern mit einem Plugin erweitert werden kann. Die Programmierschnittstelle ist sehr gut dokumentiert. Als Erweiterungsprogrammierer muss man keine Geheimnisse lüften, um Leaflet erfolgreich mit einem Plugin zu erweitern. Dies ist meiner Meinung nach eine der bedeutendsten Stärken von Leaflet.</p>
<p>Viele namhafte Unternehmen setzten Leaflet ein. 
Darunter sind Namen wie </p>
<ul>
<li><a href="https://www.flickr.com">Flickr</a>, </li>
<li><a href="https://github.com/">Github</a>, </li>
<li><a href="https://www.pinterest.com/">Pinterest</a>, </li>
<li><a href="https://www.wikimedia.de/">Wikimedia</a> und </li>
<li><a href="http://www.spiegel.de/">Spiegel</a>.</li>
</ul>
<p>Out-of-the-box können Sie mit Leaflet Marker, Popups, Linien und Formen auf 
unterschiedlichen Ebenen auf Ihrer Karte anzeigen. 
Sie können Zoomen, Entfernungen berechnen und das Zentrum der Karte zu 
bestimmten Koordinaten schieben.</p>
<h2 id="was-sollten-sie-mitbringen">Was sollten Sie mitbringen?</h2>
<p>Ich gehe davon aus, dass Sie über grundlegende <a href="https://de.wikipedia.org/w/index.php?title=HTML5&amp;oldid=182888530">HTML</a> 
und <a href="https://de.wikipedia.org/w/index.php?title=Cascading_Style_Sheets&amp;oldid=181828388">CSS</a> 
Kenntnisse verfügen. 
Sie sollten auf alle Fälle wissen, wie Sie CSS und ein 
<a href="https://de.wikipedia.org/w/index.php?title=JavaScript_Object_Notation&amp;oldid=183718070">JavaScript</a>-Skript 
in ein HTML-Dokument einbinden und wie Sie mit einfachen HTML-Elementen 
arbeiten. </p>
<blockquote>
<p><a href="http://www.w3.org/Style/CSS/">CSS</a>
ist eine Stylesheet-Sprache für digitale Dokumente. Stylesheet-Sprachen werden
verwendet, um Dokumente und Benutzeroberflächen zu gestalten. Dabei ist ein
Stylesheet mit einer <a href="https://de.wikipedia.org/wiki/Formatvorlage">Formatvorlage</a> zu
vergleichen. Grundidee hierbei ist die Trennung von Dateninhalten und Design.
Zusammen mit HTML und dem <a href="https://wiki.selfhtml.org/wiki/JavaScript/DOM">DOM</a> ist CSS
eines der wichtigsten Elemente im Internet. CSS ist ein so genannter lebendiger 
Standard und wird vom <a href="https://www.w3.org/">W3C</a> und dem <a href="https://whatwg.org/">WHATWG</a> permanent 
weiterentwickelt.  </p>
</blockquote>
<p>. </p>
<blockquote>
<p><a href="https://de.wikipedia.org/w/index.php?title=HTML5&amp;oldid=182888530">HTML</a> 
ist eine textbasierte Auszeichnungssprache zur Strukturierung digitaler 
Dokumente wie Texte mit Hyperlinks, Bildern und anderen Inhalten. HTML-Dokumente 
sind die Grundlage des World Wide Web und werden von Webbrowsern dargestellt.</p>
</blockquote>
<p>Für das Verständnis der Beispiele sind darüber hinaus grundlegende <a href="https://de.wikipedia.org/w/index.php?title=JavaScript_Object_Notation&amp;oldid=183718070">JavaScript</a> 
Kenntnisse hilfreich. Für die Entwicklung dynamischer Webseiten ist JavaScript unerlässlich. </p>
<blockquote>
<p>Mit <a href="https://de.wikipedia.org/w/index.php?title=JavaScript_Object_Notation&amp;oldid=183718070">JavaScript</a> 
lassen sich kleine Hilfsroutinen und auch komplexen Bibliotheken schreiben. </p>
</blockquote>
<h2 id="die-autorin">Die Autorin</h2>
<p>Ich habe über 30 Jahre im öffentlichen Dienst gearbeitet. Die meiste Zeit 
als Systemadministratorin in einer Bank.  </p>
<p>In dieser Zeit habe ich nebenberuflich das Abitur nachgeholt und im 
Anschluss ein Studium mit dem Abschluss Master of Computer Science bei der 
Fernuni Hagen abgeschlossen.  </p>
<p>Heute arbeite ich freiberuflich unter anderem mit Leaflet, lebe mit 
meinem Mann, meiner Tochter, meinem Hund und meiner Katze in einem kleinen Dorf 
in der Eifel.  </p>
<p>Fragen zum Buch, konstruktive Kritik, Anregungen und Hinweise auf Tippfehler können 
gerne per E-Mail an die E-Mail-Adresse 
<a href="mailto:info@astrid-guenther.de">info@astrid-guenther.de</a> gesandt werden.</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn:1">
<p><a href="https://de.wikipedia.org/w/index.php?title=Global_Positioning_System&amp;oldid=183579881">https://de.wikipedia.org/w/index.php?title=Global_Positioning_System&amp;oldid=183579881</a> (<a href="https://bit.ly/2Rko7MC">https://bit.ly/2Rko7MC</a>) &#160;<a href="#fnref1%3A1" rev="footnote" class="footnote-backref">&#8617;</a></p>
</li>
</ol>
</div><h1 id="eine-karte-mit-leaflet-erstellen">Eine Karte mit Leaflet erstellen</h1>
<p><a href="#" id="EineKarteMitLeafletErstellen"></a></p>
<p>Zunächst zeige ich Ihnen, wie Sie in vier einfachen Schritten eine 
<em>digitale Karte</em> mit Leaflet in ein HTML Dokument einbinden.  </p>
<p>Mit Leaflet müssen Sie dafür nicht wissen, was geografische Koordinaten sind 
und wie die Bilddateien für die Karten erstellt werden. Da dies aber als Hintergrundwissen bei einer eventuellen Fehlersuche hilfreich sein kann, 
habe ich einen Theorie-Teil in dieses Kapitel eingefügt. 
Hier erkläre ich Ihnen alles Wichtige zum Thema 
geografische Koordinaten und die übliche 
Vorgehensweise beim Erstellen und Zuordnen der Imagedateien für diese Karten – 
die <em>Kachel-Technik</em>. Zum Abschluss lernen Sie dann noch eine Alternative zur 
Kachel-Technik kennen, den <em>Web-Map-Service</em>.</p>
<h2 id="wir-beginnen-mit-einer-einfachen-karte">Wir beginnen mit einer einfachen Karte</h2>
<p>Um eine Karte mit Leaflet auf einer Internetseite anzuzeigen, 
reichen wenige Schritte aus:</p>
<ol>
<li>Integrieren Sie die notwendigen JavaScript und Cascading Style Sheet Dateien (CSS). </li>
<li>Erstellen Sie ein HTML-Element – üblicherweise ein <code>&lt;div&gt;</code>-Element – in dem Ihre Karte angezeigt werden soll. </li>
<li>Erstellen Sie das JavaScript Karten-Objekt. </li>
<li>Fügen Sie eine Schicht mit Kacheln – einen Tile-Layer – zum Karten-Objekt hinzu. </li>
</ol>
<p>Noch vor Schritt 1 erstellen wir eine einfache HTML-Datei. 
Diese Datei ist die Grundlage für die Beispiele hier im Buch. 
Den Programmcode für die einfache HTML-Datei sehen Sie im nachfolgenden 
Programmcodebeispiel. Fügen Sie diesen Programmcode in eine Datei ein und 
speichern diese Datei ab.</p>
<pre><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="utf-8"/&gt;
&lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;!--999.html--&gt;</code></pre>
<p>Ein Aufruf dieser Datei in Ihrem Browser öffnet zunächst nur ein 
leeres Browser-Fenster. Nur der Titel der Seite ist in der Titelleiste des 
Browsers abzulesen. In den nächsten vier Kapiteln erfahren Sie, wie Sie die 
digitale Landkarte in das Fenster bekommen. Vier Kapitel hört sich aufwendig 
an. Das ist es aber nicht. Fangen Sie an und Sie werden sehen, dass Sie schon 
in wenigen Minuten die Karte präsentieren können.</p>
<p><a href="#" id="IntegrierenSiedienotwendigenJavaScriptundCascadingStyleSheet"></a></p>
<h3 id="integrieren-sie-die-notwendigen-javascript-und-cascading-sty">Integrieren Sie die notwendigen JavaScript und Cascading Style Sheet Dateien</h3>
<p>Sie haben zwei Möglichkeiten die notwendigen Dateien in Ihr HTML-Dokument zu integrieren.</p>
<ol>
<li>Binden Sie die Dateien über ein CDN in Ihr HTML-Dokument ein. </li>
<li>Kopieren Sie die Dateien und binden Sie die lokale Kopie in Ihr HTML-Dokument ein. </li>
</ol>
<blockquote>
<p>Ein <a href="https://de.wikipedia.org/wiki/Content_Delivery_Network">Content Delivery Network</a> 
oder Content <em>Distribution</em> Network (CDN) ist ein
Netz von Servern, das über das Internet verbundenen ist. Die
Server in diesem Netzwerk bieten Inhalte zum Download an.</p>
</blockquote>
<h4 id="leaflet-uber-ein-content-delivery-network-einbinden">Leaflet über ein Content Delivery Network einbinden</h4>
<p>Sie können Leaflet mithilfe eines CDN nutzen. So müssen Sie die Dateien 
nicht selbst herunterladen. Es ist lediglich eine Verlinkung nötig. 
Mit der richtigen Verlinkung wird Leaflet automatisch über das CDN heruntergeladen, 
wenn ein Website Besucher Ihre Website aufruft. Im nachfolgenden Programmcodebeispiel 
sehen Sie den Text für die Verlinkung zur Leaflet-Version 1.2.0. Den 
relevanten Teil habe ich mit Sternen markiert.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
* &lt;link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" /&gt;
* &lt;script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_998.html--&gt;</code></pre>
<blockquote>
<p>Welche Leaflet-Versionen Ihnen über das CDN zur Verfügung stehen, können
Sie jederzeit unter der Adresse <a href="http://leafletjs.com/download.html">http://leafletjs.com/download.html</a>
nachlesen.</p>
</blockquote>
<p>Auch wenn die Dateien der Leaflet Bibliothek nun automatisch über das CDN heruntergeladen werden: 
Ein Aufruf Ihrer Datei in Ihrem Browser öffnet immer noch ein leeres Browser-Fenster. 
Erst im letzten Schritt, im Kapitel <em><a href="#FuegenSieEineSchichtMitKachelnHinzu">Fügen Sie eine Schicht mit Kacheln – einen Tile-Layer – zum Karten-Objekt hinzu</a>,</em> wird die Karte sichtbar.</p>
<blockquote>
<p>Fast alle modernen Browser unterstützen <a href="https://en.wikipedia.org/w/index.php?title=Subresource_Integrity&amp;oldid=839480720">Subresource Integrity (SRI)</a> 
und auch 
Leaflet verwendet diese
Sicherheitsfunktion. SRI steht für die Überprüfung der Integrität
von Dateien die im Internet verwendet werden. Mithilfe dieser
Funktion können Sie sich davor schützen, dass nachträglich veränderte Dateien auf Ihrem
Server ausgeführt werden. Die Dateien könnten beispielsweise bei der Übertragung im Internet verändert werden. Wenn Sie SRI nutzen, erhalten Sie immer exakt die Version, die
Ihnen auch ausgeliefert werden sollte – oder eine
Fehlermeldung. Dabei wird auf eine Prüfsumme – also einen
Hash-Wert – zurückgegriffen. Diese Prüfsumme macht die Datei eindeutig erkennbar. Um potenzielle Sicherheitsprobleme zu vermeiden, empfehle ich
Ihnen SRI zu nutzen, wenn Sie Leaflet über ein CDN einbinden. Informationen dazu, wie 
Sie dies genau handhaben, finden Sie unter der 
Adresse <a href="http://leafletjs.com/download.html">http://leafletjs.com/download.html</a> .</p>
</blockquote>
<h4 id="eine-lokale-leaflet-kopie-einbinden">Eine lokale Leaflet-Kopie einbinden</h4>
<p><a href="#" id="EineKarteMitLeafletErstellenEinelokaleLeafletKopieeinbinden"></a></p>
<p>Eine zweite – vielleicht etwas kompliziertere – Möglichkeit ist, die 
Leaflet-Dateien selbst herunterzuladen. Die aktuellen Versionen finden Sie unter 
der Adresse <a href="http://leafletjs.com/download.html">http://leafletjs.com/download.html</a> . Diese müssen Sie anschließend auf 
dem eigenen Server verfügbar machen und in Ihre Website einbinden.<br />
Diese Variante hat den <em>Vorteil</em>, dass Sie nicht von einem CDN Server abhängig sind. 
Somit haben Sie mehr Sicherheit. Sie wissen genau, welche Datei Sie auf Ihrem Server 
abgelegt haben und haben Einfluss auf die Konfiguration Ihres Servers.<br />
<em>Nachteilig</em> ist dabei allerdings, dass Sie sich selbst um alles kümmern müssen. 
Sie müssen selbst die Dateien kopieren und sicherstellen, dass Sie die passende 
Version von Leaflet nutzen. Aktualisierungen müssen Sie selbst vornehmen.</p>
<p>Im nachfolgenden Codebeispiel sehen Sie – die relevanten Stellen mit einem Stern 
markiert – das Einbinden von 
Leaflet unter der Annahme, dass Sie die heruntergeladenen Dateien - relativ 
zu Ihrem HTML-Dokument ein Verzeichnis höher - im Unterverzeichnis <code>/leaflet</code> auf 
Ihrem Webserver abgelegt haben.</p>
<blockquote>
<p>Wenn Sie mit 
<a href="https://de.wikipedia.org/w/index.php?title=Pfadname&amp;oldid=182767239">relativen Pfadangaben</a> 
arbeiten, 
setzen Sie die Links innerhalb eines
Projektes mit Hilfe von Punkten. Der große Vorteil von relativen
Pfadangaben ist, dass Sie ein Projekt jederzeit in ein anderes
Verzeichnis kopieren können ohne Pfadangaben korrigieren zu müssen.
Bei einer relativen Pfadangabe bedeuten die Punkte folgendes:<br />
Ein Punkt gefolgt von einem Schrägstrich (<code>./datei.html</code>) zeigt auf
eine Datei, die sich im gleichen Verzeichnis befindet.<br />
Zwei Punkte gefolgt von einem Schrägstrich (<code>../datei.html</code>)
zeigen auf eine Datei, die sich ein Verzeichnis höher
befindet.<br />
Zweimal zwei Punkte gefolgt von einem Schrägstrich
hintereinander (<code>../../datei.html</code>) 
zeigen auf eine Datei, die sich zwei Verzeichnisse höher befindet.<br />
Wenn Ihnen meine Erklärung 
nicht hilfreich erscheint sehen sich doch einfach alles im nächsten Beispiel an. 
Manchmal sagt ein Beispiel mehr als viele Worte. 
Nach meiner Erfahrung wird bei der praktischen Anwendung 
Vieles oft sehr schnell klarer.</p>
</blockquote>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
*&lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
*&lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;/body&gt;
 &lt;/html&gt;  
&lt;!--index_998a.html--&gt;</code></pre>
<p>Auch wenn Leaflet nun lokal geladen wird, zeigt ein Aufruf dieser Datei in Ihrem Browser 
immer noch ein leeres Browser-Fenster. Erst im letzten Schritt - 
im Kapitel <em><a href="#FuegenSieEineSchichtMitKachelnHinzu">Fügen Sie eine Schicht mit Kacheln – einen Tile-Layer – zum Karten-Objekt hinzu</a></em>  wird die Karte sichtbar.</p>
<blockquote>
<p>Vielleicht fragen Sie sich, warum ich den Link zur CSS-Datei mithilfe 
eines selbst-schließenden Tags – also einem <em>unary</em> Tag – geschrieben habe, 
aber für das Tag, in dem das Skript eingebunden wird, zwei separate 
Tags – also ein <em>binary</em>
Tag – verwendet habe.<br />
<strong><code>&lt;link</code></strong> <code>rel="stylesheet" href="../leaflet/leaflet.css"</code><strong><code>/&gt;</code></strong><br />
<strong><code>&lt;script</code></strong><code>src="../leaflet/leaflet.js"</code><strong><code>&gt;&lt;/script&gt;</code></strong><br />
<a href="https://de.wikipedia.org/w/index.php?title=Hilfe:Tags&amp;oldid=181586744#Syntax">HTML unterscheidet</a> 
zwischen Tags, die nie
Inhalt enthalten können – nämlich den <em>void</em>-Tags –, und
solchen, die prinzipiell Inhalt enthalten können. Im ersten Fall
muss ein selbst-schließendes <em>unary</em> Tag verwendet werden.
Hierzu gehört das &lt;link&gt;-Tag. Seit HTML5 kann sogar der abschließende Schrägstrich 
entfallen - muss aber nicht.
Im zweiten Fall darf kein selbst-schließendes <em>unary</em> Tag
benutzt werden – auch dann nicht, wenn das Tag tatsächlich leer
ist. Hierzu gehört das &lt;script&gt;-Tag.</p>
</blockquote>
<h4 id="leaflet-performant-einbinden-defer-oder-async">Leaflet performant einbinden – defer oder async</h4>
<p>In diesem Kapitel erkläre ich Ihnen, wie Sie Leaflet in Ihre Website einbinden 
können, ohne den Ladeprozess der Webseite zu unterbrechen. Falls Sie noch unsicher 
in der Anwendung von JavaScript sind und dieses Kapitel Sie eher verwirrt, 
dann dürfen sie es überspringen. Das Beachten der Performance können 
Sie auch erst angehen, 
wenn Sie die ersten Karten selbst erstellt haben. Lesen Sie in diesem Falle einfach 
im Kapitel <a href="#EineKarteMitLeafletErstellenErstellenSieeinElementindemIhreKarteangezeigtwerdensoll">Erstellen Sie ein Element in dem Ihre Karte angezeigt werden soll</a> 
weiter.</p>
<h5 id="was-passiert-genau-wenn-eine-website-geladen-wird-die-im-kop">Was passiert genau, wenn eine Website geladen wird die im Kopfbereich ein Skript einbindet?</h5>
<p>Sehen wir uns zunächst einmal an, was genau passiert, wenn ein Browser eine 
Website mit einem <code>&lt;script&gt;</code>-Tag lädt.</p>
<ol>
<li>Als erstes lädt der Browser den Text der HTML-Seite. </li>
<li>Als nächstes beginnt er, den HTML-Code zu analysieren, also zu parsen. </li>
<li>Nun trifft der Parser auf das <code>&lt;script&gt;</code>-Tag, welches auf eine externe Skript-Datei verweist. </li>
<li>Der Browser fordert die Skript-Datei an. Einstweilen blockiert und stoppt der Parser seine Arbeit. </li>
<li>Je nach Größe der Datei ist das Skript nach einiger Zeit vollständig heruntergeladen und wird anschließend ausgeführt. </li>
<li>Nun endlich kann der Parser seine Arbeit fortsetzten und den Rest des 
HTML-Dokuments analysieren und am Ende im Browser anzeigen. </li>
</ol>
<p>Wenn Sie sich diese Abfolge ansehen, können Sie sich vorstellen, dass Punkt vier 
das performante Laden der Website negativ beeinflusst. Der Ladevorgang der Website 
macht praktisch eine Pause. Solange bis alle Skripte heruntergeladen sind, passiert 
nichts mehr. Und wenn es eine Sache gibt, die Website-Besucher und Suchmaschinen nicht 
mögen, dann ist dies die Wartezeit beim Aufbau der Website.</p>
<h5 id="wie-konnen-sie-die-ladezeit-positiv-beeinflussen">Wie können Sie die Ladezeit positiv beeinflussen?</h5>
<p>Um das im vorherigen Abschnitt beschriebene Problem zu umgehen wurde früher oft 
empfohlen, den JavaScript-Code möglichst nah am schließenden 
<code>&lt;body&gt;</code>-Tag in die Website zu integrieren. Zu dieser Empfehlung gibt 
es mit HTML5 zwei gute Alternativen – nämlich die Attribute 
<a href="https://wiki.selfhtml.org/index.php?title=Referenz:HTML/Attribute/defer&amp;oldid=27295"><code>defer</code></a> 
und 
<a href="https://wiki.selfhtml.org/index.php?title=Referenz:HTML/Attribute/async&amp;oldid=27294"><code>async</code></a>.</p>
<p>Sofern Sie das Attribut <code>defer</code> verwenden, wird das Skript ausgeführt, 
wenn das HTML-Dokument geladen und für die Ansicht umgewandelt - also geparst - ist. 
Zum anderen können Sie das Attribut <code>async</code> 
einsetzten. Mit <code>async</code> wird Ihr Skript asynchron mit dem HTML-Dokument ausgeführt. 
Wenn Sie keines dieser Attribute explizit angegeben, wird erst das vollständige 
Skript geladen und ausgeführt und erst dann wird das Laden und Parsen des 
HTML-Dokuments fortgesetzt.</p>
<h5 id="was-sollten-sie-beim-einsatz-von-defer-oder-async-mit-leafle">Was sollten Sie beim Einsatz von defer oder async mit Leaflet beachten?</h5>
<p>Wenn Sie Ihre Karte auf Ihrer Website anzeigen, werden Sie nicht nur das 
Leaflet-Skript laden. Sie werden später noch eigenen JavaSript-Code schreiben. 
Dieser eigene Code setzt das Laden des Leaflet-Skripts voraus. 
Aus diesem Grund müssen Sie sicherstellen, dass die Leaflet Bibliothek vollständig 
geladen ist, bevor Ihr eigener Code ausgeführt wird. Dies können Sie mithilfe 
des <em>Eventhandlers</em>: <code>load</code>.  </p>
<p>Obwohl Ihr eigenes Skript voraussetzt, dass Leaflet vollständig geladen ist, 
können Sie das Attribut <code>async</code> verwenden. Sehen Sie selbst: Das folgende einfache 
Beispiel zeigt es Ihnen.</p>
<pre><code> &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" 
 href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" /&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div id="map" style="width: 600px; height: 400px"&gt;&lt;/div&gt;
*&lt;script src="mymap_99.js" async&gt;&lt;/script&gt;
*&lt;script 
*src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js" async&gt;&lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--mymap_99.html--&gt;</code></pre>
<p>In ihrem eigenen Skript <code>mymap_99.js</code> müssen Sie mithilfe 
von <code>window.addEventListener('load', function() ... )</code> das Laden des 
vollständigen HTML-Dokuments abwarte.</p>
<pre><code>*window.addEventListener('load', function()
 {
 var map = L.map('map',
 {
 center: [50.27264, 7.26469],
 zoom: 10
 });
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(map);
 },
 false
*);
&lt;!--mymap_99.js--&gt;</code></pre>
<p>Alle weiteren Beispiele hier im Buch habe ich ohne das Attribut <code>async</code> 
erstellt, weil ich den Schwerpunkt auf die Verwendung von Leaflet 
selbst setzen wollte.</p>
<h3 id="erstellen-sie-ein-element-dem-ihre-karte-angezeigt-werden-so">Erstellen Sie ein Element in dem Ihre Karte angezeigt werden soll</h3>
<p><a href="#" id="EineKarteMitLeafletErstellenErstellenSieeinElementindemIhreKarteangezeigtwerdensoll"></a></p>
<p>Das Einfügen eines HTML-Elements in unser Grundgerüst dürfte für Sie kein Problem 
darstellen. Der Vollständigkeit halber habe ich diesen Schritt hier trotzdem eingefügt.</p>
<p>Setzen Sie ein <code>&lt;div&gt;</code>-Element mit einer bestimmten <code>ID</code> an die Stelle in Ihrem 
HTML-Dokument, an der Sie Ihre Karte anzeigen möchten. 
Stellen Sie dabei sicher, dass das <code>&lt;div&gt;</code>-Element, also der Kartencontainer, 
eine definierte Höhe hat.</p>
<blockquote>
<p>Der einfachste Weg einem HTML-Element eine feste Höhe zuzuordnen, ist das <code>style</code>-Attribut
– also direkt im HTML-Element selbst. Weil hier im Buch <em>Leaflet</em> das
Hauptthema ist, verwende ich für das Einbinden von Stylesheets in
den Beispielen diese einfache Methode. Durch das direkte Festlegen von
Formaten gehen allerdings im praktischen Einsatz viele Vorteile
verloren. Alternative Varianten zum Einbinden von Stylesheets finden
Sie unter anderem unter der Adresse 
<a href="https://wiki.selfhtml.org/index.php?title=CSS/alternative_Stylesheets&amp;oldid=61905">https://wiki.selfhtml.org/wiki/CSS/alternative_Stylesheets</a>.</p>
</blockquote>
<p>Im nachfolgenden Programmcodeausschnitt sehen Sie die relevante Zeile mit einem Stern 
markiert.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
*&lt;div style="height: 180px;" id="mapid"&gt;&lt;/div&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_997.html--&gt;</code></pre>
<p>So, nun ist das HTML-Dokument bereit ein Leaflet Kartenobjekt zu initialisieren 
und interessante Dinge mit ihm anzustellen.</p>
<h3 id="erstellen-sie-das-karten-objekt">Erstellen Sie das Karten-Objekt</h3>
<p>Nun wird es spannend. Wir erstellen das Skript das die Karte anzeigen wird. 
Dabei beginnen wir mit dem Erstellen des Karten-Objektes. 
Im nachfolgenden Programmcodeausschnitt sehen Sie 
die erste Zeile des Skripts. Ich habe die betreffende Stelle 
mit einem Stern markiert.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 180px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
*var mymap = L.map('mapid').setView([50.27264, 7.26469], 13);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_996.html--&gt;</code></pre>
<p>Was haben wir genau gemacht? Wir haben mit dem Befehl <code>var mymap = L.map('mapid')</code> 
ein neues Objekt – oder eine neue Instanz – der Klasse <code>map</code> erstellt und 
dieser den Namen <code>mymap</code> gegeben.</p>
<p><a href="#" id="Fabrikmethode1"></a></p>
<blockquote>
<p>Sie frage sich nun vielleicht, wie wir 
eine neue Instanz ohne die Verwendung des Schlüsselwortes <code>new</code> 
erstellen konnten? Die Antwort ist einfach: Die Leaflet-Klassen sind mit 
einem Großbuchstaben – beispielsweise <code>L.Map</code> – benannt und diese 
müssen mit <code>new</code> erstellt werden. Es gibt aber Shortcuts mit Kleinbuchstaben
– <code>L.map</code> – die aus Bequemlichkeitsgründen von den Leaflet-Programmierern
für Sie erstellt wurden. Leaflet setzt hier das Entwurfsmuster 
<a href="https://de.wikipedia.org/w/index.php?title=Fabrikmethode&amp;oldid=183961607">Fabrikmethode</a> 
ein. Das Muster beschreibt, wie ein Objekt
durch Aufruf einer Methode anstatt durch direkten Aufruf 
eines Konstruktors erzeugt wird.<br />
Wollen Sie sich dies selbst ansehen? Die <a href="https://github.com/Leaflet/Leaflet/blob/7ed780cd35474f2acf0f17e7394807ff0973a031/src/map/Map.js#L1708">Funktion <code>L.map()</code></a> der Klasse <code>L.Map</code> 
finden Sie auf Github ganz am Ende in der Datei <code>map.js</code>. Ein weiteres Beispiel 
finden Sie zu Beginn des Kapitels <a href="#Fabrikmethode2">Custom Markers</a>.</p>
</blockquote>
<p>Das Festlegen des Kartenmittelpunktes mithilfe der Koordinaten <code>[50.27264, 7.26469]</code> 
und der Methode <code>setView()</code> und die Angabe der Zoomstufe 13 ist optional. 
Ich empfehle Ihnen, diese Werte immer mitzugeben. 
Denn: Es ist für jeden ärgerlich eine Karte zu sehen, die die ganze Welt anzeigt – 
die relevanten Daten befinden sich aber alle in Gering, einem kleinen Dorf 
in der deutschen Eifel. Man muss somit erst einmal mehrmals auf die Schaltflächen 
zum Zoomen klicken.</p>
<blockquote>
<p>Sagen Ihnen die  <em>Koordinaten</em>  in der Form [50.27264, 7.26469] nichts und möchten 
Sie gerne mehr zum Thema geografische Koordinaten erfahren? Dann lesen den Exkurs 
im Kapitel <a href="#ExkursGeografischeKoordinaten">Exkurs: Geographische Koordinaten</a>.</p>
</blockquote>
<p>Sie verfügen nun über ein Leaflet Karten-Objekt, 
mit dem Sie eine Karte anzeigen können. 
Sie müssen dem <em>Karten-Objekt</em> noch mitteilen, 
welches <em>Kartenbild</em> - also welche Grafiken - es anzeigen soll. 
Dies tun Sie, indem Sie eine Schicht mit Kacheln, also einen <em>Tile-Layer</em>, 
zum Karten-Objekt hinzufügen. 
Wie Sie dies genau tun, zeige ich Ihnen im nächsten Kapitel.</p>
<p><a href="#" id="FuegenSieEineSchichtMitKachelnHinzu"></a></p>
<h3 id="fugen-sie-eine-schicht-mit-kacheln-einen-tile-layer-zum-kart">Fügen Sie eine Schicht mit Kacheln – einen Tile-Layer – zum Karten-Objekt hinzu</h3>
<p>Der letzte Schritt beim Erstellen der Karte ist das Hinzufügen 
der Kachel-Schicht. Diese Schicht – oder dieser Layer – 
kann als eine Art Basiskarte angesehen werden. 
Es handelt sich um die Grafiken, auf der die Geoobjekte, 
die wir hier im Buch erarbeiten, dargestellt werden. 
Also die Imagedateien.</p>
<p>Kacheln zum Anzeigen in einem digitalen Kartenobjekt werden 
als Service von unterschiedlichen Providern angeboten. 
Im nächsten Kapitel werde ich Ihnen genauer erläutert, 
dass diese Kacheln normalerweise als 256 Pixel x 256 Pixel 
Images angeboten werden und warum die URL zum Aufruf der Kacheln 
die etwas kryptisch wirkenden Zeichen <code>/{z}/{x}/{y}.png</code> enthält.</p>
<p>Ich verwende hier das Angebot von <a href="http://www.openstreetmap.org">http://www.openstreetmap.org</a> zur 
Darstellung der Karte. 
Den Programmcode zum Einbinden der Imagedateien vom OpenStreetMap 
Tile-Server habe ich für Sie im nachfolgenden Programmcodebeispiel mit einem Stern 
markiert. Die rechtlichen Voraussetzungen zur Verwendung der Kacheln des 
Openstreetmap-Servers finden Sie unter der Adresse 
<a href="https://operations.osmfoundation.org/policies/tiles">https://operations.osmfoundation.org/policies/tiles</a>.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 180px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 13);
*L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;  
&lt;!--index_995.html--&gt;  </code></pre>
<p>Was haben wir genau gemacht? Wir haben ein <code>TileLayer</code>-Objekt erstellt und diesem 
die URL des OpenStreetMap-Servers übergeben. Außerdem haben wir die 
Methode <code>addTo()</code> aufgerufen und dieser Methode unser Karten-Objekt 
<code>mymap</code> als Parameter übergeben. So weiß Leaflet nun genau, 
welche Bilder es wo abrufen 
soll und kann die Kartenschicht zeichnen.</p>
<blockquote>
<p>Ich hatte es eben schon erwähnt: Leaflet ist so programmiert, dass Sie die
verschiedenen Methoden verketten können. Dies ist möglich, weil die
unterschiedlichen Methoden Objekte zurückgeben, die wieder
Funktionen enthalten. Leaflet setzt das Entwurfsmuster 
<a href="https://de.wikipedia.org/w/index.php?title=Fabrikmethode&amp;oldid=183961607">Fabrikmethode</a> 
ein. So konnten wir 
<code>.addTo(mymap)</code> einfach an <code>L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png')</code> anhängen.
Alternativ hätten wir zuerst ein TileLayer Objekt erstellen müssen und 
hätten erst im nächsten Schritt die Methode <code>addTo()</code> aufrufen können.  </p>
<pre><code>var x = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png');  
x.addTo(mymap);</code></pre>
</blockquote>
<p>Fertig! Sie haben nun eine vollständige Karte erstellt. Zählen Sie nach: 
In diesen vier Schritten haben Sie gerade einmal fünf Zeilen Programmcode eingegeben.</p>
<p>Standardmäßig sind alle 
Maus- und Touch-Interaktionen auf der Karte aktiviert. 
Probieren Sie es aus – wir haben ja bisher noch keine Optionen übergeben – 
alles ist Standard.
Sie können die Karte vergrößern und verkleinern und in der rechten unteren Ecke befindet sich ein 
Hinweis darauf, dass die Karte mit Leaflet erstellt wurde.
Sie können nun die ganze Welt auf dieser Karte erkunden.
In der nachfolgenden Abbildung sehen Sie diese Karte – so sollte diese bei Ihnen aussehen, wenn Sie meinem Beispiel gefolgt sind.</p>
<p><img src="../Images/997.png" alt="Ein Screenshot der eine Landkarte mit Leaflet anzeigt." /></p>
<p><em>Abbildung: Ein Screenshot der eine Landkarte mit Leaflet anzeigt.</em></p>
<p>Bevor wir die Karte nun weiter bearbeiten, sehen wir uns ein bisschen Theorie an. 
Falls Sie keine Theorie mögen, können sie sofort praktisch 
im Kapitel <a href="#DieKarteMitDatenBestuecken">Die Karte mit Daten bestücken</a> 
weitermachen.</p>
<p><a href="#" id="ExkursGeografischeKoordinaten"></a></p>
<h2 id="exkurs-geographische-koordinaten">Exkurs: Geographische Koordinaten</h2>
<p>Mithilfe von Längen und  Breitengraden 
können Sie die genaue Position eines jedes Punktes auf der Erdoberfläche angeben.</p>
<h3 id="das-koordinatensystem-der-erde">Das Koordinatensystem der Erde</h3>
<p><a href="#" id="DasKoordinatensystemderErde"></a></p>
<p>Das Grad-Netz der Erde ist ein gedachtes Koordinatensystem auf der Erdoberfläche mit sich rechtwinklig schneidenden Längen- und Breitenkreisen. Zum Aufbau dieses Koordinatensystems wird unser Erdball zunächst in 180 Breitenkreise und 360 Längenkreise eingeteilt.</p>
<ul>
<li>Die  <a href="https://de.wikipedia.org/w/index.php?title=Geographische_Breite&amp;oldid=183712238">Breitengrade</a> 
oder Breitenkreise verlaufen parallel zum Äquator. </li>
<li>Die <a href="https://de.wikipedia.org/w/index.php?title=Geographische_L%C3%A4nge&amp;oldid=182518754">Längengrade</a> 
oder Längenkreise verbinden Nord- und Südpol. </li>
</ul>
<p>So entsteht ein <a href="https://de.wikipedia.org/w/index.php?title=Geographische_Koordinaten&amp;oldid=183407489">grobmaschiges Gitter</a>, 
anhand dessen jeder die ungefähre 
Position auf der Erdoberfläche bestimmen kann.</p>
<p><img src="../Images/964er.png" alt="Das Gradnetz der Erde - By CIA, Niteowlneils (Public domain), via Wikimedia Commons" />  </p>
<p><em>Abbildung: Das Gradnetz der Erde - By CIA, Niteowlneils (Public domain), via Wikimedia Commons</em></p>
<p>Um die Genauigkeit zu erhöhen, wird jeder Breiten- und Längengrad weiter unterteilt.</p>
<h4 id="breitengrade">Breitengrade</h4>
<p>Die <a href="https://de.wikipedia.org/w/index.php?title=Geographische_Breite&amp;oldid=183712238">Breitengrade</a> 
verlaufen von Osten nach Westen. Vielleicht wissen Sie noch aus dem Erdkundeunterricht in der Schule, dass der Äquator im rechten Winkel zur Erdachse verläuft. Er liegt etwa in der Mitte zwischen Nord- und Südpol. Im geografischen Koordinatensystem gilt er als Ausgangspunkt für die Berechnung der Breitenkreise und ihm wird ein Winkel von 0° zugeordnet.</p>
<p><img src="../Images/964br.png" alt="Breitengrade (Latitude) - By Pearson Scott Foresman (Public domain), via Wikimedia Commons" /></p>
<p><em>Abbildung: Breitengrade (Latitude) - By Pearson Scott Foresman (Public domain), via Wikimedia Commons</em></p>
<h4 id="langengrade">Längengrade</h4>
<p>Die <a href="https://de.wikipedia.org/w/index.php?title=Geographische_L%C3%A4nge&amp;oldid=182518754">Längengrade</a> 
auf der Erde verlaufen von Norden nach Süden. Sie umspannen die Erde praktisch. Eine Längenkreishälfte wird als Meridian bezeichnet. Die Längenkreise haben keinen natürlichen Nullpunkt. Heute gilt der Meridan, der den Londoner Stadtteil Greenwich durchläuft, als Nullmeridian und somit als Ausgangspunkt für die Berechnung der Längengrade.</p>
<p><img src="../Images/964la.png" alt="Längengrade (Longitude) - By Pearson Scott Foresman (Public domain), via Wikimedia Commons" /></p>
<p><em>Abbildung: Längengrade (Longitude) - By Pearson Scott Foresman (Public domain), via Wikimedia Commons</em></p>
<h3 id="schreibweisen-von-geografischen-koordinaten">Schreibweisen von geografischen Koordinaten</h3>
<p>Bei der Angabe von geographischen Koordinaten wird heute normalerweise eine von zwei 
Schreibweisen verwendet: Entweder das <a href="https://de.wikipedia.org/wiki/Sexagesimalsystem">Sexagesimalsystem</a>, 
welches von Wikipedia 
verwendet wird, oder die Dezimalschreibweise, die von Computerprogrammen bevorzugt wird. 
Im Laufe unserer Geschichte haben sich allerdings eine Menge mehr unterschiedlicher 
Systeme entwickelt.</p>
<blockquote>
<p>Falls Sie einmal in die Verlegenheit
kommen sollten und eine Koordinate von einem System in ein anderes
umrechnen müssen, kann ich Ihnen die Website <a href="https://www.deine-berge.de/Rechner/Koordinaten/Dezimal/51,10">https://www.deine-berge.de/Rechner/Koordinaten/Dezimal/51,10</a> 
empfehlen,
weil diese das Umrechnen zwischen vielen verschiedenen Systemen
unterstützt.</p>
</blockquote>
<h4 id="das-sexagesimalsystem">Das Sexagesimalsystem</h4>
<p>Das <a href="https://de.wikipedia.org/wiki/Sexagesimalsystem">Sexagesimalsystem</a> 
ist die traditionelle Schreibweise. Dieses System heißt 
Sexagesimal, weil ein Grad eines Breitengrades 60 Minuten entspricht. Somit basiert 
das Sexagesimalsystem auf der Zahl 60. Und der lateinische Name der Zahl 60 ist 
<em>'sexagesimus'</em>.  </p>
<p>Jeder Breiten- und Längengrad wird in 60 Minuten mit je 60 Sekunden unterteilt. Eine Koordinate besteht somit aus drei Teilen.</p>
<ul>
<li>Der erste Teil gibt die Längen- und Breitengrade als Winkel in Grad (°) an. 
Die Angabe ist ganzzahlig und liegt beim Längengrad zwischen<br />
-180 und +180<br />
und beim Breitengrad zwischen<br />
-90 und +90.<br />
Dabei steht beim Längengrad<br />
<strong>-</strong>90° für die Angabe 90° <strong>Süd</strong><br />
und<br />
<strong>+</strong>90° für die Angabe 90° <strong>Nord</strong>.<br />
Die Breite wird entsprechend in <strong>-</strong>180° bis <strong>+</strong>180° angegeben, 
anstelle von 180° <strong>West</strong> bis 180° <strong>Ost</strong>. </li>
<li>Der zweite Teil gibt die Minuten an. Die Minuten werden durch eine Prime (′) gekennzeichnet. Jeder Grad hat 60 Minuten. Das bedeutet, dass diese Zahl nicht kleiner als 0 sein darf und kleiner als 60 sein muss. </li>
<li>Der dritte Teil gibt die Sekunden an. Jede Minute hat 60 Sekunden, die anhand einer Doppelprime (″) erkennbar sind. Genau wie bei den Minuten gilt also auch hier: Die Sekundenzahl darf nicht kleiner als 0 sein und muss kleiner als 60 sein. </li>
</ul>
<p>Eine Breitenminute entspricht auf der Erdoberfläche einer Strecke von circa 1,852 Kilometern. Die Strecke, die einer Längenminute entspricht, beträgt am Äquator ebenfalls 1,852 Kilometer, verringert sich aber zum Pol hin auf 0 Kilometer.</p>
<p>So hat beispielsweise die Zugspitze die Koordinaten <code>47°25′16″, 10°59′7″</code>. Einem Ort, der auf dem westlichen Teil der Südhalbkugel liegt, könnten die Koordinaten <code>-11°27′30″, -72°47′23″</code>  zugeordnet werden.</p>
<h4 id="die-dezimalschreibweise">Die Dezimalschreibweise</h4>
<p>Parallel zum traditionell gebräuchlichen Sexagesimalsystem hat sich die Angabe der 
Koordinaten im Dezimalsystem etabliert. Das Dezimalsystem basiert auf der Zahl 
10. Dieses System wird vor allem deshalb von Computern gerne benutzt, weil es sich 
damit recht unkompliziert rechnen lässt.</p>
<p>Die Genauigkeit einer Koordinate in der Dezimalschreibweise hängt sehr von der 
Anzahl der Nachkommastellen ab. Bei nur zwei Nachkommastellen ergibt sich eine 
mögliche Abweichung von bis zu einem Kilometer, bei vier Stellen nach dem Komma sind 
es nur noch zehn Meter Abweichung und sechs Nachkommastellen entsprechen einer 
Genauigkeit von einem Meter.</p>
<p>Orten auf der West- und Südhalbkugel wird in der Regel ein Minus (-) vorangestellt. Die Breite wird in Dezimalgrad von -90° bis +90° angegeben. Dabei steht <strong>-</strong>90° für die Angabe 90° <strong>Süd</strong> und <strong>+</strong>90° für die Angabe 90° <strong>Nord</strong>. Die Breite wird entsprechend in <strong>-</strong>180° bis <strong>+</strong>180° angegeben, anstelle von 180° <strong>West</strong> bis 180° <strong>Ost</strong>.<br />
Beispielsweise werden im Dezimalsystem die Koordinaten der Zugspitze mit <code>47.4211, 10.9852</code> angegeben. Einem Ort, der auf dem westlichen Teil der Südhalbkugel liegt, könnten die Koordinaten <code>-13.163333, -72.545556</code> zugeordnet werden.</p>
<h2 id="exkurs-wie-werden-landkarten-auf-einer-website-angezeigt">Exkurs: Wie werden Landkarten auf einer Website angezeigt?</h2>
<p>Eine Karte ist im Grunde genommen nichts anderes als die Darstellung 
einer <a href="https://de.wikipedia.org/w/index.php?title=Abbild&amp;oldid=182130782">Abbildung</a> 
oder <a href="https://de.wikipedia.org/w/index.php?title=Grafik&amp;oldid=182761925">Grafik</a>. 
Abbildungen oder Grafiken müssen, damit sie von Computern verarbeitet werden können, 
in einem <a href="https://de.wikipedia.org/w/index.php?title=Grafikformat&amp;oldid=183935915">Grafikformat</a> 
gespeichert werden. Bevor wir uns genau ansehen, wie die Grafiken für 
Landkarten erstellt werden, erkläre ich Ihnen nachfolgend kurz 
die wesentlichen Unterschiede dieser beiden Formate.</p>
<h3 id="grafikformate-vektoren-und-rastergrafiken">Grafikformate: Vektoren und Rastergrafiken</h3>
<p>Ein Grafikformat ist ein Dateiformat, das den Aufbau einer Bilddatei beschreibt. 
Bei den Grafikformaten können Sie alles in allem 
zwischen <a href="https://de.wikipedia.org/w/index.php?title=Vektorgrafik&amp;oldid=182749111">Vektorgrafiken</a> 
und 
<a href="https://de.wikipedia.org/w/index.php?title=Rastergrafik&amp;oldid=178300838">Rastergrafiken</a> 
unterscheiden. Im nächsten Bild sehen Sie oben eine Vektorgrafik 
und unten eine Rastergrafik.</p>
<p><img src="../Images/930.png" alt="Vektorgrafik und Rastergrafik" /></p>
<p><em>Abbildung: Vektorgrafik und Rastergrafik</em></p>
<h4 id="vektoren">Vektoren</h4>
<p><a href="https://de.wikipedia.org/w/index.php?title=Vektorgrafik&amp;oldid=182749111">Vektorgrafiken</a> 
basieren, im Gegensatz zu Rastergrafiken, nicht auf einem Pixelraster, 
indem jedem Bildpunkt ein Farbwert zugeordnet ist. 
Vektorgrafiken basieren auf einer Formel, die die Elemente, aus denen das Bild aufgebaut ist, genau beschreibt. Ein Kreis kann in einer Vektorgrafik anhand des Mittelpunktes, des Radiuses, der Linienstärke und der Farbe vollständig beschrieben werden. Deshalb müssen auch nur diese Parameter gespeichert werden. Je nach Bildgröße benötigen Vektorgrafiken daher oft weniger Speicherplatzbedarf als Rastergrafiken. Außerdem können sie im Gegensatz zur Rastergrafik stufenlos und verlustfrei skaliert, also vergrößert oder verkleinert werden.</p>
<h4 id="rastergrafiken">Rastergrafiken</h4>
<p><a href="https://de.wikipedia.org/w/index.php?title=Rastergrafik&amp;oldid=178300838">Rastergrafiken</a> 
kennen Sie sicherlich auch unter dem Namen Pixelgrafik oder 
Bitmap. Dieses Format beschreibt die Bilder in Form einer Anordnung von Pixeln 
als Raster. Pixel sind im Grunde genommen nichts anderes als Bildpunkten, 
denen eine Farbe zugeordnet ist. Anders als bei Vektorgrafiken ist die Bildgröße – 
die Breite und Höhe gemessen in Pixeln –  und die Farbtiefe – die maximale Anzahl 
an Farben – ein wesentliches Merkmal des Bildes. Eine Rastergrafik kann nicht 
stufenlos und verlustfrei vergrößert werden.</p>
<h3 id="vektoren-und-rastergrafiken-fur-digitale-karten">Vektoren und Rastergrafiken für digitale Karten</h3>
<p>Karten sollen intuitiv und einfach bedienbar sein. 
Idealerweise ist jeder Ausschnitt der Karte in jeder Auflösung schnell abrufbar.</p>
<p>Theoretisch ist dies für Vektorkarten möglich. Praktisch kostet es aber sehr viel Rechenzeit. Abgesehen von Satellitenaufnahmen oder Luftbildern, die nichts anderes als ein Foto sind, sind Karten in der Regel keine Rastergrafiken. Die Informationen anhand derer die Karte erstellt wird, werden als Daten gespeichert. Diese Daten entsprechen eher den Daten, mit denen Vektorgrafiken erstellt werden. Eine Straße wird beispielsweise mithilfe einer Anzahl von Punkten, die miteinander verbunden sind, dargestellt. Zusätzlich werden mit diesen Punkten Eigenschaften abgespeichert. Eine Eigenschaft kann der Straßenname sein –  eine andere Eigenschaft kann der Straßenbelag sein.</p>
<p>Leider ist die Darstellung dieser Informationen auf einer Webseite in 
einem Vektorformat aber schwierig. 
Nicht alle Browser können gut mit Vektorgrafiken umgehen. 
Außerdem gibt es viele Geodaten, die große Bereiche auf der Erde abdecken. 
Diese müssen bei der Verwendung eines Vektorformates auch dann verarbeitet werden, 
wenn Sie sich nur einen kleinen Bereich in Deutschland ansehen möchten. 
Mit Rastergrafiken hat kein Browser Probleme. 
So ziemlich jeder Browser kann eine Rasterkarte anstandslos auf einem 
Bildschirm anzeigen.</p>
<p>Das Problem bei der Bereitstellung von geographischen Informationen 
als Rastergrafik ist, dass eine gute Bildqualität eine hohe Auflösung voraussetzt. 
Dies hat zur Folge, das die Grafikdateien sehr groß werden. Bilddateien, 
die über das Internet geladen und im Browser angezeigt werden, sollten aber so klein 
wie möglich sein.</p>
<p>Aus diesem Grund wird die Karte für kleine Ausschnitte im Vorfeld berechnet 
und in einem Rasterformat gespeichert. 
Als Rasterformat wird 
<a href="https://de.wikipedia.org/w/index.php?title=Portable_Network_Graphics&amp;oldid=183603310">PNG</a> 
verwendet. Wie dies genau gemacht wird, erkläre ich Ihnen im nächsten Kapitel.</p>
<h3 id="wir-unterteilen-die-welt-kacheln">Wir unterteilen die Welt in Kacheln</h3>
<p>Um eine Karte anzuzeigen, wird die Welt also in Ausschnitte, 
genau genommen in Quadrate zerlegt. Die Quadrate werden 
<em>'Tiles'</em>, das ist das englische Wort für 
<em>'Kacheln'</em>, genannt. Jedes Quadrat ist exakt 256 Pixel x 256 Pixel groß.</p>
<blockquote>
<p>Nicht nur OpenStreetMap, auch die Google
Maps API unterteilt ihr Kartenbilder in Kacheln. Wenn Sie die Website
<a href="https://www.google.de/maps">https://www.google.de/maps</a> aufrufen und eine andere Vergrößerungsstufe wählen, 
wird ermittelt,
welche Daten erforderlich sind. Diese Daten werden dann in einen Satz
mit Kacheln übersetzt und angezeigt. 
Dabei bildet die Zoom-Stufe 0 die ganze Welt auf ein Quadrat ab. 
Teilt man den Erdumfang von 40.038 Kilometern durch die 256 Pixel 
der Kachel sieht man im Ergebnis, dass ein Pixel 156,4 Kilometer darstellt. 
Das ist noch nicht sehr detailliert. Bis Zoom-Stufe 19 ändert sich eine ganze Menge. 
In der nachfolgenden Tabelle sehen Sie, dass bei Zoom-Stufe 19 ein Pixel einem 
Bereich von 0,3 Metern auf der Erde entspricht. Damit kann man schon etwas anfangen!</p>
</blockquote>
<table>
<thead>
<tr>
<th>Zoom-Stufe</th>
<th>Kachel-Anzahl</th>
<th>Kachel-Breite entpricht</th>
<th>Ein Pixel entspricht</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>1</td>
<td>40.038 Kilometer</td>
<td>156  Kilometer</td>
</tr>
<tr>
<td>1</td>
<td>4</td>
<td>20.019 Kilometer</td>
<td>78  Kilometer</td>
</tr>
<tr>
<td>2</td>
<td>16</td>
<td>10.009 Kilometer</td>
<td>39  Kilometer</td>
</tr>
<tr>
<td>3</td>
<td>64</td>
<td>5.004 Kilometer</td>
<td>19,5 Kilometer</td>
</tr>
<tr>
<td>4</td>
<td>256</td>
<td>2.502 Kilometer</td>
<td>9,8 Kilometer</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>.....</td>
<td>....</td>
</tr>
<tr>
<td>15</td>
<td>1 Milliarden</td>
<td>1.224 Meter</td>
<td>4,8 Meter</td>
</tr>
<tr>
<td>16</td>
<td>4 Milliarden</td>
<td>612 Meter</td>
<td>2,4 Meter</td>
</tr>
<tr>
<td>17</td>
<td>17 Milliarden</td>
<td>306 Meter</td>
<td>1,2 Meter</td>
</tr>
<tr>
<td>18</td>
<td>68 Milliarden</td>
<td>306 Meter</td>
<td>0,6 Meter</td>
</tr>
<tr>
<td>19</td>
<td>275 Milliarden</td>
<td>76 Meter</td>
<td>0,3 Meter</td>
</tr>
</tbody>
</table>
<p>Die vollständige Tabelle können Sie unter der Adresse 
<a href="https://wiki.openstreetmap.org/w/index.php?title=Zoom_levels&amp;oldid=1620415">http://wiki.openstreetmap.org/wiki/Zoom_levels</a> 
mit weiteren Angaben im Internet abrufen.</p>
<blockquote>
<p>Vielleicht probieren Sie nun das Zoomen im vorangegangene Beispiel 
aus und wundern sich, dass Sie die Karte nur bis zur Zoom-Stufe 18 
vergrößern können. Das liegt daran, dass bei dieser OpenStreeMap Karte 
standardmäßig die Option <code>maxZoom</code> mit 18 gesetzt ist. 
Sie können diese Option jedoch überschreiben. 
Wie das geht sehen Sie im nachfolgenden Programmcodebeispiel mit einem Stern markiert. 
Weitere Informationen finden Sie im Kapitel zur Karte von 
<a href="#idmaxZoom">Stamen</a>.</p>
</blockquote>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OpenStreetMap Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 180px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 13);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', 
 {
*minZoom: 0, maxZoom: 19
 }
 )
 .addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_995a.html--&gt;</code></pre>
<blockquote>
<p>Vielleicht sind Sie es gewohnt, bei der
Darstellung von Landkarten in den Zahlen eines Maßstabs zu denken?
Bei digitalen Karten gibt es keinen Maßstab im Sinne einer
Papierkarte, weil die Druckauflösung nicht bekannt ist und ein
Maßstab hiervon abhängt. Ein Maßstab kann immer nur relativ zur
Auflösung angegeben werden.</p>
</blockquote>
<h3 id="wie-weiss-leaflet-welche-der-vielen-kacheln-angezeigt-werden">Wie weiß Leaflet welche der vielen Kacheln angezeigt werden sollen?</h3>
<p><a href="#" id="EineKarteMitLeafletErstellenWieweissLeafletWelcheKartenangezeigtwerdensollen"></a></p>
<p>Nun haben wir jede Menge Kacheln und möchten mit diesen eine digitale Karte auf 
unserer Website anzeigen. Woher weiß Leaflet, welche Kacheln, also welche Bilddatei, es vom verlinkten Server 
laden und an welcher Stelle es diese anzeigen soll? 
Dazu sehen wir uns zunächst einmal an, wie die Kacheln genau erstellt werden.</p>
<p>Um ein Bild von einer Karte in kleine überschaubare Abschnitte zu teilen, 
unterscheidet der Server, der die Kacheln erzeugt, zwischen verschiedenen 
Zoom-Stufen und für jede Zoom-Stufe erstellt er ein eigenes Set von Kacheln – 
praktisch eine eigene Ebene.<br />
Da der Standard für die Größe der Kacheln 256 Pixel x 256 Pixel beträgt, 
ist bei der Zoom-Stufe 0 die gesamte Welt in einer einzigen 256 Pixel x 256 Pixel 
großen Kachel enthalten. In der Tabelle im vorherigen Kapitel konnten Sie ja 
schon erkennen, dass jede Erhöhung der Zoom-Stufe auch die Anzahl der 
anzuzeigenden Kacheln erhöht.</p>
<p>Um die Kacheln in der richtigen Weise zu benutzen, muss es ein Muster geben, 
das befolgt werden kann, um sicherzustellen, dass die richtigen Kacheln vom Server 
geladen werden und vom Browser des Clients an der richtigen Stelle angezeigt werden.</p>
<p>Im Kapitel 
<a href="#FuegenSieEineSchichtMitKachelnHinzu">Fügen Sie eine Schicht mit Kacheln – einen Tile-Layer – zum Karten-Objekt hinzu</a> 
hatten wir die URL für den Tile Server mit 
<code>http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png</code> angegeben.  </p>
<p>Der Teil <code>{z}/{x}/{y}</code> des Pfades zur PNG-Datei enthält Variablen aus 
denen der Namen der Bilddatei berechnet werden kann.</p>
<ul>
<li><code>{z}</code>  bezeichnet die zu ladende Zoom-Stufe. </li>
<li><code>{x}</code>  bezeichnet die Position auf der x-Achse der Kachel. </li>
<li><code>{y}</code>  bezeichnet die Position auf der y-Achse. </li>
<li><code>{s}</code>  steht für eine optionale Subdomain. </li>
</ul>
<p>Zum Beispiel wird das Bild für die niedrigste Zoom-Stufe – 
also das Bild welches den größten Bereich pro Pixel anzeigt – 
unter dem Dateinamen  <code>0/0/0.png</code> abgespeichert.</p>
<p><img src="../Images/998.png" alt="Das Bild für die niedrigste Zoom-Stufe `0/0/0.png`." /></p>
<p><em>Abbildung: Das Bild für die niedrigste Zoom-Stufe <code>0/0/0.png</code>.</em></p>
<p>Die vollständige URL dieses Kachelbildes auf dem Openstreetmap 
Server ist <code>http://a.tile.openstreetmap.org/0/0/0.png</code>. 
Probieren Sie es, klicken Sie den Link an oder öffnen Sie selbst die Adresse 
<a href="http://a.tile.openstreetmap.org/0/0/0.png">http://a.tile.openstreetmap.org/0/0/0.png</a> in Ihrem Internetbrowser.</p>
<blockquote>
<p>Tiefer gehend können Sie das Thema auf
der Website von OpenStreetMap, genau unter der Adresse 
<a href="https://wiki.openstreetmap.org/w/index.php?title=Slippy_map_tilenames&amp;oldid=1706759">http://wiki.openstreetmap.org/wiki/Slippy_map_tilenames</a>, 
nachlesen.</p>
</blockquote>
<p>Bei der Zoom-Stufe 1 sind die Kacheln, 
wie in der nachfolgenden Grafik dargestellt, angeordnet.</p>
<p><img src="../Images/998a.png" alt="Ein Bild mit allen Kacheln für die zweitniedrigste Zoom-Stufe." /></p>
<p><em>Abbildung: Ein Bild mit allen Kacheln für die zweitniedrigste Zoom-Stufe.</em></p>
<p>Unter der Adresse <a href="http://a.tile.openstreetmap.org/1/0/0.png">http://a.tile.openstreetmap.org/1/0/0.png</a> 
finden sie die Grafik, die sich in der Abbildung links oben befindet.</p>
<h2 id="schone-kartenlayer">Schöne Kartenlayer</h2>
<p><a href="#" id="EineKarteMitLeafletErstellenSchoeneKartenlayer"></a></p>
<p>Nachdem das Erstellen der ersten Karte so einfach vonstatten ging fragen Sie sich sicher, 
ob es genauso einfach ist eine alternative Darstellung – also 
Kacheln eines anderen Providers – zu verwenden. 
Die Antwort ist: Ja, meist ist es ist genauso einfach!</p>
<p>Ich zeige Ihnen dies hier anhand von zwei weiteren Providern, 
nämlich <a href="https://www.thunderforest.com">thunderforest.com</a> und
<a href="https://stamen.com">stamen.com</a>. Im Kapitel 
<a href="#EnvironmentalSystemsResearchInstituteBasemaps">ESRI - Environmental Systems Research Institute</a> finden Sie 
weitere Beispiele.</p>
<blockquote>
<p>Mögen Sie die Karten von <a href="https://www.google.com/maps">GoogleMaps</a> und möchten Sie gerne die Kacheln von 
Google für Ihre digitale Karte nutzen? Wenn Sie dies zusammen mit 
Leaflet tun möchten, können Sie dies mithifle des Plugins 
<a href="https://gitlab.com/IvanSanchez/Leaflet.GridLayer.GoogleMutant">L.GridLayer.GoogleMutant</a>.</p>
</blockquote>
<h3 id="thunderforest">Thunderforest</h3>
<p>Thunderforest bietet Ihnen gleich neun verschiedene Kachel-Varianten. Sie erreichen die Kacheln alle über die gleiche URL, lediglich das Unterverzeichnis muss angepasst werden.  </p>
<blockquote>
<p>Um Kacheln von Thunderforest zu
verwenden, müssen Sie ein Zugriffstoken anfordern. Dieses Token können Sie über 
die Adresse <a href="https://www.thunderforest.com/docs/apikeys">https://www.thunderforest.com/docs/apikeys</a> 
selbst erstellen. Wenn Sie ihre Karte erstellen, hängen Sie dieses Zugriffstoken 
einfach an das Ende der URL des Tile-Servers an. Zum Beispiel so: 
<code>https://{s}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey=YourApiKey</code>  </p>
</blockquote>
<p>Die Kacheln der OpenCyclemap finden Sie beispielsweise unter der Adresse  </p>
<p><code>https://{s}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey=YourApiKey</code>  </p>
<p>abgelegt. Die Transportvariante finden Sie unter der Adresse  </p>
<p><code>https://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png?apikey=YourApiKey.</code>  </p>
<hr />
<p>Nachfolgende Übersicht zeigt Ihnen die verschiedenen Kartenstile von Thunderforest.</p>
<p><img src="../Images/997pioneer.png" alt="." />  </p>
<p><em>Abbildung: pioneer</em></p>
<hr />
<p><img src="../Images/997cycle.png" alt="." />   </p>
<p><em>Abbildung: cycle</em></p>
<hr />
<p><img src="../Images/997transport.png" alt="." />   </p>
<p><em>Abbildung: transport.</em></p>
<hr />
<p><img src="../Images/997outdoors.png" alt="." />  </p>
<p><em>Abbildung: outdoors.</em></p>
<hr />
<p><img src="../Images/997transportdark.png" alt="." />  </p>
<p><em>Abbildung: transport-dark.</em></p>
<hr />
<p><img src="../Images/997mobileatlas.png" alt="." />  </p>
<p><em>Abbildung: mobile-atlas.</em></p>
<hr />
<p><img src="../Images/997outdoors.png" alt="." />  </p>
<p><em>Abbildung: outdoors.</em></p>
<hr />
<p><img src="../Images/997neigborhood.png" alt="." />  </p>
<p><em>Abbildung: neigborhood.</em></p>
<hr />
<p>Wenn Sie Thunderforest verwenden möchten, müssen Sie unser bisheriges Beispiel 
nun in einer Zeile abändern. Sie müssen als Tile Layer nur die im Beispiel 
zu sehende URL angeben. Der nachfolgende Programmcode zeigt Ihnen ein vollständiges 
Beispiel.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 13);
*L.tileLayer('https://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png?apikey=IhrKey')
*.addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_994.html--&gt;</code></pre>
<h3 id="stamen">Stamen</h3>
<p>Stamen legt den Schwerpunkt auf gutes Design. 
Informationen zu den Karten von Stamen finden Sie auf der 
Website <a href="http://maps.stamen.com">http://maps.stamen.com</a>. 
Die Übersicht zeigt Ihnen drei Kartenstile von Stamen.</p>
<p><img src="../Images/996watercolor.png" alt="." />
<em>Abbildung: watercolor.</em></p>
<hr />
<p><img src="../Images/996toner.png" alt="." /></p>
<p><em>Abbildung: toner.</em></p>
<hr />
<p><img src="../Images/996terrant.png" alt="." /></p>
<p><em>Abbildung: terraint.</em></p>
<hr />
<p>Beim Einbinden einer Karte von Stamen müssen Sie zusätzlich eine 
JavaScript Datei verlinken. Wie Sie den <code>StamenTileLayer</code> genau nutzen, 
können Sie im nachfolgenden Programmcodebeispiel ablesen.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script type="text/javascript" 
*src="http://maps.stamen.com/js/tile.stamen.js"&gt;
*&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 13);
*var layer = new L.StamenTileLayer("watercolor");
*mymap.addLayer(layer);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_993.html--&gt;</code></pre>
<p><a href="#" id="idmaxZoom"></a></p>
<blockquote>
<p><strong>Achtung:</strong><br />
Der <code>StamenTileLayer</code> unterstützt nicht alle Zoom-Stufen. 
Wenn Sie den Typ <code>watercolor</code> verwenden, sehen Sie zum Beispiel mit 
der Zoom-Stufe 19 eine leere graue Fläche. Um dies zu verhindern können Sie 
die Optionen des <code>StamenTileLayer</code> überschreiben. </p>
<ul>
<li>Setzten Sie dafür nach der Instanziierung die Options <code>maxZoom</code> auf 19. So 
bleibt die Zoom-Stufe 19 als Ebene auf der Karte erhalten.</li>
<li>Setzen Sie dann aber die Option <code>maxNativeZoom</code> auf 18. 
Dies bewirkt, dass Leaflet nicht versucht, Kachel für eine Zoom-Stufe 19 zu laden. 
Stattdessen benutze Leaflet auch bei Zoom-Stufe 19 die Kacheln der Zoom-Stufe 18 – 
skaliert diese aber auf die Größe der Zoom-Stufe 19.  </li>
</ul>
</blockquote>
<pre><code>...  
var layer = new L.StamenTileLayer("watercolor"); 
layer.options.maxZoom = 19;
layer.options.maxNativeZoom = 18;
...
&lt;!--index_993a.html--&gt;</code></pre>
<p>ESRI ist ein weiterer Anbieter von Basiskarten. 
Was ESRI genau ist und wie Sie die Karten dieses Institius einbinden können 
erkläre ich Ihnen im Kapitel zu <a href="#EnvironmentalSystemsResearchInstitute">ESRI</a>.</p>
<blockquote>
<p>Haben Sie noch nicht den Kartenstil gefunden, den Sie suchen oder sind Sie einfach nur
neugierig, welche Karten sonst noch angeboten werden? Verweise auf
weitere Tile-Server-Provider finden Sie unter der Adresse: 
<a href="https://wiki.openstreetmap.org/w/index.php?title=Tiles&amp;oldid=1550873">http://wiki.openstreetmap.org/wiki/Tiles</a>.</p>
</blockquote>
<h2 id="images-als-layer-web-map-service">Images als Layer – Web-Map-Service</h2>
<p>Sie haben eine gute Satellitenaufnahme und möchten diese als Schicht 
in Ihrer Karte anzeigen. Vielleicht denken Sie auch an die Wetterwarnkarten 
des Deutschen Wetterdienstes, die im Grunde genommen nur aus 
eingefärbten Polygonen bestehen. Ein Umwandeln dieser 
Grafikdateien in 275 Milliarden Kacheln, wie es im vorherigen Kapitel 
beschriebenen wurde, wäre zwar möglich – Sie können sich aber vorstellen, 
dass es für diese Aufgabenstellungen adäquatere Techniken gibt.</p>
<h3 id="eine-einfache-leaflet-karte-mithilfe-des-web-map-services-er">Eine einfache Leaflet-Karte mithilfe des Web-Map-Services erstellen</h3>
<p>Eine Alternative zur schon beschriebenen Kachel-Technik ist der 
<a href="https://de.wikipedia.org/w/index.php?title=Web_Map_Service&amp;oldid=176931156">Web-Map-Service (WMS)</a>. 
Der WMS ist ein Spezialfall eines <a href="https://de.wikipedia.org/w/index.php?title=Webservice&amp;oldid=177080675">Web Services</a>. 
Dieser Service bietet Ihnen eine Schnittstelle zum Abrufen von 
Landkartenausschnitten über das Internet.</p>
<p>Ein WMS bietet drei Funktionen, die von einem Benutzer angefragt werden können. 
Die Funktionen </p>
<ul>
<li><code>GetCapabilities</code> und <code>GetFeatureInfo</code> können wir hier vernachlässigen. 
Diese sind für die Anzeige der Karte nicht relevant. </li>
<li>Die Funktion <code>GetMap</code> ist die, die wir uns genauer ansehen und die von 
Leaflet angewendet wird. </li>
<li>Bei einem Aufruf von <code>GetMap</code> liefert der WMS ein <a href="https://de.wikipedia.org/w/index.php?title=Georeferenzierung&amp;oldid=174938538">georeferenziertes</a> 
Rasterbild.  </li>
</ul>
<blockquote>
<p>Bei einem 
<a href="https://de.wikipedia.org/w/index.php?title=Georeferenzierung&amp;oldid=174938538">georeferenzierten</a> 
Rasterbild handelt
es sich um eine Bilddatei, der raumbezogene Informationen hinzugefügt
wurden. Das hört sich zunächst einmal sehr theoretisch an.
Praktisch können Sie sich den Vorgang der Georeferenzierung so
veranschaulichen: Stellen Sie sich vor, dass das Bild auf einen Bereich auf der Erde gelegt wird. Gleichzeitig wird das
Gradnetz der Erde dieses Bereichs mit dem Bild verbunden. Im Ergebnis
wird also jedem Pixel des Bildes eine Koordinate – in Relation zum
Gradnetz der Erde – zugewiesen. Georeferenzierung kennen Sie
vielleicht auch unter dem Begriff Geokodierung, Geotagging oder
Verortung.</p>
</blockquote>
<p>Innerhalb des <code>GetMap</code> Aufrufs können Sie Optionen auswählen. 
Zum Beispiel können Sie angeben,  </p>
<ul>
<li>welches Koordinatensystem zugrundelegt werden soll, </li>
<li>welchen Kartenausschnitt Sie sehen möchten, </li>
<li>wie groß der Kartenausschnitt sein soll oder </li>
<li>welches Ausgabeformat Sie gerne hätten. </li>
</ul>
<p>Mit folgendem URL-Abruf erhalten Sie beispielsweise ein speziell 
zusammengestelltes Bild vom GeoWebservice des 
<a href="http://www.dwd.de/">Deutschen Wetterdienstes</a>.</p>
<p><a href="https://maps.dwd.de/geoserver/dwd/ows?service=WMS&amp;version=1.3&amp;request=GetMap&amp;layers=dwd:Warnungen_Landkreise&amp;bbox=6.15,51.76,14.90,55.01&amp;width=512&amp;height=418&amp;srs=EPSG:4326&amp;format=image%2Fjpeg&amp;CQL_FILTER=EC_II%20IN%20(&#039;51&#039;,&#039;52&#039;)">https://maps.dwd.de/geoserver/dwd/ows?service=WMS&amp;version=1.3&amp;request=GetMap&amp;layers=dwd:Warnungen_Landkreise&amp;bbox=6.15,51.76,14.90,55.01&amp;width=512&amp;height=418&amp;srs=EPSG:4326&amp;format=image%2Fjpeg&amp;CQL_FILTER=EC_II%20IN%20('51','52')</a></p>
<p><code>https://maps.dwd.de/geoserver/dwd/ows?service=WMS&amp;version=1.3</code><br />
<code>&amp;request=GetMap</code><br />
<code>&amp;layers=dwd:Warnungen_Landkreise</code><br />
<code>&amp;bbox=6.15,51.76,14.90,55.01</code><br />
<code>&amp;width=512</code><br />
<code>&amp;height=418</code><br />
<code>&amp;srs=EPSG:4326</code><br />
<code>&amp;format=image%2Fjpeg</code><br />
<code>&amp;CQL_FILTER=EC_II%20IN%20('51','52')</code>  </p>
<p>Probieren Sie es aus: Der Aufruf der URL im Browser produziert eine 
Karte mit allen momentan ausgegebenen gültigen Windwarnungen der Kategorie 
51 (Windböen) und 52 (Sturmböen) für Norddeutschland. Ausgegeben im JPG-Format. 
Sie sehen allerdings nur dann ein Bild, wenn tatsächlich Wetterwarnungen vorhanden 
sind.</p>
<blockquote>
<p>Eine Anleitung zur Nutzung des GeoWebservices des Deutschen Wetterdienstes 
finden Sie unter der Adresse 
<a href="https://www.dwd.de/DE/wetter/warnungen_aktuell/objekt_einbindung/einbindung_karten_geowebservice.pdf?__blob=publicationFile&amp;v=11">https://www.dwd.de/DE/wetter/warnungen_aktuell/objekt_einbindung/einbindung_karten_geowebservice.pdf?__blob=publicationFile&amp;v=11</a>.  </p>
</blockquote>
<p>Detaillierte technische Informationen zum Web Mapping Service (WMS) 
allgemein finden Sie unter der Adresse 
<a href="http://www.opengeospatial.org/standards/wms">http://www.opengeospatial.org/standards/wms</a> 
im Internet. Ausführliche Informationen zu den möglichen Funktionen 
eines Geoservers finden Sie unter <a href="http://docs.geoserver.org">http://docs.geoserver.org</a>.</p>
<p>Ich möchte Sie hier an dieser Stelle nicht mit trockenen Dokumentationen 
von Web Services langweilen. 
Viel lieber zeige ich Ihnen ein praktisches Beispiel. 
Im nachfolgenden Programmcodeausschnitt sehen Sie die wesentlichen 
Zeilen mit einem Stern markiert.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 7);
*var dwd = L.tileLayer.wms("https://maps.dwd.de/geoserver/dwd/wms", {
*layers:'dwd:bluemarble',
*}).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_992.html--&gt;</code></pre>
<p>Wenn Sie dieses Beispiel mit dem Laden eines <code>L.tileLayer</code> 
ohne WMS vergleichen, ist eigentlich nur eine Zeile anders.</p>
<p>Anstelle der Zeile</p>
<p><code>**L.tileLayer**('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);</code></p>
<p>haben wir</p>
<p><code>**L.tileLayer.wms**("https://maps.dwd.de/geoserver/dwd/wms", {</code>
<code>layers:'dwd:bluemarble',</code>
<code>}).addTo(mymap);</code></p>
<p>eingefügt.</p>
<p>Wichtig ist, dass Sie dem Aufruf <code>L.tileLayer.wms</code></p>
<ul>
<li>die richtige Adresse zum WMS Service mitgeben und   </li>
<li>die Option <code>layers</code>  </li>
</ul>
<p>passend setzen.</p>
<p>Für alle anderen Parameter setzt Leaflet, oder der Service selbst, 
Standardwerte ein – falls Sie nichts Spezielles angeben ...</p>
<p>Möchten Sie wissen, was vom WMS-Service geliefert wird? 
Dann öffnen Sie doch die HTML-Datei des vorherigen Beispiels in Ihrem Browser. 
Mit dem Layer <code>dwd:bluemarble</code> 
können Sie ein Satellitenbild zu Ihrer Karte hinzufügen. 
Wie das genau aussieht, sehen Sie im nachfolgenden Bild.</p>
<p><img src="../Images/942.png" alt="Ein Satellitenbild, das über einen WMS-Service geladen wurde." /></p>
<p><em>Abbildung: Ein Satellitenbild, das über einen WMS-Service geladen wurde.</em></p>
<h3 id="ltilelayerwms-uber-ltilelayerwms">L.tileLayer.wms über L.tileLayer.wms</h3>
<p>Das Schöne an WMS-Layern ist, das Sie diese übereinander legen können. 
Das nachfolgende Beispiel enthält Programmcode, der im Ergebnis gleichzeitig 
drei WMS-Layer übereinander anzeigt.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 7);
*L.tileLayer.wms("https://maps.dwd.de/geoserver/dwd/wms",
*{
*transparent: true,
*layers:'dwd:bluemarble',
*}).addTo(mymap);
*L.tileLayer.wms("https://maps.dwd.de/geoserver/dwd/wms",
*{
*format: 'image/png',
*transparent: true,
*layers:'dwd:Warngebiete_Kreise'
*}).addTo(mymap);
*L.tileLayer.wms("https://maps.dwd.de/geoserver/dwd/wms",
*{
*format: 'image/png',
*transparent: true,
*layers:'dwd:Warnungen_Gemeinden_vereinigt'
*}).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_991.html--&gt;</code></pre>
<p>Dieses Beispiel ist meiner Meinung nach selbsterklärend. 
Wichtig ist, dass Sie die Option <code>transparent</code> mit <code>true</code> übergeben. 
Andernfalls sehen Sie nur einen – nämlich den obersten – Layer. 
Bereiche, die nicht mit Daten gefüllt sind, werden weiß gezeichnet. 
Außerdem müssen Sie die Option <code>format</code> mit <code>'image/png'</code> belegen. 
Leaflet lädt ansonsten automatisch das Format <code>'image/jpeg'</code> und dieses Format 
unterstützt keine Transparenz.</p>
<p><img src="../Images/994.png" alt="Mehrere Layer, die über einen WMS-Service geladen wurde." /></p>
<p><em>Abbildung: Mehrere Layer, die über einen WMS-Service geladen wurde.</em></p>
<p><img src="../Images/994a.png" alt="Mehrere Layer, die über einen WMS-Service geladen wurde." /></p>
<p><em>Abbildung: Mehrere Layer, die über einen WMS-Service geladen wurde.</em></p>
<h3 id="ltilelayerwms-und-ltilelayer-zusammen-auf-einer-karte">L.tileLayer.wms und L.tileLayer zusammen auf einer Karte</h3>
<p>Das nachfolgende Beispiel zeigt Ihnen, wie Sie einen 
<code>L.tileLayer</code> mit einem <code>L.tileLayer.wms</code> kombinieren können.
<a href="#" id="Kartemitwarnhinweisendesdwd"></a></p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 7);
*L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*L.tileLayer.wms("https://maps.dwd.de/geoserver/dwd/wms",
*{
*format: 'image/png',
*transparent: true,
*layers:'dwd:Warngebiete_Kreise'
*}).addTo(mymap);
*L.tileLayer.wms("https://maps.dwd.de/geoserver/dwd/wms",
*{
*transparent: true,
*format: 'image/png',
*layers:'dwd:Warnungen_Gemeinden_vereinigt'
*}).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_990.html--&gt;  </code></pre>
<p>Für dieses Beispiel gilt das, was ich im vorherigen Beispiel bezüglich 
Transparenz und Format geschrieben habe. Zusätzlich müssen Sie darauf 
achten, dass Sie den <code>L.tileLayer</code> nicht über die <code>L.tileLayer.wms.Layer</code> 
Schicht legen. Der <code>L.tileLayer</code> ist nicht transparent. Er würde die 
<code>L.tileLayer.wms.Layer</code> Schicht vollständig abdecken.</p>
<p>Die nachfolgende Abbildung zeigt Ihnen die zwei 
<code>L.tileLayer.wms</code> Layer über dem <code>L.tileLayer</code> Layer.</p>
<p><img src="../Images/994b.png" alt="Zwei `L.tileLayer.wms` Layer über dem `L.tileLayer` Layer." /></p>
<p><em>Abbildung: Zwei <code>L.tileLayer.wms</code> Layer über dem <code>L.tileLayer</code> Layer.</em></p>
<blockquote>
<p><strong>Achtung:</strong>
Wenn auf Ihrer Karte
der Layer <code>dwd:Warnungen_Gemeinden_vereinigt</code> nicht angezeigt wird, kann es daran 
liegen, dass es zur Zeit keine Warnungen gibt.<br />
Dieser Layer enthält nur Daten, wenn aktuell Wetterwarnungen vorliegen.<br />
Die grünen Polygone – im Layer <code>dwd:Warngebiete_Kreise</code>  – die 
die Landkreise darstellen, werden dahingegen immer eingeblendet.</p>
</blockquote>
<h2 id="diesem-kapitel-haben-wir">In diesem Kapitel haben wir ...</h2>
<p>In diesem Kapitel haben Sie auf unterschiedliche Arten eine Karte erstellt. </p>
<p>In den nächsten Kapiteln werden wir diese Karte mit Elementen und Informationen füllen.</p><h1 id="die-karte-mit-daten-bestucken">Die Karte mit Daten bestücken</h1>
<p><a href="#" id="DieKarteMitDatenBestuecken"></a></p>
<p>Sie können eine digitale Karte mit Leaflet in ein HTML Dokument einbinden, 
Sie wissen was geografische Koordinaten sind und wie die Imagedateien 
für digitale Karten erstellt werden. Darauf aufbauend können wir nun in diesem 
Kapitel Ihre digitale Karte mit Geodaten füllen.</p>
<h2 id="diesem-kapitel-werden-wir">In diesem Kapitel werden wir ...</h2>
<p>Bisher haben wir ausschließlich Layer zur Karte hinzugefügt. 
Wie das <a href="#Kartemitwarnhinweisendesdwd">Beispiel mit den Warnhinweisen vom Deutschen Wetterdienst</a> 
im vorherigen Kapitel zeigt, 
können diese Layer dynamisch mit Daten bestückt werden. 
In diesem Kapitel zeige ich Ihnen nun, wie Sie selbst Layer 
mit Daten erstellen und als Schicht auf Ihrer Karte anzeigen können. 
Dabei verwenden wir einfache geometrische Objekte. 
Konkret sind dies Punkte, Linien und Polygone. </p>
<ul>
<li>Punkte und Marker:<br />
Das einfachste Objekt ist ein Punkt. Auf einer Landkarte wird ein Punkt mit 
Zahlen – den Koordinaten – beschrieben. In Leaflet gibt es neben dem Punkt 
noch ein komfortableres Element – nämlich den Marker.<br />
Auf einer realen Karte könnte ein Marker zum Beispiel einen 
interessanten Ort, also einen 
<a href="https://de.wikipedia.org/w/index.php?title=Point_of_Interest&amp;oldid=155530967">Point of Interest (POI)</a> 
darstellen. </li>
<li>Linien:<br />
Eine Linie besteht aus mindestens zwei Punkten die miteinander verbunden sind.<br />
Auf einer Landkarte könnte eine Linie zum Beispiel eine Straße darstellen. </li>
<li>Polygone:<br />
Ähnlich wie eine Linie besteht ein Polygon aus mehreren miteinander verbundenen 
Punkten. Zusätzlich ist beim Polygon auch der erste Punkt mit dem letzten Punkte 
verbunden. Somit stellt ein Polygon eine geschlossene Form dar.<br />
Auf einer realen Karte könnte ein Polygon zum Beispiel die Fläche eines 
Landes oder einer Stadt darstellen. </li>
</ul>
<p>Wie können Sie nun Punkte, Marker, Linien und Polygone auf Ihre Leaflet-Karte zeichnen? 
Das ist Thema dieses Kapitels. Außerdem erkläre ich Ihnen wie Sie die Objekte in 
Layer-Gruppen und Feature-Gruppen gruppieren können und welche Vorteile dies bringt. 
Nebenbei sehen wir uns an, wie Sie die Karte auch auf kleinen Displays passend anzeigen 
und wie Sie auf Ereignisse reagieren können.</p>
<h2 id="punkte-marker-linien-polygone-rechtecke-und-kreise-als-leafl">Punkte, Marker, Linien, Polygone, Rechtecke und Kreise als Leaflet Objekte</h2>
<p>Leaflet biete Ihnen jede Menge verschiedene Objekte. Beginnen wir mit den 
einfachsten – den Punkten und Markern.</p>
<h3 id="punkte-und-marker">Punkte und Marker</h3>
<p><a href="#" id="DieKarteMitDatenBestueckenPunkteundMarker"></a></p>
<p>Ich gehen noch einmal von unserer Basiskarte aus. 
Zur besseren Übersicht habe ich Ihnen das HTML-Grundgerüst dazu nachfolgend 
noch einmal abgedruckt.</p>
<pre><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
&lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
&lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
&lt;script&gt;
var mymap = L.map('mapid').setView([50.27264, 7.26469], 7);
L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;!--index_989.html--&gt;</code></pre>
<p>In der nächsten Abbildung sehen Sie die Karte, die angezeigt werden sollte, 
wenn Sie die vorhergehende HTML-Datei in einem Browser öffnen.</p>
<p><img src="../Images/993.png" alt="Eine einfache Leaflet Karte." /></p>
<p><em>Abbildung: Eine einfache Leaflet Karte - 700 Pixel hoch und Zoomstufe 7.</em></p>
<p>Diese Karte ist bisher nicht sehr spannend. 
Landkarten, die Straßen und Orte anzeigen, findet man wie Sand am Meer. 
Auf Ihrer Website geht es sicher um etwas Besonderes und so möchten Sie sicher 
auch einen besonderen Ort hervorheben oder ein besonderes Thema beschreiben. 
Beginnen wir mit einem besonderen Ort – beziehungsweise einem besonderen Punkt.</p>
<h4 id="punkte">Punkte</h4>
<p>Die Leaflet <a href="https://leafletjs.com/reference-1.3.4.html#point">Klasse <code>Point</code></a> 
stellt einen Punkt mit X- und Y-Koordinaten in <em>Pixeln</em> 
dar.</p>
<blockquote>
<p>Sie haben richtig gelesen. Bei einem Punkt arbeitet Leaflet nicht 
mit <em>geografischen</em> Koordinaten. Hier müssen Sie tatsächlich die <em>Pixel</em> der Grafik, 
mit die Karte angezeigt wird, angeben.</p>
</blockquote>
<p>Objekte vom Typ <code>Point</code> sind in Leaflet nicht zur Anzeige gedacht. 
Vielmehr wird mit Ihnen gearbeitet. Zum Beispiel gibt es die 
<a href="https://leafletjs.com/reference-1.3.4.html#map-panby">Methode <code>panBy</code>()</a>, 
mit der die Karte um eine gegebene Anzahl von Pixeln verschoben werden kann.</p>
<p>Sie merken schon. Ein Objekt vom Typ <code>Point</code> ist nicht das, was wir möchten, 
wenn wir eine geografische Stelle auf der Karte hervorheben möchten. 
Um einen Punkt als etwas Besonderes zu markieren, 
möchten Sie sicher eher einen Marker mit Informationen an dieser Stelle – 
also an den <em>geografischen</em> Koordinaten – anzeigen. 
Und für diesen Zweck bietet Leaflet ein spezielles Objekt – 
das <a href="https://leafletjs.com/reference-1.3.4.html#marker"><code>Marker</code>-Objekt</a>.</p>
<p>Im nachfolgenden Programmcode-Beispiel sehen wir uns zunächst kurz an, 
was Sie mit einem Punkt anstellen können.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var point = L.point(400, 600);
*mymap.panBy(point);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_988.html--&gt;</code></pre>
<p>Wenn Sie das vorhergehende HTML-Dokument in Ihrem Browser öffnen, 
müssen Sie ganz schnell gucken. Nur dann können Sie erkennen, 
dass die Karte unmittelbar nach dem Öffnen um 400 Pixel nach rechts und 600 Pixel 
nach unten geschoben wird.</p>
<blockquote>
<p>Anstelle von<br />
<code>var point = L.point(400, 600);</code><br />
<code>mymap.panBy(point);</code><br />
hätten Sie auch ganz einfach<br />
<code>mymap.panBy([400, 600]);</code><br />
oder<br />
<code>mymap.panBy(L.point(400, 600));</code><br />
schreiben können.  </p>
</blockquote>
<p>An dieser Stelle füge ich kein Bild ein, auf dem das Ergebnis dargestellt ist. 
Das Verschieben der Karte wäre auf diesem nicht zu erkennen.</p>
<h4 id="marker">Marker</h4>
<p>Die Leaflet <a href="https://leafletjs.com/reference-1.3.4.html#marker">Klasse <code>Marker</code></a> wird verwendet, 
um anklickbare und/oder verschiebbare <em>Symbole</em> auf einer Karte anzuzeigen. 
Die Klasse erweitert die 
<a href="https://leafletjs.com/reference-1.3.4.html#layer">Klasse <code>Layer</code></a>. 
In der Regel wird dieses anklickbare und/oder verschiebbare <em>Symbole</em> 
mit einem Pop-up Fenster erweitert, auf dem weitere Informationen zu 
der entsprechenden Stelle auf der Erde enthalten sind.</p>
<p>Machen wir mit einem einfachen Beispiel weiter und fügen einen Marker zu unserer 
bisher noch langweiligen Karte hinzu.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var myMarker = L.marker([50.27264, 7.26469],
*{
*title:"Gering",
*alt:"Ein schönes kleines Dorf auf dem Maifeld in der Eifel",
*draggable:true
*}
*).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_987.html--&gt;</code></pre>
<p>Was passiert hier? Mit dem Text 
<code>var myMarker = L.marker([50.27264, 7.26469])</code> 
haben wir ein <code>Marker</code>-Objekt, das an den Koordinaten <code>[50.27264, 7.26469]</code> 
angezeigt wird, instanziiert. Im weiteren haben wir die Optionen <code>title</code>, <code>alt</code> und 
<code>draggable</code> mit Werten belegt. 
Dabei setzen wir mit der Option <code>title</code> den Tooltip der erscheint, wenn Sie die 
Maus über den Marker bewegen, mit der Option <code>alt</code> setzen wir den Text für das 
<code>alt</code> Attribut des Marker Bildes und mit der Option <code>draggable</code> legen Sie fest, 
ob der Marker mithilfe der Maus auf der Karte bewegt werden kann – oder nicht.</p>
<p>Das <code>&lt;img&gt;</code>-Tag des Markers fügt Leaflet zur Anzeige wie folgt ins HTML-Dokument 
ein:</p>
<pre><code>&lt;img 
src="file:///var/www/html/.../marker-icon.png" 
class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive 
leaflet-marker-draggable"   

style="margin-left: -12px; 
margin-top: -41px; 
width: 25px; 
height: 41px; 
transform: translate3d(635px, 350px, 0px); 
z-index: 350; 
outline: currentcolor none medium;"  

title="Gering" 
alt="Ein schönes kleines Dorf auf dem Maifeld in der Eifel" 
tabindex="0"
&gt;</code></pre>
<p>Alle Optionen und Methoden, die Ihnen die Leaflet Klasse <code>Marker</code> bietet, 
können Sie in der <a href="https://leafletjs.com/reference-1.3.4.html#marker">Leaflet Dokumentation</a> nachlesen.</p>
<p>Im nächsten Bild sehen Sie den Marker in die Karte integriert. 
Als Bild wurde ein Standardbild verwendet, da wir die Option <code>icon</code> nicht gesetzt haben. 
Wie Sie ein benutzerdefiniertes Icon verwenden können, sehen wir uns 
in Kapitel <a href="#inCustomMarkers">Custom Markers</a> genauer an. 
In der Karte des vorhergehenden Beispiels können Sie den Marker 
im Browser mit der Maus bewegen, da die Option <code>draggable</code> auf <code>true</code> gesetzt wurde. 
Probieren Sie es aus!</p>
<p><img src="../Images/992.png" alt="Ein Marker auf einer Leaflet Karte." /></p>
<p><em>Abbildung: Ein Marker auf einer Leaflet Karte der mit der Maus verschoben werden kann.</em></p>
<blockquote>
<p>Sie müssen für 
einen Marker keine Variable instanziieren. Sie können den Marker
auch ganz einfach wie folgt zur Karte hinzufügen:  </p>
<pre><code>L.marker([50.27264, 7.26469],  
{ 
title:"Gering", 
alt:"Ein schönes kleines Dorf auf dem Maifeld in der Eifel", 
draggable:true 
}  
).addTo(mymap);</code></pre>
<p>Beachten Sie dabei aber das Folgende: Falls Sie den Marker später einmal
modifizieren möchten, benötigen Sie einen Namen. Andernfalls können
Sie den Marker nicht identifizieren und somit auch nicht zum Ändern
auswählen.</p>
</blockquote>
<h3 id="objekte-die-aus-mehr-als-einem-punkte-bestehen">Objekte, die aus mehr als einem Punkte bestehen</h3>
<h4 id="linien">Linien</h4>
<p>Linien können Sie in Leaflet mit der Klasse 
<a href="https://leafletjs.com/reference-1.3.2.html#polyline">Polyline</a> erstellen. 
Die Klasse <code>Polyline</code> erweitert die abstrakte Klasse 
<a href="http://leafletjs.com/reference-1.3.2.html#path">Path</a>. 
Diese Klasse ermöglicht es Ihnen eine einfache Linie oder mehrere 
aneinandergereihte Liniensegmente zu erstellen.</p>
<p>Im nachfolgenden Programmcodebeispiel habe ich den Text, 
der für die Erstellung des <code>Polyline</code> Objektes verantwortlich ist, mit einem Stern 
markiert.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var polyline = L.polyline([
*[50.27264, 7.26469],
*[51.27264, 7.26469],
*[51.27264, 6.26469]],
*{
*color: 'red', weight: 8
*}
*).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_986.html--&gt;</code></pre>
<p>Im Beispiel wird ein <code>Polyline</code>-Objekt instanziiert, 
das aus drei Punkten besteht. Außerdem werden die Optionen <code>color</code> und 
<code>weigth</code> verwendet. Diese Optionen erbt die Klasse <code>Polyline</code> von der Klasse <code>Path</code>. 
Konkret legen wir im Beispiel mit <code>color: 'red'</code> die Farbe der Linie fest – 
diese soll rot sein. Mit <code>weight: 8</code> bestimmen wir, dass die Linie 8 Pixel 
dick sein soll.</p>
<p>In der nächsten Abbildung sehen Sie genau diese Linie.</p>
<p><img src="../Images/991.png" alt="Ein Polyine-Objekt auf einer Leaflet Karte." /></p>
<p><em>Abbildung: Ein Polyline-Objekt auf einer Leaflet Karte.</em></p>
<h4 id="polygone">Polygone</h4>
<p><a href="#" id="DieKarteMitDatenBestueckenPolygone"></a></p>
<p>Ein Polygone ist eine geschlossene Linie – also eine Linie die 
einen <em>Innenbereich</em> von einem <em>Außenbereich</em> abtrennt. 
Mit der <a href="http://leafletjs.com/reference-1.1.0.html#polygon">Klasse <code>Polygone</code></a> 
können Sie, wie der Name schon sagt, <code>Polygone</code>-Objekte auf Ihre Karte zeichnen. 
Die Klasse <code>Polygone</code> erweitert die Klasse <code>Polyline</code> und somit auch die Klasse 
<code>Path</code>. Alle Methoden und Optionen dieser Klassen können Sie somit
mit einem <code>Polygone</code> Objekt nutzen.</p>
<blockquote>
<p>Die Punkte, die Sie
beim Erstellen eines Polygons übergeben, sollten als letzten Punkt
keinen Punkt enthalten, der dem ersten Punkt entspricht. 
Der erste und der letzte Punkt sollten nicht identisch sein! 
Es ist besser, solche Punkte herauszufiltern.<br />
Warum sollten der erste und der letzte Punkt nicht identisch sein? 
Leaflet schließt Ihr Polygon automatisch. 
Wenn der erste Punkt mit dem letzten Punkt
übereinstimmt, kann dies zu Problemen führen.  </p>
</blockquote>
<p>Wie Sie ein Polygon in Leaflet erstellen, zeigt Ihnen der nachfolgende 
Programmcode und das konkrete Polygon sehen Sie 
im darauf folgenden Bild. 
Alle Methoden und Optionen, die Sie auf ein <code>Polygon</code>-Objekt anwenden könne, 
finden Sie in der 
<a href="https://leafletjs.com/reference-1.3.4.html#polygon">Leaflet Dokumentation</a>.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var polygon = L.polygon([
*[50.27264, 7.26469],
*[51.27264, 7.26469],
*[51.27264, 6.26469]],
*{
*color: 'red', 
*weight:2, 
*fillColor:'green', 
*fillOpacity:0.5
*}
 ).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_985.html--&gt;</code></pre>
<p><img src="../Images/990.png" alt="Ein Polygone-Objekt auf einer Leaflet Karte." /></p>
<p><em>Abbildung: Ein <code>Polygone</code>-Objekt auf einer Leaflet Karte.</em></p>
<h3 id="rechtecke-und-kreise">Rechtecke und Kreise</h3>
<p>Um einen Kreis oder ein Rechteck zu erstellen benötigt man eigentlich 
keine eigene Klasse. Man könnten diese Formen mit der Klasse <code>Polygon</code> 
erzeugen. Beim Kreis wäre dies allerdings sehr mühselig und auch für ein Rechteck 
gibt es einfacherere Verfahrensweisen. 
Leaflet bietet deshalb für diese beiden Formen spezielle Klassen an.</p>
<p>Das Zeichnen von Rechtecken und Kreisen ist kein Hexenwerk. 
Der Vollständigkeit halber finden Sie in den nächsten beiden Kapiteln 
jeweils ein Beispiel für beide Formen.</p>
<h4 id="rechtecke">Rechtecke</h4>
<p>Der nachfolgende Programmcode zeigt Ihnen an einem Beispiel, 
wie Sie ein Rechteck – also ein Objekt vom 
<a href="https://leafletjs.com/reference-1.3.4.html#rectangle">Typ <code>Rectangle</code></a> – 
in eine Leaflet Karte einfügen.</p>
<pre><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
&lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
&lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
&lt;script&gt;
var mymap = L.map('mapid').setView([50.27264, 7.26469], 7);
L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
var myRectangle = L.rectangle([
[50.27264, 7.26469],
[51.27264, 6.26469]
],
{
color: "yellow", 
weight: 8, 
fillColor:"purple"
}
).addTo(mymap);
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;!--index_984.html--&gt;</code></pre>
<p>Als Parameter geben Sie für das Rechteck immer die diagonal versetzten 
beiden Ecken an. Dabei ist es egal, in welcher Reihenfolge Sie diese angeben.
Das Rechteck</p>
<p><code>var myRectangle = L.rectangle([</code><br />
<strong><code>[50.27264, 7.26469],</code></strong><br />
<strong><code>[51.27264, 6.26469]</code></strong><br />
<code>])</code>  </p>
<p>sieht auf der Karte genauso aus, wie das Rechteck</p>
<p><code>var myRectangle = L.rectangle([</code><br />
<strong><code>[51.27264, 6.26469],</code></strong><br />
<strong><code>[50.27264, 7.26469]</code></strong><br />
<code>])</code></p>
<p>Und wie das Rechteck des Beispiels aussieht, zeigt Ihnen die nachfolgende Abbildung.</p>
<p><img src="../Images/989rechteck.png" alt="Ein `Rectangle`-Objekt auf einer Leaflet Karte." /></p>
<p><em>Abbildung: Ein <code>Rectangle</code>-Objekt auf einer Leaflet Karte.</em></p>
<p>In diesem Zusammenhang ist vielleicht ganz interessant wie Leaflet das 
Koordinatensystem der Erde verarbeitet. Dieses Koordinatensystem ist ja kein 
gewöhnliches Koordinatensystem, sondern ein sphärisches. 
Unter einer 
<a href="https://de.wikipedia.org/w/index.php?title=Sph%C3%A4re_(Mathematik)&amp;oldid=178382030">Sphäre</a> 
versteht man in der Mathematik ganz vereinfacht ausgedrückt 
die Oberfläche einer Kugel. Und auf einer Kugel führen, im Gegensatz zu einer Ebene, 
immer zwei Linien auf direktem Wege von einem Punkt zu einem anderen Punkt. 
Man kann entweder auf der einen Seite der Kugel, oder auf der anderen Seite 
der Kugel die beiden Punkte verbinden.</p>
<p>Die nachfolgenden Abbildungen zeigen Ihnen, dass Leaflet dieses Problem vereinfacht. 
Es behandelt das sphärische Koordinatensystem als normales Koordinatensystem. 
Es schneidet den Pazifik einfach in der Mitte durch.
Dies hatten wir uns im Exkurs 
<a href="#DasKoordinatensystemderErde">Das Koordinagensystem der Erde</a> schon einmal angesehen.
Um von der Koordinate <code>[50, -180]</code> zur Koordinate <code>[51, 180]</code> zu gelangen, 
muss man mit Leaflet einmal um die ganze Erde laufen. 
Dabei liegen die beiden Punkte ganz dicht beieinander. 
Analog wird auch ein Rechteck mit diesen Eckpunkten, also mit den Eckpunkten 
<code>[50, -180]</code> und <code>[51, 180]</code>, um die ganze Erde gezeichnet. 
Und das, obwohl die Ecken hier ganz nah beieinander liegen.</p>
<p><img src="../Images/929a.png" alt="Um von der Koordinate `[50, -180]` zur Koordinate `[51, 180]` zu gelangen, muss man mit Leaflet einmal um die ganze Erde laufen. In der Mitte des Pazifik ist die Welt getrennt. Hier gibt es keine Verbindung." /></p>
<p><em>Abbildung: Um von der Koordinate <code>[50, -180]</code> zur Koordinate <code>[51, 180]</code> zu gelangen, muss man mit Leaflet einmal um die ganze Erde laufen. In der Mitte des Pazifik ist die Welt getrennt. Hier gibt es keine Verbindung.</em></p>
<hr />
<p><img src="../Images/929b.png" alt="Von der Koordinate `[50, -1]` zur Koordinate `[51, 1]` nimmt auch Leaflet die kürzeste Verbindung." /></p>
<p><em>Abbildung: Von der Koordinate <code>[50, -1]</code> zur Koordinate <code>[51, 1]</code> nimmt auch Leaflet die kürzeste Verbindung.</em></p>
<hr />
<p><img src="../Images/929c.png" alt="Um von der Koordinate `[90, 7]` zur Koordinate `[-90, 6]` zu gelangen, muss man mit Leaflet einmal um die ganze Erde laufen. In der Mitte des Pazifik ist die Welt getrennt. Hier gibt es keine Verbindung." /></p>
<p><em>Abbildung: Um von der Koordinate <code>[90, 7]</code> zur Koordinate <code>[-90, 6]</code> zu gelangen, muss man mit Leaflet einmal um die ganze Erde laufen. In der Mitte des Pazifik ist die Welt getrennt. Hier gibt es keine Verbindung.</em></p>
<hr />
<p><img src="../Images/929d.png" alt="Von der Koordinate `[1, 7]` zur Koordinate `[-1, 6]` nimmt auch Leaflet die kürzeste Verbindung." /></p>
<p><em>Abbildung: Von der Koordinate <code>[1, 7]</code> zur Koordinate <code>[-1, 6]</code> nimmt auch Leaflet die kürzeste Verbindung.</em></p>
<h4 id="kreise">Kreise</h4>
<p>Anhand des nachfolgenden Programmcode können Sie erkennen, 
wie ein Kreis – also ein Objekt vom 
<a href="https://leafletjs.com/reference-1.3.4.html#circle">Typ <code>Circle</code></a> – 
in eine Leaflet Karte eingefügt wird.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*L.circle(
*[50.27264, 7.26469],
*100000,
*{
*color: "red", 
*weight: 8, 
*fillColor:"green"
*}
*).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_983.html--&gt;</code></pre>
<p>Ein Kreis wird anhand seines Mittelpunktes und seines Radius definiert. 
Der Radius muss dabei in Metern angegeben werden. 
In den Beispielen habe ich den Rand mit 8 Pixel festgelegt. 
Diese Breite passt für die Zoom-Stufe 7. Probieren Sie doch einmal aus, 
wie der Rand aussieht, wenn Sie die Karte vergrößern. Sie werden feststellen, 
dass man irgendwann nur noch den Rand sieht und es wichtig sein könnte, 
dessen Größe immer relativ zur Zoom-Stufe zu setzen.</p>
<p><img src="../Images/988_kreis.png" alt="Ein `Circle`-Objekt auf einer Leaflet Karte." /></p>
<p><em>Abbildung: Ein <code>Circle</code>-Objekt auf einer Leaflet Karte.</em></p>
<h2 id="mehrere-poly-objekte-auf-einer-ebene">Mehrere Poly-Objekte auf einer Ebene</h2>
<p>In den vorhergehenden Beispielen haben wir jedes Element auf einem separaten Layer – 
also einer separaten Ebenen – abgebildet. 
Spätestens, wenn Sie selbst unterschiedliche Geodaten auf einer Karte darstellen 
möchten werden Sie sich wünschen, Objekte mit gleichen Eigenschaften auf einem 
Layer gruppieren zu können. Denn nur so können sie alle Elemente zusammen ansprechen.  </p>
<p>Stellen Sie sich vor, Sie möchten auf Ihrer Website Touren für 
Aktivurlauber beschreiben. Diese Touren sind unterteilt in 
Wanderer, Bergsteiger, Gipfelstürmer und Freikletterer. 
Auf der Karte kann ein Kunde Angebote für eine bestimmte Region heraus filtern. 
Hierzu muss er nur die Karte passend positionieren. 
Wenn Sie pro Touren-Typen einen Layer anlegen und die Touren entsprechend ihres 
Typs auf diesen Layern ablegen, können Sie es dem Kunden zusätzlich ermöglichen, 
nur die für ihn relevanten Touren einzublenden. 
Warum erkläre ich Ihnen dies an dieser Stelle? Alle Polyline-Objekte und 
alle Polygone-Objekte die zusammen definiert wurden, liegen automatisch zusammen 
auf einem eigenen separaten Layer.</p>
<p>Das Setzen von Klammern beim Arbeiten mit Polygon-Objekten und Polyline-Objekten, 
die mehrere Objekte gleichzeitig auf einem Layer erstellen, 
kann sehr herausfordernd sein.</p>
<ul>
<li>
<p>Sie müssen zum einen alle Objekte – Polyline oder Polygon – 
zusammen mit einer äußeren Klammer versehen.<br />
<strong><code>[</code></strong><br />
<code>[[50.17264, -7.26469], [49.27264, -6.26469]],</code><br />
<code>[[50.37264, -7.26469], [51.27264, -8.26469]]</code><br />
<strong><code>]</code></strong></p>
</li>
<li>
<p>Außerdem müssen Sie alle Punkte jedes einzelnen Objekts – Polyline oder Polygon – 
mit einer Klammer umgeben.<br />
<code>[</code><br />
<strong><code>[</code></strong><code>[50.17264, -7.26469], [49.27264, -6.26469]</code><strong><code>]</code></strong>,<br />
<strong><code>[</code></strong><code>[50.37264, -7.26469], [51.27264, -8.26469]</code><strong><code>]</code></strong><br />
<code>]</code>  </p>
</li>
<li>
<p>Und zuletzt werden auch die Koordinaten selbst noch eingeklammert.<br />
<code>[</code><br />
<code>[</code><strong><code>[</code></strong><code>50.17264, -7.26469</code><strong><code>]</code></strong>, <strong><code>[</code></strong><code>49.27264, -6.26469</code><strong><code>]</code></strong><code>],</code><br />
<code>[</code><strong><code>[</code></strong><code>50.37264, -7.26469</code><strong><code>]</code></strong>, <strong><code>[</code></strong><code>51.27264, -8.26469</code><strong><code>]</code></strong><code>]</code><br />
<code>]</code>  </p>
</li>
</ul>
<h3 id="mehrere-polyline-objekte-auf-einer-ebene">Mehrere Polyline Objekte auf einer Ebene</h3>
<p>In diesem Kapitel gibt es nun ein praktisches Beispiel. 
Der nachfolgende Programmcodeausschnitt zeigt Ihnen, wie Sie mit dem 
instanziieren eines Objekts mehrerer Polyline-Objekte auf eine Ebene zeichnen können. 
Und das die Polyline-Objekte alle auf einer Ebene liegen, 
beweise ich Ihnen gleichzeitig.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 300px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 15);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var multipolyline = L.polyline(
*[
*[
*[50.17264, -7.26469],
*[49.27264, -7.26469],
*[49.27264, -6.26469]
*],
*[
*[50.37264, -7.26469],
*[51.27264, -7.26469],
*[51.27264, -8.26469]
*]
*],
*{color: 'black'}).addTo(mymap);
*mymap.fitBounds(multipolyline.getBounds());
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_981.html--&gt;</code></pre>
<p>Was zeigt Ihnen dieses Beispiel? 
Zunächst einmal können Sie erkennen, dass das Erstellen mehrerer 
Polyline-Objekte zusammen möglich ist. 
Und das es auch einfacher ist erkennen Sie daran, dass Sie Optionen nur 
einmal zuweisen müssen. Beide Linien werden gleichzeitig schwarz gefärbt.  </p>
<p>Am meisten Vorteile bringt aber die Tatsache, dass beide Linien eine 
Ebene darstellen. Dies bedeutet, dass die Methode <code>fitBounds()</code> die beiden Linien 
als ein Objekt sieht und die Abgrenzungen dieses einen Objektes berechnet. 
Die <a href="http://leafletjs.com/reference-1.1.0.html#map-fitbounds">Methode <code>fitBounds()</code></a> 
verschiebt eine Karte an die Stelle, an der die übergebenen Koordinaten sich befinden, 
und setzt die Zoom-Stufe so, dass die Karte für die übergebenen Abgenzungen ideal 
angezeigt wird. Würden die beiden Linien nicht auf einer Ebenen liegen, 
wäre es komplizierter beide Linien gleichzeitig vollständig mit optimaler Zoom-Stufe 
anzuzeigen.</p>
<blockquote>
<p>Noch einmal zur Erinnerung:
Ein Objekt vom Typ <code>Polygon</code> und auch ein <code>Polyline</code>-Objekt ist eine Ebene – 
die beiden Klassen erweitern die Leaflet
<a href="http://leafletjs.com/reference-1.1.0.html#layer">Klasse Layer</a>.  </p>
</blockquote>
<p><img src="../Images/987.png" alt="Zwei Polyline-Objekte auf einer Ebene." /></p>
<p><em>Abbildung: Zwei Polyline-Objekte auf einer Ebene.</em></p>
<h3 id="mehrere-polygon-objekte-auf-einer-ebene">Mehrere Polygon-Objekte auf einer Ebene</h3>
<p>In diesem Kapitel zeige ich Ihnen ein Beispiel, 
bei dem mehrere Polygone zusammen erstellt werden.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var multipolygone = L.polygon(
*[
*[
*[50.17264, 7.26469],
*[49.27264, 7.26469],
*[49.27264, 6.26469]
*],
*[
*[50.37264, 7.26469],
*[51.27264, 7.26469],
*[51.27264, 8.26469]
*]
*],
*{color: 'black'})
*.addTo(mymap)
*.bindPopup("Wir sind auf einer Ebene");
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_982.html--&gt;</code></pre>
<p>In diesem Beispiel sehen Sie, wie Sie mit der 
<a href="https://leafletjs.com/reference-1.3.4.html#layer-bindpopup">Methode <code>bindPopup()</code></a> 
ein Pop-up Fenster zu einem Element hinzufügen können. 
Später im Buch werden Pop-up Fenster noch einmal Thema sein. 
An dieser Stelle habe ich die Methode gewählt, weil ich der Meinung bin, 
das diese hier gut passt.
Es gibt viele unzusammenhängende Flächen auf der Erde, 
für die die gleichen Informationen zutreffend sind. 
Zum Beispiel haben viele Länder Kolonien. 
Wenn nun alle zu einem Land gehörenden Gebiete als Polygon auf einem Layer 
zusammengefasst sind, dann ist es ein Leichtes, 
allen Gebieten eines Landes das gleiche Pop-up Fenster zuzuweisen. 
Und wenn Sie nun die ganze Welt auf Ihrer Karte abdecken möchten, 
dann können Sie sich den Vorteil dieser 
<a href="https://de.wikipedia.org/w/index.php?title=Layertechnik&amp;oldid=73960532">Layer-Technik</a> 
sicherlich gut vorstellen.</p>
<p>In der nächsten Abbildung sehen sie keine Ländergrenzen. 
Der Einfachheit halber habe ich mich auf zwei Dreiecke beschränkt.</p>
<p><img src="../Images/986.png" alt="Zwei Polygone-Objekte auf einer Ebene." /></p>
<p><em>Abbildung: Zwei Polygone-Objekte auf einer Ebene mit dem selben Pop-up.</em></p>
<h4 id="mehrere-sich-uberschneidende-polygon-objekte-auf-einer-ebene">Mehrere sich überschneidende Polygon Objekte auf einer Ebene</h4>
<p>Die Besonderheit bei einem Polygon ist, dass es einen Außen- und einen 
Innenbereich gibt. Das lesen Sie hier im Buch des Öfteren. 
Wenn Sie mehrere Polygone auf einem Layer zusammen erstellen, 
dann beeinflussen diese sich gegenseitig, wenn Flächen übereinander liegen. 
In der nachfolgenden Tabelle habe ich verschiedene Konstellationen mit Bild 
und Text aufgenommen. Anhand von Beispielen ist das Zusammenspiel 
der verschiedenen Bereiche meiner Meinung nach am leichtesten nachzuvollziehen.</p>
<p><img src="../Images/928a.png" alt="x" /></p>
<p><em>Abbildung:</em>  </p>
<p>Beginnen wir mit einem einfachen Polygone:  </p>
<pre><code>L.polygon([  
[ [1, 1], [1, 10], [10, 10], [10, 1] ]  
])</code></pre>
<hr />
<p><img src="../Images/928b.png" alt="x" /></p>
<p><em>Abbildung:</em>  </p>
<p>Wenn Sie innerhalb dieses Polygons ein weiteres Polygon zeichnen, 
dann wird der Innenbereich des ersten Polygon um die Fläche des zweiten 
Polygon verringert. Das zweite Polygon wird praktisch aus dem ersten 
Polygone ausgeschnitten.  </p>
<pre><code> L.polygon([  
 [ [1, 1], [1, 10], [10, 10], [10, 1] ],  
*[ [2, 2], [2, 5], [5, 5], [5, 2] ]  
 ])</code></pre>
<hr />
<p><img src="../Images/928c.png" alt="x" /></p>
<p><em>Abbildung:</em>  </p>
<p>In dieses zweite Polygon können Sie nun wiederum ein Polygon zeichnen. 
Nun wird diese Fläche wieder voll als Innenbereich gezeichnet.  </p>
<pre><code> L.polygon([  
 [ [1, 1], [1, 10], [10, 10], [10, 1] ],  
 [ [2, 2], [2, 5], [5, 5], [5, 2] ],  
*[ [3, 3], [3, 4], [4, 4], [4, 3] ] 
 ])</code></pre>
<hr />
<p><img src="../Images/928d.png" alt="x" /></p>
<p><em>Abbildung:</em>  </p>
<p>Zeichnen Sie nun ein weiteres Polygon, dass Innenbereich und 
Außenbereich gleichzeitig abdeckt, dann wird der abgedeckte 
Innenbereich zum Außenbereich - und umgekehrt.  </p>
<pre><code> L.polygon([  
 [ [1, 1], [1, 10], [10, 10], [10, 1] ],  
 [ [2, 2], [2, 5], [5, 5], [5, 2] ],  
 [ [3, 3], [3, 4], [4, 4], [4, 3] ],  
*[ [9, 9], [11, 9], [11, 11], [9, 11] ]  
 ])</code></pre>
<h2 id="daten-mit-layern-gruppieren">Daten mit Layern gruppieren</h2>
<p>Im vorherigen Kapitel haben Sie gesehen, dass Sie mehrere Polygone Objekte 
oder mehrere Polyline Objekte zusammen auf einem Layer positionieren können. 
Es wird sicher einmal vorkommen, dass Sie Elemente unterschiedlicher 
Typen auf einem Layer zusammen gruppieren möchten.</p>
<h3 id="layer-gruppen">Layer-Gruppen</h3>
<p><a href="#" id="DieKarteMitDatenBestueckenLayergruppen"></a></p>
<p>Die Leaflet <a href="https://leafletjs.com/reference-1.3.4.html#layergroup">Klasse <code>LayerGroup</code></a> 
wird verwendet, um mehrere Layer oder Ebenen zu gruppieren. 
So können Sie diese Ebenen wie eine Ebene behandeln. 
Wenn Sie ein Objekt vom Typ <code>LayerGroup</code> zur Karte hinzufügen, 
werden alle zur Gruppe gehörenden Layer zum Karten Objekt hinzugefügt.</p>
<p>Der nachfolgende Programmcodeausschnitt zeigt Ihnen, wie Sie ein Objekt vom 
Typ <code>LayerGroup</code>erstellen und zu Ihrem Karten Objekt hinzufügen können.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var marker1 = L.marker([50.27264, 7.26469],
*{
*title:"Marker1",
*alt:"Ich bin ein Marker"
*}
*).bindPopup('Marker1');

*var marker2 = L.marker([51.27264, 6.26469],
*{
*title:"Marker2",
*alt:"Ich bin ein anderer Marker"
*}
*).bindPopup('Marker2');

*var polyline = L.polyline(
*[
*[50.27264, 7.26469],
*[51.27264, 7.26469],
*[51.27264, 6.26469]
*],
*{
*color: 'red', 
*weight:8
*}
*);

*var myLayerGroup = 
*L.layerGroup([marker1, polyline])
*.addTo(mymap);

*myLayerGroup.addLayer(marker2);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;</code></pre>
<p>Im vorherigen Beispiel habe ich ein <code>Marker</code>-Objekt und ein Objekt vom 
Typ <code>Polyline</code> erstellt und beide zusammen auf dem Layer <code>myLayerGroup</code> gruppiert. </p>
<p>Sie können auch später noch Objekt zum <code>LayerGroup</code>-Objekt hinzufügen. 
Zum Beispiel so:</p>
<pre><code>var marker2 = L.marker([51.27264, 6.26469],  
{
title:"Marker2",
alt:"Ich bin ein anderer Marker" 
}
).bindPopup('Marker2');
myLayerGroup.addLayer(marker2);</code></pre>
<p>Entfernen können sie das <code>LayerGroup</code>-Objekt – und somit alle zu ihr 
gehörenden Objekt auf einen Schlag – mit der 
<a href="https://leafletjs.com/reference-1.3.4.html#layergroup-removelayer">Methode <code>removeLayer()</code></a>. 
Im vohergehenden vollständigen Beispiel konkret mit der Zeile  </p>
<p><code>myLayerGroup.removeLayer(polyline);</code>.</p>
<h3 id="feature-gruppen">Feature-Gruppen</h3>
<p>Die 
<a href="https://leafletjs.com/reference-1.3.4.html#featuregroup">Klasse-<code>FeatureGroup</code></a> 
erweitert die 
<a href="https://leafletjs.com/reference-1.3.4.html#layergroup">Klasse <code>LayerGroup</code></a>. 
Während die Klasse <code>LayerGroup</code> eher Methoden zum Gruppieren von Layern bereit 
stellt, geht es in der <code>FeatureGroup</code> hauptsächlich um das gemeinsame 
Verarbeiten von Ereignissen und das Hinzufügen von Stylen.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var marker1 = L.marker([50.27264, 7.26469],
*{
*title:"Marker1",
*alt:"Ich bin ein Marker"
*}
*);

*var marker2 = L.marker([51.27264, 6.26469],
*{
*title:"Marker2",
*alt:"Ich bin ein anderer Marker"
*}
*);

*var polyline = L.polyline(
*[
*[50.27264, 7.26469],
*[51.27264, 7.26469],
*[51.27264, 6.26469]
*],
*);

*var myfeatureGroup=L.featureGroup([marker1, polyline]).addTo(mymap);
*myfeatureGroup.bindPopup('Wir haben alle das gleiche Popup!');
*myfeatureGroup.setStyle({color:'red', opacity:0.5, weight:8})
*myfeatureGroup.addLayer(marker2);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_979.html--&gt;</code></pre>
<p>Analog zum Beispiel im Kapitel <a href="#DieKarteMitDatenBestueckenLayergruppen">Layergruppen</a> 
sehen Sie im 
vorhergehenden Programmcodeausschnitt, wie zwei Elemente erstellt 
und einem Objekt vom Typ <code>FeatureGroup</code> zugeordnet werden. 
Die <code>FeatureGroup</code>, wird dann zum Karten Objekt hinzugefügt und ein Aufruf 
der Methode <code>bindPopup()</code> beim <code>FeatureGroup</code>-Objekt fügt das 
Pop-up zu allen Objekten des <code>FeatureGroup</code>-Objektes hinzu.</p>
<p>Wenn Sie alle Elemente des <code>FeatureGroup</code>-Objekts rot färben möchten, 
reicht die Zeile</p>
<pre><code>myfeatureGroup.setStyle({color:'red'})</code></pre>
<p>aus.</p>
<p>Der Eintrag</p>
<pre><code>myfeatureGroup.on('click', function()
{
alert('Ein Gruppenmitglied wurde angeklickt!'); 
}
)</code></pre>
<p>würde bewirken, dass sich immer, wenn ein Element des <code>FeatureGroup</code>-Objektes 
angeklickt wird, ein Hinweisfenster öffnet.</p>
<p>Wenn Sie ein <code>FeatureGroup</code>-Objekt - inklusive Inhalt - 
mit einem Mausklick entfernen möchten, 
können Sie folgenden Text zu Ihrem Skript hinzufügen:</p>
<pre><code>myfeatureGroup.on('click', function()
{
myfeatureGroup.removeLayer(polyline);
}  
)</code></pre>
<h2 id="popups">Popups</h2>
<p>In diesem Kapitel geht es um Leaflet-Objekte vom 
Typ <a href="https://leafletjs.com/reference-1.3.4.html#popup"><code>Popup</code></a>. 
Mithilfe dieses Objekts können Sie 
[Pop-up Fenster] an bestimmten Stellen auf Ihrem Karten Objekt öffnen. 
Wenn Sie die 
<a href="http://leafletjs.com/reference-1.1.0.html#map-openpopup">Methode <code>openPopup()</code></a> 
einsetzten, um das Pop-up Fenster zu öffnen, 
stellt Leaflet sicher, dass nur ein Pop-up zur gleichen Zeit geöffnet ist. 
Ich empfehle Ihnen diese Methode einzusetzen, weil ich der Meinung bin, 
das das gleichzeitige Öffnen von mehreren Pop-up Fenstern nicht benutzerfreundlich ist. 
Nichtsdestotrotz kann es aber sein, dass Sie gerne mehrere Pop-up Fenster 
gleichzeitig anzeigen möchten. In diesem Fall müssen Sie das Pop-up Fenster 
mit der <a href="http://leafletjs.com/reference-1.1.0.html#map-addlayer">Methode <code>addLayer()</code></a> 
auf einem eigenen Layer einbinden.</p>
<p>So nun aber genug der Theorie. Sehen Sie sich das alles anhand des 
nachfolgenden Programmcodes – am besten auf praktische Weise – an.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
*var mymap = L.map('mapid', {closePopupOnClick: false})
*.setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var marker1 = L.marker([50.27264, 7.26469],
*{
*title:"Marker1",
*alt:"Ich bin Marker 1"
*}
*).addTo(mymap);

*var marker2 = L.marker([51.27264, 6.26469],
*{
*title:"Marker2",
*alt:"Ich bin Marker 2"
*}
*).addTo(mymap);

*marker1.bindPopu("&lt;h1&gt;Gering&lt;/h1&gt;&lt;p&gt;Ein kleines ...");
*marker2.bindPopup("&lt;h1&gt;Boisheim&lt;/h1&gt;&lt;p&gt;Ein kleines ...");

 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_978.html--&gt;</code></pre>
<p>Was zeigt Ihnen dieses Beispiel genau? Sie sehen, wie Sie 
zwei Marker erstellen und diesen beiden mit der Methode <code>bindPopup()</code> 
ein Pop-up Fenster hinzufügen könne. Wenn Sie den ersten Marker anklicken, 
dann öffnet sich das Pop-up Fenster dieses Markers. Wenn Sie danach den 
zweiten Marker anklicken, schließt sich das Pop-up Fenster des ersten Markers 
und das Pop-up Fenster des zweiten Markers wird aktiv.  </p>
<p>Vielleicht ist Ihnen aufgefallen, dass wir beim Karten Objekt die Option 
<code>closePopupOnClick</code> auf <code>false</code> gesetzt haben. 
Diese Option ist standardmäßig mit <code>true</code> belegt, was bedeutet, 
dass auch beim Klick auf eine beliebige Position auf der Karte ein eventuell 
offenes Pop-up Fenster von Leaflet automatisch geschlossen wird.</p>
<blockquote>
<p>Möchten Sie, dass das Pop-up Fenster zum Marker mit dem Namen <code>marker1</code> 
schon beim Öffnen der Karte angezeigt wird? Dann fügen Sie einfach den 
Text <code>marker1.openPopup();</code> am Ende Ihres Skripts an.</p>
</blockquote>
<p>Wie die Karte zum vorhergehenden Programmcodeausschnitt 
im Browser aussieht, sehen Sie in der nachfolgenden Abbildung.</p>
<p><img src="../Images/985.png" alt="Pop-ups auf einer Leaflet Karte." /></p>
<p><em>Abbildung: Pop-ups auf einer Leaflet Karte.</em></p>
<blockquote>
<p>Ich hatte Ihnen zu Beginn dieses Kapitels schon erklärt, dass Leaflet standardmäßig
nur ein Pop-up Fenster gleichzeitig offen anzeigt. Dies ist so, wenn Sie das
Pop-up Fenster mithilfe der 
Methode <code>openOn()</code> 
zur Karte hinzufügen:<br />
<code>var popup1 = L.popup({</code><strong><code>keepInView</code></strong><code>:true})</code><br />
<code>.setLatLng([49.27264, 6.26469])</code><br />
<code>.setContent('&lt;p&gt;Hallo Welt&lt;br /&gt;Ich bin ein Popup.&lt;/p&gt;')</code><br />
<code>.</code><strong><code>openOn</code></strong><code>(mymap);</code><br />
Falls Sie mehrere Pop-up Fenster
gleichzeitig anbieten möchte, dann können Sie dies mithilfe der
Methode <code>addTo()</code> bewerkstelligen.<br />
<code>var popup1 = L.popup()</code><br />
<code>.setLatLng([49.27264, 6.26469])</code><br />
<code>.setContent('&lt;p&gt;Hallo Welt&lt;br /&gt;Ich bin ein Popup.&lt;/p&gt;')</code><br />
<code>.</code><strong><code>addTo</code></strong><code>(mymap);</code>  </p>
</blockquote>
<p>Die Eigenschaft <code>keepInView:true</code> bewirkt hier übrigens, 
dass die Karte nur so weit verschoben werden kann, wie der Marker sichtbar ist.</p>
<h2 id="mobil">Mobil</h2>
<p>Ein großer Vorteil von JavaScript ist es, das Landkarten in jedem 
aktuellen Standardbrowser ohne notwendige externe Applikationen oder 
Plugins angezeigt werden können.</p>
<blockquote>
<p>Genaue Informationen zu den unterstützten
Browsern finden Sie auf der Website von 
<a href="https://leafletjs.com/index.html#features">Leaflet im Bereich Features</a>.</p>
</blockquote>
<p>Jede Website, die eine Leaflet Karte anzeigt, 
kann vom Entwickler auf die gleiche Art und Weise programmiert werden. 
Der Entwickler muss im Normalfall nichts Spezielles für ein Gerät beachtet. 
Ein paar erwähnenswerte Punkte gibt es aber trotzdem und das, 
was meiner Meinung nach erwähnenswert ist, finden Sie in diesem Kapitel.</p>
<p>Das Spannendste bei der Arbeit mit mobilen Anwendungen ist sicherlich 
die <a href="https://leafletjs.com/reference-1.3.4.html#map-locate">Funktion <code>locate()</code></a>. 
Diese Funktion versucht, den Benutzer mit der 
<a href="https://de.wikipedia.org/w/index.php?title=W3C_Geolocation_API&amp;oldid=173190043">W3C Geolocation API</a> 
zu lokalisieren. Die 
<a href="https://de.wikipedia.org/w/index.php?title=W3C_Geolocation_API&amp;oldid=173190043">W3C Geolocation API</a> 
ist eine einheitliche Webbrowser-Programmierschnittstelle zum Ermitteln des geografischen Standorts des zugehörigen Endgeräts. Aber beginnen wir von vorne mit dem Bereich HTML und CSS.</p>
<h3 id="html-und-css">HTML und CSS</h3>
<p>Sie möchten Ihre Leaflet Karte auch 
für mobile Geräte optimal konfigurieren? Dann sollten Sie als erstes sicherstellen, 
dass die Karte passend angezeigt wird. Sie möchten sicher nicht, 
dass jemand der die Karte über ein Gerät mit einem kleinen Display aufruft, 
nur einen Teil der Karte sieht und er diese erst verschieben muss, 
um auch die Randbereiche zu erkennen. Oder, dass die Karte so klein dargestellt wird, 
dass der Inhalt auf einem kleinen Display nicht lesbar ist. Ideal ist es, 
wenn die vollständige Karte im Display lesbar angezeigt wird. 
In diesem Punkt stimmen Sie mir sicher zu. Das nächste Beispiel zeigt Ihnen, 
wie Sie die vollständige Karte im Display lesbar angezeigen können.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;meta 
*name="viewport" 
*content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" 
*/&gt;
*&lt;style&gt;
*body {
*padding: 0;
*margin: 0;
*}
*html, body, #mapid {
*height: 100vh;
*width: 100vw;
*}
*&lt;/style&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.27264, 7.26469], 18);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
 mymap.locate({setView: true, maxZoom: 18});
*mymap.on('locationfound', onLocationFound);
*mymap.on('locationerror', onLocationError);

*function onLocationFound(e) {
*var radius = e.accuracy / 2;
*L.marker(e.latlng).addTo(mymap)
*.bindPopup("Sie sind etwa " + radius + " Meter von diesem Punkt entfernt.")
*.openPopup();
*L.circle(e.latlng, radius).addTo(mymap);
*}

*function onLocationError(e) {
*alert(e.message);
*}

 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_977.html--&gt;</code></pre>
<blockquote>
<p>Wissen Sie, dass Sie zum Debuggen die Methode <code>console.log()</code> verwenden können? 
Der Eintrag<br />
<code>&lt;script&gt;</code><br />
<code>...</code><br />
<code>console.log(e);</code><br />
<code>...</code><br />
<code>&lt;/script&gt;</code><br />
gibt an einer Stelle, an der das Objekt <code>e</code> instanziiert ist, 
den Inhalt dieses Objektes in der Konsole aus.<br />
Die Konsole können Sie im Browser 
<a href="https://www.mozilla.org/de/firefox/new/">Mozilla Firefox</a> 
über das Menü<br />
<code>Extras | Web Entwickler | Web Konsole</code> öffnen.<br />
Im Browser <a href="https://www.google.de/chrome/browser/desktop/index.html">Google Chrome</a> 
finden Sie die Konsole über das Menü 
<code>Tools | Javascipt-Konsole</code>.</p>
</blockquote>
<p>Dieses Beispiel enthält zusätzlich zu den vorhergehenden Beispielen 
ein <code>&lt;style&gt;</code>-Element. In diesem<code>&lt;style&gt;</code>-Element sind die Abstände, 
also <code>padding</code> und <code>margin</code>, auf <code>0</code> gesetzt. 
So passt die Karte sich genau an das Dispay an und es wird kein Platz 
mit Rändern verschwendet. Außerdem haben wir die Höhe mit <code>height: 100vh</code> auf 100 % 
gesetzt, damit diese voll ausgenutzt wird.</p>
<p>Die <a href="https://wiki.selfhtml.org/index.php?title=CSS/Wertetypen/Zahlen,_Ma%C3%9Fe_und_Ma%C3%9Feinheiten/Viewportabmessungen&amp;oldid=55341">Einheiten <code>vw</code> und <code>vh</code></a> 
definieren eine Breite - beziehungsweise Höhe - in Relation zur Größe
des Browser-Fensters. Dabei steht <code>vw</code> für die Breite und <code>vh</code> für 
die Höhe des Viewport. Diese Viewport Units ermöglichen es, Größen 
in Relation zur jeweils aktuellen Größe des Browser-Fensters zu 
definieren.</p>
<p>Den fixen Wert für die Höhe, der im <code>&lt;div&gt;</code>-Element des 
Karten-Objektes enthalten war, habe ich entfernt. 
So verschwindet auch die Bildlaufleiste am rechten Rand.</p>
<p>Außerdem ist in diesem Beispiel das Meta-Element <code>viewport</code> hinzu gekommen. 
Somit kann die Seite für mobile Geräte nicht künstlich verkleinert oder 
vergrößert werden – zoomen ist aber immer noch möglich!</p>
<blockquote>
<p>Bei die Anzeige auf mobilen Geräten spielt 
das Meta-Element <code>viewport</code> eine große Rolle. 
In unserm Beispiel haben wir die Attribute <code>initial-scale=1.0</code>, <code>maximum-scale=1.0</code>, 
und<code>user-scalable=no</code>verwendet.<br />
Das Attribut <code>initial-scale</code> legt die anfängliche Zoom-Stufe fest. 
<code>1.0</code> führt dazu, dass die Inhalte in ihrer Originalgröße
dargestellt werden. Das bedeutet, dass auf einem Display mit 320 
Pixel Breite, eine 320 Pixel breite Grafik die volle Breite 
ausfüllt. Im Gegensatz dazu würde der Wert <code>2.0</code> zu einer 2-fachen 
Vergrößerung führen – das Bild wäre dann nur noch
halb zu sehen.<br />
Das Attribut <code>user-scalable</code> bestimmt, ob der Nutzer die Anzeige 
der Website vergrößern oder
verkleinern kann.<br />
Die Attribute <code>minimum-scale</code> und <code>maximum-scale</code> ermöglichen es 
die Zoom-Stufe einzuschränken. Die Vorgabe <code>maximum-scale=1.0</code>, 
bewirkt, dass der Inhalt nicht vergrößert werden kann.</p>
</blockquote>
<h3 id="javascript">JavaScript</h3>
<p>Die Karte wird nun passend auf der Website angezeigt. 
Soweit so gut! Wir können die Karte aber noch benutzerfreundlicher machen. 
Jemand der mit einem mobilen Gerät im Internet unterwegs ist, 
nutzt sein Gerät in der Regel an verschiedenen Standorten. 
Und meistens ist es so, dass das, was in der Nähe ist, 
am interessantesten ist. Ideal wäre es also, wenn die Karte sich sofort so öffnet, 
dass der aktuelle Standort in der Mitte der Karte dargestellt wird. 
Das ist möglich und Leaflet bietet Ihnen Funktionen, die Sie nutzen können.</p>
<p>Wenn Sie eine Website besuchen, die standortbezogenes Surfen unterstützt – 
zum Beispiel die Leaflet Karte im Beispielcode – prüft der Browser, 
ob Sie Ihren Aufenthaltsort bekannt geben möchten. 
Wenn Sie zustimmen, berechnet der Browser Ihren Standort über nahe gelegene 
Funkzugangsknoten oder die IP-Adresse Ihres Computers. 
Diese ungefähre Ortsangabe wird dann an die anfragende Website weitergegeben.  </p>
<p>Wenn Sie Ihren Standort freigegeben haben, 
dann sehen beim Aufruf der Karte des letzten Beispiels einen Kreis, 
der Ihren ungefähren Standort wiedergibt und ein Pop-up Fenster, 
dass Ihnen erklärt wo Sie sich gerade befinden. 
Möchten Sie Ihren Standort nicht mit anderen teilen, 
dann sehen Sie eine Fehlermeldung beim Öffnen der Karte. 
Diese Fehlermeldung erklärt Ihnen, warum Sie nicht geortet werden können.  </p>
<p>Damit Sie sich auch Bild davon machen könne, 
wenn Sie das Beispiel gerade nicht praktisch nachvollziehen können, 
habe ich Ihnen Bilder eingefügt.</p>
<p><img src="../Images/984.png" alt="x" /></p>
<p><em>Abbildung: Wenn Sie eine Website besuchen, die standortbezogenes Surfen unterstützt prüft der Browser, ob Sie Ihren Aufenthaltsort bekannt geben möchten.</em></p>
<hr />
<p><img src="../Images/984a.png" alt="" /></p>
<p><em>Abbildung: Möchten Sie Ihren Standort nicht mit anderen teilen, dann sehen Sie eine Fehlermeldung beim Öffnen der Karte. Diese Fehlermeldung erklärt Ihnen, warum Sie nicht geortet werden können.</em></p>
<hr />
<p><img src="../Images/984b.png" alt="x" /></p>
<p><em>Abbildung: Wenn Sie Ihren Standort freigegeben haben, dann sehen beim Aufruf der Karte des letzten Beispiels einen Kreis, der Ihren ungefähren Standort wiedergibt und ein Pop-up Fenster, dass Ihnen erklärt wo Sie sich gerade befinden.</em></p>
<hr />
<p>Leaflet bietet Ihnen noch weitere 
<a href="https://leafletjs.com/reference-1.1.0.html#map-geolocation-methods">Geolokalisierungsmethoden</a> 
und 
<a href="http://leafletjs.com/reference-1.1.0.html#locationevent">Geolokalisierungsereignisse</a> an.</p>
<h2 id="ereignisse-leaflet">Ereignisse in Leaflet</h2>
<p>Bisher haben wir ausschließlich mit statischen Daten gearbeitet. 
In der Welt passiert aber fortwährend ganz schön viel und Sie möchten sicherlich mit 
Ihrer Karte auf das ein oder andere Ereignis reagieren. 
Vielleicht möchten Sie je nach Standort einen Pop-up Text ändern. 
Oder Sie möchten auf ein anderes Ereignis reagieren. 
Vielleicht wissen Sie auch noch gar nicht so genau auf welche Ereignisse Sie reagieren können. 
Dann sehen Sie sich zur Inspiration doch einfach einmal an, 
was Leaflet Ihnen bietet. 
Insgesamt bietet Leaflet Ihnen 34 verschiedene Ereignisse, 
die sie nutzen können. Alle Ereignisse sind in 
der <a href="http://leafletjs.com/reference-1.1.0.html#events">Dokumentation</a> gut erklärt.</p>
<p>Exemplarisch sehen wir uns mit dem folgenden Programmcode – wieder anhand 
eines ganz einfache Beispiels – die Vorgehensweise genauer an. 
Konkret reagieren wir auf einen Mausklick.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*mymap.on('click', function()
*{
*alert('Sie haben auf die Karte geklickt.')
*}
*);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_976.html--&gt;</code></pre>
<p>Leaflet bietet die 
<a href="http://leafletjs.com/reference-1.1.0.html#evented-on">Methode <code>on()</code></a> 
um auf ein Ereignis zu reagieren. Der erste Parameter, der mit dieser Methode 
übergeben wird, steht für den Ereignistyp. In unserem Falle ist dies <code>click</code>. 
Der zweite Wert erwartet eine Funktion, die beim Eintreten des Ereignisses 
ausgeführt werden soll.</p>
<blockquote>
<p>In unserem Beispiel haben wir die Funktion sofort in den Methodenaufruf eingefügt:  </p>
<pre><code>mymap.on('click',  
function(){  
alert('Sie haben auf die Karte geklickt.')  
}  
);</code></pre>
<p>Diese Schreibweise wird auch 
als anonymer Funktionsausdruck bezeichnet,
weil die Funktion keinen Namen hat.</p>
</blockquote>
<p>Wenn Sie die Karte des vorhergehenden Beispiels im Browser aufrufen und anklicken, 
sehen Sie die in der nachfolgenden Abbildung dargestellte Meldung.</p>
<p><img src="../Images/983.png" alt="x" /></p>
<p><em>Abbildung: Eine Leaflet Karte, die ein Pop-up Fenster anzeigt, wenn sie mit der Maus angeklickt wird.</em></p>
<h3 id="eine-benutzerdefinierte-funktionen">Eine benutzerdefinierte Funktionen</h3>
<p>Die Methoden, die Leaflet Ihnen bietet, kennen Sie nun. 
Bisher haben Sie immer die Variable <code>e</code> in den Funktionen übergeben. 
Mit JavaScript können Sie aber auch eigene Variablen übergeben. 
Außerdem können Sie eigene Funktionen an beliebigen Stellen im Programmcode aufrufen.</p>
<p>Probieren wir das doch sofort einmal aus. Im nächsten Beispiel erstellen wir einen 
Marker und verbinden diesen mit einem Pop-up Fenster – und das mithilfe einer 
selbst erstellten Funktion.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);

*var marker1 = L.marker([50.27264, 7.26469])
*.addTo(mymap).bindPopup(createPopup("Text als Parameter"));

*var marker2 = L.marker([51.27264, 6.26469])
*.addTo(mymap).bindPopup(createPopup("Anderer Text als Parameter"));

*function createPopup(popuptext){
*return L.popup(
*{autoClose:false, keepInView:true, closeButton:false
*}
*).setContent(popuptext);
*}
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_975.html--&gt;</code></pre>
<p>In diesem Beispiel ging es nur um das Grundsätzliche. Die Mächtigkeit von eigenen 
Funktionen wird mit nur zwei Markern vielleicht noch nicht klar. 
Sie können sich aber sicher vorstellen, wie viel Text mithilfe einer 
benutzerdefinierten Funktion eingespart werden kann, wenn wir ganz viele Marker mit den gleichen 
Optionen zur Karte hinzufügen.</p>
<blockquote>
<p>Achtung: Wenn Sie bei einem Pop-up Fenster die Eigenschaften 
<code>autoClose:false</code> und <code>closeButton:false</code> gleichzeitig setzten, 
kann dieses Pop-up Fenster tatsächlich nicht
mehr geschlossen werden.</p>
</blockquote>
<p><img src="../Images/982.png" alt="x" /></p>
<p><em>Abbildung: Eine Leaflet Karte, die zwei Marker anzeigt, die über eine benutzerdefinierte Funktion hinzugefügt wurden.</em></p>
<h3 id="ein-interaktives-beispiel">Ein interaktives Beispiel</h3>
<p>Und zu guter Letzt möchte ich Ihnen noch ein interaktives Beispiel zeigen.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
*&lt;p&gt;Bitte geben Sie eine Koordinte an:&lt;/p&gt;&lt;br&gt;
*Geographische Breite:&lt;input type="text" id="lat"&gt;&lt;br&gt;
*Geographische Länge:&lt;input type="text" id="long"&gt;&lt;br&gt;
*Name:&lt;input type="text" id="name"&gt;&lt;br&gt;
*&lt;button onclick="save()"&gt;Speichern&lt;/button&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*function save()
*{
*var p1 = parseFloat(document.getElementById("lat").value);
*var p2 = parseFloat(document.getElementById("long").value);
*L.marker([p1,p2]).bindPopup(document.getElementById("name").value)
*.addTo(mymap);
*}
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_974.html--&gt;</code></pre>
<p>Im vorhergehenden Beispiel ist eine Schaltfläche integriert, 
die – wenn sie angeklickt wird – eine benutzerdefinierte Funktion ausführt. 
Mit der Funktion wird ein Marker mit einem Pop-up Fenster in die Karte eingesetzt. 
Dies ist nur als Beispiel gedacht. Die können in der benutzerdefinierten Funktion 
alles Mögliche ausführen – lassen Sie Ihrer Fantasie freien Lauf. 
Ein weiterer Anwendungsfall könnte eine Art Heiß-Kalt Spiel sein. 
Sie kennen sicher das einfache Suchspiel.</p>
<blockquote>
<p>Möchten Sie die interaktiv eingefügten Daten in einem Objekt speichern, 
um einen Überblick über diese zu haben und eventuell weitere Aktionen von 
dem Datenbestand abhängig zu machen?<br />
Das vorhergehende Beispiel könnten Sie in diesem Falle wie folgt erweitern. 
Sie könnten mithilfe der Zeile<br />
<code>var myStorage = localStorage;</code><br />
ein <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage">localStorage Objekt</a> 
instanziieren. Mit </p>
<pre><code>myStorage.setItem(
document.getElementById("name").value,
document.getElementById("lat").value + 
"," + 
document.getElementById("long").value
);</code></pre>
<p>können Sie daraufhin alle eingefügten Objekte speichern und mit diesen arbeiten.<br />
Die <code>sessionStorage</code>-Eigenschaft
erlaubt den Zugriff auf ein, nur während der aktuellen Sitzung,
verfügbares Storage-Objekt. <code>sessionStorage</code> ist mit einer Ausnahme 
identisch zu <code>Window.localStorage</code>:<br />
In <code>localStorage</code> gespeicherte Daten besitzen kein Verfallsdatum, während sie 
im <code>sessionStorage</code> mit Ablauf
der Sitzung gelöscht werden.<br />
Eine Sitzung endet mit dem
Schließen des Browsers, sie übersteht das Neuladen und
Wiederherstellen einer Webseite. Das Öffnen einer Webseite in einem
neuen Tabulator oder Browser-Fenster erzeugt jedoch eine neue
Sitzung. Dies unterscheide ein 
<a href="&lt;https%3A//developer.mozilla.org/de/docs/Web/API/Window/sessionStorage"><code>sessionStorage</code>-Objekt</a> 
von einem <code>Session-Cookie</code>.</p>
</blockquote>
<h2 id="diesem-kapitel-haben-wir">In diesem Kapitel haben wir ...</h2>
<p>In diesem Kapitel haben Sie Punkte, Marker, Linien und Polygone kennen gelernt. 
Sie können diese nun auf eine Leaflet-Karte zeichnen und wissen, 
wann welches Objekt das richtige Objekt ist. Sie können Layer-Gruppen und 
Feature-Gruppen voneinander unterscheiden und wissen die Grundlagen zur Anzeige 
von mobilen Leaflet Karten. Und auf einen Mausklick oder ein anderes Ereignis 
können Sie entsprechend reagieren.  </p>
<p>Im nächsten Kapitel geht es um das Format GeoJson und darum, wie Sie Daten 
auch in großen Mengen gut handhaben können.</p><h1 id="geojson">GeoJSON</h1>
<p><a href="#" id="GeoJSON"></a></p>
<p>Im letzten Kapitel haben Sie Punkte, Marker, Linien und Polygone kennengelernt. 
Sie können diese nun auf eine Leaflet-Karte zeichnen und wissen, wann welches 
Objekt das Richtige ist. 
Sie können <a href="https://leafletjs.com/reference-1.3.4.html#layergroup">Layer-Gruppen</a> und 
<a href="https://leafletjs.com/reference-1.3.4.html#featuregroup">Feature-Gruppen</a> 
voneinander abgrenzen und Sie wissen, was bei der Anzeige einer Leaflet Karten auf 
einem kleinen Display zu beachten ist. 
Außerdem können Sie nun auf einen Mausklick oder ein anderes Ereignis 
entsprechend reagieren.<br />
Im nächsten Kapitel geht es um das Format 
<a href="https://de.wikipedia.org/wiki/GeoJSON">GeoJson</a> und darum, wie 
Sie Daten auch in großen Mengen gut handhaben können.</p>
<p><a href="https://de.wikipedia.org/wiki/GeoJSON">GeoJSON</a> ist ein offenes Format, 
welches es einfach macht, 
geografische Daten zu beschreiben. Dabei richtet es sich nach einer Spezifikation – 
nämlich nach der 
<a href="https://de.wikipedia.org/wiki/Simple_Feature_Access">Simple-Feature-Access-Spezifikation</a>. 
Für die Beschreibung der Geodaten verwendet GeoJSON 
die <a href="https://de.wikipedia.org/wiki/JavaScript_Object_Notation">JavaScript Objekt Notation (JSON)</a>.</p>
<blockquote>
<p>Hinter dem Begriff <a href="https://de.wikipedia.org/wiki/Simple_Feature_Access">Simple-Feature-Access-Spezifikation</a> 
versteckt sich eine Spezifikation des 
<a href="https://de.wikipedia.org/wiki/Open_Geospatial_Consortium">Open Geospatial Consortium (OGC)</a>. 
Diese Spezifikation beinhaltet eine allgemein gültige Beschreibung für 
Geodaten und deren Geometrien. Dadurch, dass die Spezifikation allgemeingültig ist, 
können diese Daten gut ausgetauscht werden. Das OGC ist eine gemeinnützige Organisation, 
die die Entwicklung von allgemeingültigen Standards für Geodaten zum Ziel hat.</p>
</blockquote>
<h2 id="diesem-kapitel-werden-wir">In diesem Kapitel werden wir …</h2>
<p>Als Erstes sehen wir uns an, warum GeoJSON entwickelt wurde. 
Als Nächstes vergleichen wir die einzelnen GeoJSON Elemente mit den Objekten, die uns 
Leaflet zur Verfügung stellt. 
Und zu guter Letzt probieren wir die Methoden aus, die Leaflet uns spezielle für 
das Verarbeiten von GeoJSON-Daten anbietet.</p>
<h2 id="die-entwicklungsgeschichte-von-geojson">Die Entwicklungsgeschichte von GeoJSON</h2>
<p><a href="#" id="inEntwicklungsgeschichteGejson"></a></p>
<p><a href="https://de.wikipedia.org/wiki/GeoJSON">GeoJSON</a> baut auf 
<a href="https://de.wikipedia.org/wiki/JavaScript_Object_Notation">JSON</a> auf. 
Bevor JSON als Datenformat spezifiziert wurde, gab es die erweiterbare 
Auszeichnungssprache <a href="https://de.wikipedia.org/wiki/Extensible_Markup_Language">XML</a> 
(englisch: Extensible Markup Language).  </p>
<p>Immer wenn etwas Neues entsteht, gibt es einen Grund dafür!</p>
<p>XML wurde <a href="https://www.w3.org/TR/1998/REC-xml-19980210">1998 veröffentlicht</a>, 
um Daten zwischen Maschinen austauschen zu können, 
ohne das Menschen nacharbeiten müssen. 
Dies wurde in Zeiten des Internets immer wichtiger. 
Nun muss es auch einen Grund geben, warum neben XML erst JSON – und später GeoJSON entstanden ist.</p>
<h3 id="warum-ist-das-format-geojson-entstanden">Warum ist das Format GeoJSON entstanden?</h3>
<p>Warum ist das Format GeoJSON entstanden? Offensichtlich gab es Dinge, bei denen XML für den 
Austausch von Daten nicht optimal war. 
Warum war dies so und welche Vorteile bietet JSON, beziehungsweise GeoJSON? 
Zunächst einmal bieten alle drei Formate folgendes:</p>
<ul>
<li>Alle drei Formate können von einem Menschen gelesen und verstanden werden. </li>
<li>Alle drei Formate sind hierarchisch gegliedert. Das bedeutet, das Werte innerhalb von anderen Werten dargestellt werden können. </li>
<li>Alle drei Formate sind relativ leicht zu erlernen. </li>
<li>Alle drei Formate können von vielen Programmiersprachen analysiert und genutzt werden. </li>
<li>Alle drei Formate sind mit mithilfe des Hypertext Transfer Protokolls (HTTP) – also über das Internet – austauschbar. </li>
</ul>
<p>Sehen wir uns in diesem Kapitel die einzelnen Formate einmal genauer an um zu erkennen, 
welche Vorteile das Format JSON – beim Arbeiten mit 
<a href="https://de.wikipedia.org/wiki/Geodaten">Geodaten</a> das Format GeoJSON – gegenüber XML bringt.</p>
<h4 id="xml">XML</h4>
<p>XML beschreibt die Struktur von Daten. 
Anhand der <em>Tags</em> wird den Daten eine Bedeutung – eine 
<a href="https://de.wikipedia.org/wiki/Semantik">Semantik</a>  – gegeben. 
Durch das Tag-System von XML werden oft kleine Datenbestände sehr aufgebläht und 
dadurch unübersichtlich. 
Außerdem ist das Ansprechen einzelner Tags in einer XML-Datei teilweise recht kompliziert.</p>
<h4 id="json">JSON</h4>
<p>JSON ist im Grunde genommen nichts anderes als die Festlegung auf eine bestimmte Syntax – 
also eine <em>Syntax-Konvention</em>. Den Daten wird keine bestimmte Bedeutung geben, 
vielmehr geht es um die syntaktische Anordnung. 
Da JSON Daten strukturiert, können leicht Objekte aus diesen Daten definiert werden.
JSON wird fortwährend weiterentwickelt. Im Dezember 1999 wurde die erste JSON Format-Spezifikation verabschiedet. 
Aktuell wird es durch zwei konkurrierende Standards spezifiziert, 
<a href="https://tools.ietf.org/html/rfc8259">RFC 8259</a> und 
<a href="http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf">ECMA-404</a>.</p>
<p>Der große Vorteil von JSON im Vergleich zu XML liegt in der einfachen Handhabung. 
Da JSON selbst gültiges Javascript darstellt, kann es direkt ausgeführt und somit 
in ein Javascript-Objekt überführt werden. 
Auf die einzelnen Eigenschaften dieser Objekte kann dann über die Attribute zugegriffen werden. 
Im Kapitel <a href="#HeatmapsundChoroplethenkarten">Heatmaps in Leaflet – Dichte</a> 
werden wir eine Datei, die GeoJSON Objekte enthält, als Skript einbinden. 
Allein durch das Einbinden der Datei können wir innerhalb anderer Skripte 
auf die GeoJSON Objekte der eingebundenen Datei zugreifen. 
Im Gegensatz dazu muss eine XML-Datei erst mit einem XML-Parser analysiert werden.  </p>
<p>Ein weiterer Vorteil von JSON: In JSON gibt es kein Ende-Tag. 
Hauptsächlich deshalb ist JSON kompakter. Dies hat nämlich zur Folge, 
dass JSON schneller gelesen und verarbeitet werden kann.</p>
<blockquote>
<p>Die Daten einer
jeden GeoJson-Datei, die sich in einem GitHub Repository befindet,
werden – wenn man die Datei im Repository anklickt – automatisch
auf einer interaktiven Karte angezeigt. 
<a href="https://github.com/blog/1528-there-s-a-map-for-that">Github</a> 
erstellt diese Karten schon seit 2013 mit Leaflet. Dies können Sie
sich beispielsweise im Repository 
<a href="https://github.com/astridx/world.geo.json/blob/master/countries.geo.json">world.geo.json</a> ansehen.</p>
</blockquote>
<p>Schon ein kleines Beispiel veranschaulicht, 
dass XML für das Beschreiben des gleichen Objektes mehr Zeichen benötigt als JSON. 
Ein, in XML mit 95 Zeichen kodiertes, Objekt benötigt in JSON gerade einmal 
73 Zeichen. Bei einem Objekt ist dieser Unterschied vernachlässigbar. 
In der Regel werden aber eine Vielzahl von Objekten digital beschrieben. 
Bei einer Vielzahl von Objekten kann dieser Unterschied stark ins Gewicht fallen.</p>
<p>Hier sehen Sie zunächst den aus 95 Zeichen bestehende XML Ausschnitt.</p>
<pre><code>&lt;joomlers&gt;
  &lt;number&gt;1721&lt;/number&gt;
  &lt;vorname&gt;Astrid&lt;/vorname&gt;  
  &lt;nachname&gt;Günther&lt;/nachname&gt;
&lt;/joomlers&gt;</code></pre>
<p>Das gleiche Objekt kann mit 73 Zeichen im JSON Format beschrieben werden.</p>
<pre><code>„joomlers“: {  
„number“: „1721“,
„vorname“: „Astrid“,  
„nachname“: „Günther“
},</code></pre>
<h4 id="und-warum-nach-json-nun-auch-noch-geojson">Und warum nach JSON nun auch noch GeoJSON?</h4>
<p>Geodaten könnten in JSON beschrieben und verarbeitet werden. 
Welchen Vorteil bringt das spezielle <strong>Geo</strong>JSON-Format? 
GeoJSON ist JSON – allerdings auf Geodaten spezialisiert. 
GeoJSON gibt den Geodaten wieder eine Semantik – also eine Bedeutung. 
Nun fragen Sie sich sicher, was dieses Hin und Her soll. Macht das Sinn? 
Ja, es macht Sinn: GeoJSON pickt sich nur die positiven Eigenschaften der 
Formate JSON und XML heraus. </p>
<p>GeoJSON beschreibt Punkte, Linien und Polygone und kann gut mit diesen 
Formen in einem Koordinatensystem gut umgehen. 
Im vorausgehenden Kapitel haben wir gesehen, 
dass das Arbeiten mit Geodaten im Grunde genommen nichts anderes ist.<br />
GeoJSON hat sich zu einem sehr beliebten Datenformat vieler 
Geoninformationssysteme entwickelt. In diesem Buch erwähne ich GeoJSON speziell, 
weil auch Leaflet sehr gut im Umgang mit Daten im GeoJSON Format ist. 
Hier sehen wir uns zunächst die GeoJSON Objekte einmal genauer an. 
Wenn Sie lieber sofort praktisch arbeiten möchten, dann Blättern Sie am besten 
ein Kapitel weiter. Im Kapitel <a href="#GeoJsoninLeaflet">GeoJSON in Leaflet</a> 
erfahren Sie, wie Sie GeoJSON-Elemente auf Ihrer Karte anzeigen und weiter 
bearbeiten können.  </p>
<p>Zur zeitlichen Einordnung: GoeJSON ist noch recht jung. </p>
<ul>
<li>Im Juni 2008 wurde die erste GeoJSON Format-Spezifikation verabschiedet. </li>
<li>Im August 2016 wurde die <a href="http://geojson.org/">RFC (Requests for Comments) 7946</a> veröffentlicht.</li>
</ul>
<blockquote>
<p>Die formale Spezifikation des GeoJSON Formates finden Sie unter der 
Adresse <a href="https://tools.ietf.org/html/rfc7946">https://tools.ietf.org/html/rfc7946</a> 
im Internet.</p>
</blockquote>
<h3 id="geojson-erkunden">GeoJSON erkunden</h3>
<p>Sie wissen nun, dass Sie mit GeoJSON viele geografische Datenstrukturen 
in einer maschinenlesbaren Sprache kodieren können. 
Ein GeoJSON-Objekt kann dabei eine einfache Geometrie, 
zum Beispiel einen Punkt eine Linie oder ein Polygon, darstellen. 
Zusätzlich können Sie einer Geometrie aber auch eine Bedeutung geben. 
Sie können jedem Element Eigenschaften zuordnen. Zum Beispiel können Sie einer 
Linie die Eigenschaft <code>typ=straße</code> oder <code>name=Kirchstraße</code> mitgeben. 
In diesem Fall erstellen Sie ein GeoJSON Objekt vom Typ 
<a href="https://tools.ietf.org/html/rfc7946#section-3.2">Feature</a>. 
Wenn Sie mehrere Feature-Objekte zu einer Gruppe zusammen fassen möchten, 
können Sie diese zu einer Sammlung von Features zusammen fassen. 
Hierfür gibt es den GeoJSON Typ 
<a href="https://tools.ietf.org/html/rfc7946#section-3.3">FeatureCollection</a>. 
Das Verständnis dieser Konzepte bringt viele Vorteile. 
Es hilft Ihnen auch, die Arbeit mit Geodaten im Allgemeinen zu verstehen: 
Die Grundkonzepte, die in GeoJSON angewandt werden, 
sind schon seit vielen Jahren ein Teil 
von <a href="https://de.wikipedia.org/wiki/Geoinformationssystem">Geoinformationssystemen</a>. 
Beginnen wir aber von vorne.</p>
<h4 id="eine-geometrie">Eine Geometrie</h4>
<p>Eine <a href="https://de.wikipedia.org/w/index.php?title=GeoJSON&amp;oldid=183228442#Geometrien">Geometrie</a> 
ist eine Form. 
Alle Formen in GeoJSON werden mit einer oder mehrerer Koordinaten beschrieben. 
Eine Koordinate heißt in GeoJSON <em>Position</em>.  </p>
<p>GeoJSON unterstützt die Geometriearten  </p>
<ol>
<li>Point,   </li>
<li>LineString,   </li>
<li>Polygon,   </li>
<li>MultiPoint,   </li>
<li>MultiLineString, und   </li>
<li>MultiPolygon </li>
</ol>
<p>– und eine jede dieser Geometriearten beinhaltet Positionen.</p>
<h5 id="position">Position</h5>
<p>Das wichtigste Element beim Arbeiten mit Geodaten ist die Beschreibung des 
Punktes auf der Erde. 
Der Punkt auf der Erde ist der, dem die Geodaten zugeordnet werden. 
Diesen Wert kennen wir auch unter dem Namen Koordinate. 
Im Kapitel <a href="#DasKoordinatensystemderErde">Das Koordinatensystem der Erde</a> 
habe ich schon eine ganze Menge zum Thema Koordinaten auf der Erde geschrieben. 
Hier noch einmal kurz: Eine Koordinate ist eine Zahlenkombination. 
Jede Zahl einer Koordinate steht für eine Dimension. 
Wir beschränken uns in diesem Buch auf zwei Dimensionen, 
nämlich die geografische Längen und die geografische Breite. 
GeoJSON unterstützt drei Dimensionen – neben der geografischen Länge 
und der geografischen Breite können Sie zusätzlich die Höhe auf der Erde angeben.</p>
<blockquote>
<p>Beim <a href="http://wiki.openstreetmap.org/wiki/DE:Genauigkeit_von_GPS-Daten">globalen Navigationssatellitensystem (GPS)</a> 
ist noch eine vierte Große relevant. 
Neben der horizontalen Position und der Höhe spielt auch
die aktuelle Zeit eine Rolle.</p>
</blockquote>
<p>Die Koordinaten werden in GeoJSON im Dezimalformat formatiert. 
Die erste Zahl steht für die Longitude – also die geografische Länge – 
und die zweite Zahl für die Latitude – also die geografische Breite. 
Konkret sieht eine Position in GeoJSON so aus:</p>
<pre><code>[Länge, Breite, Höhe] </code></pre>
<p>oder </p>
<pre><code>[50.254, 7.5847, 324.1]</code></pre>
<p><a href="#" id="ReihenfolgeKoordinaten"></a></p>
<blockquote>
<p>Vielleicht haben Sie in der Vergangenheit schon öfter mit Geodaten
gearbeitet und wundern sich nun über die Reihenfolge, in der die
Dimensionen im Format GeoJSON stehen? 
Viele Systeme geben zuerst die geografische Länge und erst dann die 
geografische Breite an.<br />
Auch in Leaflet wird bei der Koordinate zuerst die
Latitude - also die geografische Breite - und erste dann die Longitude - 
also die geografische Länge - angegeben:<br />
<code>Breitengrad | Längengrad</code>.<br />
Um dieses Durcheinander zu
verstehen, müssen Sie das Folgende bedenken: Früher war es üblich,
dass die erste Stelle einer Koordinate den Breitengrad und die zweite
Stelle den Längengrad beschrieb. In der Mathematik ist die übliche
Reihenfolge beim Arbeiten mit Koordinatensystemen:  <code>X-Wert | Y-Wert</code>.
Wenn man eine Landkarte mit einem Koordinatensystem vergleicht,
erkennt man schnell, dass der Breitengrad dem  <code>X-Wert</code>  und der
Längengrad der dem  <code>Y-Wert</code>  entspricht. Dies hat zur Folge, dass es
beim Rechnen mit einem Computer viele Vorteile bringt, wenn man die
Reihenfolge <code>Längengrad | Breitengrad</code> einhält.<br />
In der digitalen Welt gibt es momentan noch keine Einigkeit über die Reihenfolge. 
Es sieht so aus, als ob wir mitten in einem Umbruch stecken. Eine Übersicht,
die zeigt, welche Anwendung die Dimensionen in welcher Reihenfolge verwendet 
finden Sie unter anderem unter der Adresse <a href="https://macwright.org/lonlat/">https://macwright.org/lonlat/</a>.  </p>
</blockquote>
<p>Früher erlaubte GeoJSON die Speicherung von mehr als drei Zahlen pro Position. 
Diese Möglichkeit wurde auch genutzt. 
Es wurden beispielsweise Sportdaten wie die Herzfrequenz zusammen 
mit der Position gespeichert. So konnte ein Sportler später nachsehen, wie 
sich sein Puls am Berg und im Tal unterscheidet. Da dies nicht der Sinn 
einer Position ist, führte dieses Vorgehen teilweise zu Problemen 
in anderen GeoJSON Anwendungen. 
In der <a href="https://tools.ietf.org/html/rfc7946#section-3.1.1">neuen GeoJSON Spezifikation</a> 
ist das Speichern von mehr als drei Werten pro Position nun nicht mehr zulässig.</p>
<h5 id="point">Point</h5>
<p>Der Typ Point – also Punkt – ist die einfachste Geometrie in GeoJSON. 
Er gibt die Koordinaten einer bestimmten Position im Raum an. 
Die genaue Schreibweise sehen Sie nachfolgend.</p>
<pre><code>{
    "type": "Point",
    "coordinates": [30.0, 10.0]
}</code></pre>
<p>In Leaflet wird der Typ <a href="https://tools.ietf.org/html/rfc7946#section-3.1.2">Point</a> 
als <a href="https://leafletjs.com/reference-1.3.4.html#marker">Marker</a> zur Karte hinzugefügt.</p>
<h5 id="multipoint">Multipoint</h5>
<p>Der Typ MultiPoint wird mit einem Array von Positionen beschrieben. 
Mit ihm können mehrere Punkte auf der Erde angegeben werden.</p>
<pre><code>{
    "type": "MultiPoint",
    "coordinates": [
        [100.0, 2.0],
        [50.0, 21.0],
        [101.0, 1.0]
    ]
}</code></pre>
<p>Mit dem Typ Multipoint können Sie mehrere Marker auf einen Schlag zu 
Ihrer Leaflet Karte hinzufügen.</p>
<h5 id="linestring">LineString</h5>
<p>Um eine Linie darzustellen, benötigen Sie mindestens zwei Punkte. 
Die Linie ist die Verbindung zwischen diesen Punkten. 
Eine Linie wird mit einem Array von zwei oder mehr Positionen gebildet. 
In GeoJSON wird eine Linie mit dem Typ LineString dargestellt.</p>
<pre><code>{
    "type": "LineString",
    "coordinates": [
        [100.0, 0.0],
        [20.0, 5.0],
        [101.0, 1.0]
    ]
}</code></pre>
<p>Ein GeoJSON Objekt vom Typ <a href="https://tools.ietf.org/html/rfc7946#section-3.1.4">LineString</a> entspricht einem 
<a href="https://tools.ietf.org/html/rfc7946#section-3.1.5">Polyline Objekt</a> in Leaflet.</p>
<h5 id="multilinestring">MultiLineString</h5>
<p>Beim Typ MultiLineString werden die Koordinaten mit einem Array von 
LineString-Koordinaten-Arrays angegeben.</p>
<pre><code>{
    "type": "MultiLineString",
    "coordinates": [
        [
            [100.0, 0.0],
            [101.0, 1.0]
        ],
        [
            [10.0, 5.0],
            [11.0, 1.1]
        ],
        [
            [102.0, 2.0],
            [103.0, 3.0]
        ]
    ]
}</code></pre>
<p>Ein GeoJSON Objekt vom Typ 
<a href="https://tools.ietf.org/html/rfc7946#section-3.1.5">MultiLineString</a> 
entspricht einem Leaflet <a href="https://tools.ietf.org/html/rfc7946#section-3.1.5">Polyline Objekt</a>, welches mehr als eine abgeschlossene 
Linie definiert. 
Das bedeute, dass alle Linien zusammen auf einem Layer gezeichnet werden.  </p>
<blockquote>
<p>Wie bei den Objekten in Leaflet gilt auch hier: Linien und Punkte
sind die einfachsten Geometrieformen. Bei beiden müssen Sie nicht
viele geometrische Regeln beachten. Ein Punkt kann irgendwo an einem
Ort liegen und eine Linie kann eine beliebige Anzahl an Punkten
enthalten. Eine Linie darf sich selbst überqueren. Punkte und Linien
haben keine Fläche – somit gibt es auch kein <em>Außen</em> und kein
<em>Innen</em>.</p>
</blockquote>
<h5 id="polygone">Polygone</h5>
<p>Im Vergleich zu Linien sind Polygone komplexe Geometrien. 
Polygone verfügen über eine Fläche. 
Es gibt also einen Innenbereich, der sich von einem Außenbereich unterscheidet. 
Und hinzu kommt: Der Innenbereich kann Löcher haben! 
Wie die Löcher in einem Polygon entstehen, habe ich Ihnen im Kapitel 
<a href="#DieKarteMitDatenBestuecken">Die Karte mit Daten bestücken</a> 
im Unterkapitel 
<a href="#DieKarteMitDatenBestueckenPolygone">Polygone</a> 
erklärt. 
Ein GeoJSON Objekt vom Typ 
<a href="https://tools.ietf.org/html/rfc7946#section-3.1.6">Polygon</a> 
entspricht einem <a href="https://leafletjs.com/reference-1.3.4.html#polygon">Polygon Objekt</a> in Leaflet. 
Die Koordinatenliste enthält bei einem Polygon – analog zu Leaflets Polygon – 
eine Ebene mehr als die Koordinatenliste des Typs LineString. 
Ich habe die relevante Klammerung im nachfolgenden Beispiel mit einem Stern markiert.</p>
<pre><code>    {
        "type": "Polygon",
        "coordinates": [
*           [
                [30.0, 10.0],
                [40.0, 40.0],
                [20.0, 40.0],
                [10.0, 20.0],
                [30.0, 10.0]
*           ]
        ]
    }</code></pre>
<p>Bei einem einfachen Polygon ist der Sinn dieser Ebene nicht offensichtlich. 
Auf den ersten Blick könnten Sie der Meinung sein, dass es einfacher wäre, 
das Polygon genau wie die Linie zu erstellen. 
Dass es sich um ein Polygon handelt, ist über den Eintrag bei der Eigenschaft 
Typ klar. Und, wenn es sich um den Typ Polygon handelt, 
wird die Linie einfach geschlossen! 
Der erste Blick ist oft trügerisch. 
Wir benötigen diese zusätzliche Möglichkeit der Klammerung oder 
Verschachtelung um Löcher in die Fläche zeichnen zu können. 
Polygone sind in GeoJSON mehr als nur geschlossene Linien. 
Ich wiederhole mich. 
Polygone haben einen Innenbereich, und dieser Innenbereich kann Löcher haben. 
Aus diesem Grund ist beim Typ Polygone in der GeoJSON Spezifikation ein 
neuer Begriff zu lesen, nämlich der Begriff 
<a href="https://tools.ietf.org/html/rfc7946#section-3.1.6">LinearRing</a>. 
Ein LinearRing ist ein geschlossener LineString mit vier oder mehr Positionen. 
Obwohl ein LinearRing nicht explizit als GeoJSON-Geometrie-Typ eingeführt ist, 
wird der Begriff in der 
<a href="https://tools.ietf.org/html/rfc7946#section-3.1.6">Polygon-Geometrie-Typ-Definition</a> 
der Spezifikation erwähnt.</p>
<p>Ein <em>LinearRing</em> ist entweder die äußere Ringposition, 
die die äußere Kante des Polygons bildet und definiert, 
welche Flächen gefüllt sind. 
Ein <em>LinearRing</em> kann aber auch ein Innenring sein, 
der die Flächen des Polygons definieren, 
die leer sind. 
Es kann eine beliebige Anzahl von Innenringen geben, 
einschließlich null Innenringe. 
Wenn das Polygon über keinen Innenring verfügt bedeutet dies, 
dass das Polygon nur einen Innenbereich und einen Außenbereich hat – 
also keine Löcher hat.</p>
<hr />
<pre><code>{
    "type": "Polygon",
    "coordinates": [
        [
            [1.0, 1.0],
            [1.0, 10.0],
            [10.0, 10.0],
            [10.0, 1.0],
            [1.0, 1.0]
        ]
        [
            [2.0, 2.0],
            [2.0, 5.0],
            [5.0, 5.0],
            [5.0, 2.0],
            [2.0, 2.0]
        ]
    ]
}
</code></pre>
<p><img src="../Images/928b.png" alt="Ein Polygon mit zwei Innenringen" /></p>
<p><em>Abbildung: Ein Polygon mit einem Innenring. Der Innenring definiert einen Außenbereich im Polygon – er schneidet quasi ein Loch in das Polygon .</em></p>
<hr />
<pre><code>{
    "type": "Polygon",
    "coordinates": [
        [
            [1.0, 1.0],
            [1.0, 10.0],
            [10.0, 10.0],
            [10.0, 1.0],
            [1.0, 1.0]
        ]
        [
            [2.0, 2.0],
            [2.0, 5.0],
            [5.0, 5.0],
            [5.0, 2.0],
            [2.0, 2.0]
        ]
        [
            [3.0, 3.0],
            [3.0, 4.0],
            [4.0, 4.0],
            [4.0, 3.0],
            [3.0, 3.0]
        ]
    ]
}
</code></pre>
<p><img src="../Images/928c.png" alt="Ein Polygon mit zwei Innenringen" /></p>
<p><em>Abbildung: Ein Polygon mit zwei Innenringen – der zweite Innenring wird innerhalb des ersten Innenringes gezeichnet. Dieser zweite Innenring zeichnet einen neuen Innenbereich in den Außenbereich der durch den ersten Innenring entstanden ist.</em></p>
<hr />
<blockquote>
<p>Vielleicht
ist Ihnen aufgefallen, das die erste und die letzte Koordinate jedes
LinearRings gleich ist. Die Wiederholung der Koordinate ist bei einem
Leaflet Objekt nicht erwünscht. Hier werden die Ringe eines Polygone
automatisch geschlossen. Die erste und letzte Position eines GeoJSON 
LinearRing muss im Gegensatz dazu identisch sein.</p>
</blockquote>
<h5 id="multipolygon">MultiPolygon</h5>
<p>Beim Typ MultiPolygon werden die Koordinaten mit einem Array von 
Polygon-Koordinaten-Arrays angegeben. 
Hier sehen Sie zunächst ein Beispiel, dass zwei einfache Polygone darstellt.</p>
<pre><code>{
    "type": "MultiPolygon",
    "coordinates": [
        [
            [
                [102.0, 2.0],
                [103.0, 2.0],
                [103.0, 3.0],
                [102.0, 3.0],
                [102.0, 2.0]
            ]
        ],
        [
            [
                [100.2, 0.2],
                [100.2, 0.8],
                [100.8, 0.8],
                [100.8, 0.2],
                [100.2, 0.2]
            ]
        ]
    ]
}</code></pre>
<p>Es geht aber auch komplizierter. 
Sie können auch mehr als ein Polygon mit Löchern – 
also mehr als einem LinearString – zusammen als MultiPolygon gruppieren.</p>
<pre><code>{
    "type": "MultiPolygon",
    "coordinates": [
        [
            [
                [102.0, 2.0],
                [103.0, 2.0],
                [103.0, 3.0],
                [102.0, 3.0],
                [102.0, 2.0]
            ]
        ],
        [
            [
                [100.0, 0.0],
                [101.0, 0.0],
                [101.0, 1.0],
                [100.0, 1.0],
                [100.0, 0.0]
            ],
            [
                [100.2, 0.2],
                [100.2, 0.8],
                [100.8, 0.8],
                [100.8, 0.2],
                [100.2, 0.2]
            ]
        ]
    ]
}</code></pre>
<p>Ein GeoJSON Objekt vom Typ 
<a href="https://tools.ietf.org/html/rfc7946#section-3.1.7">MultiPolygon</a> entspricht einem 
<a href="https://leafletjs.com/reference-1.3.4.html#polygon">Leaflet Polygon Objekt</a>, 
welches mehr als ein Polygon definiert. 
Das bedeute, dass alle Formen zusammen auf einen Layer gezeichnet werden.  </p>
<h5 id="mehrere-geometrien-zusammenfassen-geometrycollection">Mehrere Geometrien zusammenfassen - GeometryCollection</h5>
<p>Geodaten wollen die Welt beschreiben. 
Jeder der grundlegenden GeoJSON Typen ist ideal für die Darstellung 
eines Objektes auf der Erde. Unsere Welt enthält eine Menge Objekte, 
die gemeinsame Eigenschaften haben. 
Wenn wir diesen Objekten diese gemeinsamen Eigenschaften auf einen 
Schlag zuordnen möchten, können wir diese Objekte mit dem 
Typ <a href="https://tools.ietf.org/html/rfc7946#section-3.1.8">GeometryCollection</a> 
zusammenfassen. Zum Beispiel haben die beiden Geometrien im nachfolgenden Beispiel 
denselben Namen.</p>
<pre><code>{
    "type": "Feature",
    "geometry": {
        "type": "GeometryCollection",
        "geometries": [{
            "type": "Point",
            "coordinates": [100.0, 0.0]
        }, {
            "type": "LineString",
            "coordinates": [
                [101.0, 0.0],
                [102.0, 1.0]
            ]
        }]
    },
    "properties": {
        "name": "Der Name dieser GeometryCollection"
    }
}</code></pre>
<p>Einen Anwendungsfall für eine Geometriekollektion gibt es in der 
Praxis allerdings nur sehr selten: Meist ist es so, 
dass jede Geometrie auch eigene Eigenschaften besitzt. 
Im nächsten Kapitel werden Sie lesen, dass Sie eine Geometrie mit 
eigenen Eigenschaften im Typ Feature beschreiben können 
und Feature Objekte werden mit dem Typ FeatureCollection zusammengefasst.</p>
<h4 id="einer-geojson-geometrie-eigenschaften-zuordnen">Einer GeoJSON Geometrie Eigenschaften zuordnen</h4>
<p>Geometrien sind Formen – nicht mehr und nicht weniger. 
Sie sind ein zentraler Teil von GeoJSON, aber die meisten Daten, 
die etwas mit der Welt zu tun haben, sind nicht einfach nur eine Form. 
Die Formen haben auch eine Identität und Attribute. 
Ein Polygon stellt beispielsweise den Reichstag dar. 
Ein anderes Polygone ist die Grenze von Deutschland. 
Und bei der Arbeit mit den Geometrien ist es wichtig zu wissen, 
welche Geometrie was ist und, welche Eigenschaften die Geometrie hat. 
In GeoJSON kann genau dies mit einem Objekt des Typs Feature erreicht werden.</p>
<p>Das nachfolgende Programmcodebeispiel enthält ein ganz einfaches Feature Element.</p>
<pre><code>{
  "type": "Feature",
  "geometry": {
    "type": "Point",
    "coordinates": [0, 0]
  },
  "properties": {
    "name": "Der Name des Punktes"
  }
}</code></pre>
<p>Im nächsten Beispiel sehen Sie ein etwas komplexeres 
Feature. Sie erkennen hier, dass eine Eigenschaft eines Feature Elements 
mit jedem <a href="https://de.wikipedia.org/w/index.php?title=JavaScript_Object_Notation&amp;oldid=183718070#Datenstruktur_und_Formatdefinition">JSON-Objekt Datentyp</a> 
beschrieben werden kann.</p>
<pre><code>  {
  "type": "Feature",
  "geometry": {
  "type": "Polygon",
  "coordinates": [
                    [30, 20], 
                    [45, 40], 
                    [10, 40], 
                    [30, 20]
                 ]
  },
  "properties": {
  "prop0": "value0",
  "prop1": {"this": "that"},
  "prop2": true,
  "prop3": null,
  "prop4": ["wert1", "wert2", "wert3"],
  "prop5": 0.0
  }
  }
</code></pre>
<blockquote>
<p>JSON kennt folgende Datentypen:</p>
<ul>
<li>Nullwert<br />
Ein Nullwert wird durch das Schlüsselwort <code>null</code> dargestellt.</li>
<li>Boolescher Wert<br />
Ein Boolescher Wert wird durch die Schlüsselwörter <code>true</code> und <code>false</code> dargestellt.</li>
<li>Zahl<br />
Eine Zahl ist eine Folge der Ziffern <code>0</code>–<code>9</code>.</li>
<li>Zeichenkette<br />
Eine Zeichenkette beginnt und endet mit doppelten geraden Anführungszeichen <code>"</code>.</li>
<li>Array<br />
Ein Array beginnt mit <code>[</code> und endet mit <code>]</code>.</li>
<li>Objekt<br />
Ein Objekt beginnt mit <code>{</code> und endet mit <code>}</code>.</li>
</ul>
</blockquote>
<h4 id="featurecollection">FeatureCollection</h4>
<p>So nun haben wir jede Menge Typen kennen gelernt. 
Den Typ, den Sie sicherlich am meisten nutzen werden, 
habe ich für den Schluss aufgehoben. Die Syntax einer FeatureCollection 
können Sie im nachfolgenden Beispiel ablesen.</p>
<pre><code>{
    "type": "FeatureCollection",
    "features": [{
        "type": "Feature",
        "geometry": {
            "type": "Point",
            "coordinates": [102.0, 0.5]
        },
        "properties": {
            "prop0": "value0"
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "LineString",
            "coordinates": [
                [102.0, 0.0],
                [103.0, 1.0],
                [104.0, 0.0],
                [105.0, 1.0]
            ]
        },
        "properties": {
            "prop0": "value0",
            "prop1": 0.0
        }
    }, {
        "type": "Feature",
        "geometry": {
            "type": "Polygon",
            "coordinates": [
                [
                    [50.0, 7.0],
                    [60.0, 8.0],
                    [70.0, 9.0]
                ]
            ]
        },
        "properties": {
            "name": "Luisenturm",
            "prop1": {
                "this": "that"
            }
        }
    }]
}</code></pre>
<p>Ein Objekt vom Typ 
<a href="https://tools.ietf.org/html/rfc7946#section-3.3">FeatureCollection</a> 
enthält ein Schlüssel-Wert-Paar. 
Der Wert ist ein Array das aus Feature Objekten besteht und der Schlüssel 
lautet Features. Wie der Name schon sagt, darf das Array ausschließlich 
Objekte vom Typ Feature enthalten.</p>
<p>Welche Vorteile bring ein Objekt vom Typ FeatureCollection zusätzlich zu 
den einzelnen Feature Objekten? Ein Objekt vom Typ FeatureCollections ist 
sehr sinnvoll, wenn Sie mit GeoJSON-Typen arbeiten, 
die gemeinsame Eigenschaften haben. 
Im nächsten Kapitel wird Ihnen dies anhand von praktischen Beispielen klar werden.</p>
<blockquote>
<p><strong>Hinweis:</strong><br />
Sie möchten gerne GeoJSON nutzen und 
haben auch schon die ersten Dateien erstellt.
Vielleicht sind Sie auch schon auf das ein oder andere Problem
gestoßen oder möchten einfach nur mit der Syntax vertraut werden.
Auf der Website <a href="http://geojsonlint.com">http://geojsonlint.com</a>
können Sie Ihre GeoJSON Daten testen.</p>
</blockquote>
<h3 id="die-grenzen-von-geojson">Die Grenzen von GeoJSON</h3>
<p>Die Vorteile von GeoJSON hatte ich Ihnen weiter vorne in diesem 
Kapitel näher gebracht. Wie jedes andere Format hat GeoJSON aber auch seine Grenzen. 
Diese sind nun Thema dieses Kapitels.</p>
<ul>
<li>GeoJSON hat kein Konstrukt das eine Komprimierung unterstützt 
wie beispielsweise <a href="https://github.com/topojson/topojson">TopoJSON</a> 
oder <a href="http://wiki.openstreetmap.org/wiki/OSM_XML">OSM XML</a>. </li>
<li>GeoJSON unterstützt die gleichen Datentypen wie JSON. 
JSON unterstützt nicht jeden Datentyp. Zum Beispiel gibt es keinen Typ 
für Datumswerte in JSON. </li>
<li>GeoJSON hat kein Konstrukt für die Anzeige von Pop-up Fenstern wie Titel 
oder Beschreibung. </li>
<li>GeoJSON hat keine Geometrie vom Typ Kreis – oder irgendeine andere Art von Kurve. </li>
<li>In GeoJSON können Sie den einzelnen Koordinaten – also den Positionen – 
keine eigene Eigenschaft zuweisen. Wenn Sie die <em>LineString</em> Darstellung 
eines Trainingslaufs haben und Ihr GPS Gerät mehr als 1000 verschiedene 
Punkte während dieses Laufs zusammen mit Ihrer Herzfrequenz protokolliert hat, 
bietet GeoJSON keine klare Antwort auf die Frage, wie Sie diese Daten am 
besten darstellen. Sie könnten eine zusätzliche Eigenschafte als 
Array mit der gleichen Länge wie das Array der Koordinaten speichern – 
eine klare und einheitliche Regelung gibt es aber nicht. Jeder muss für sich selbst 
das Rad neu erfinden.</li>
</ul>
<h2 id="geojson-leaflet">GeoJson in Leaflet</h2>
<p><a href="#" id="GeoJsoninLeaflet"></a></p>
<p>Leaflet unterstützt alle GeoJSON-Typen. 
In der Regel werden Sie überwiegend den Typ <em>Feature</em> und 
<em>FeatureCollection</em> nutzen. 
Sie möchten ja sicher nicht nur Geometrie Objekte auf Ihrer Karte anzeigen, 
sondern auch die Eigenschaften – also weitere Informationen – zu diesen Objekten.</p>
<h3 id="ein-geojson-feature-leaflet-einbinden">Ein GeoJSON Feature in Leaflet einbinden</h3>
<p>Beginnen wir mit einem übersichtlichen Beispiel: 
Die einfachste Art GeoJSON in Ihrer Karte zu nutzen, 
ist die Verwendung als Variable direkt – fest programmiert. 
So etwas sollte man in der Praxis nicht machen. Ein Programm mit fix 
programmierten Variablen ist in der Regel starr und unflexibel. Etwas größere 
Anwendungen werden so auch schnell unübersichtlich, weil alles durcheinander 
geschrieben ist.<br />
Übungsbeispiele sollen aber nur einen bestimmten Punkt hervorheben. 
Außerdem lassen sich die Beispiele so möglichst einfach darstellen. 
Deshalb nutze ich in den Programmcodebeispielen in 
diesem Buch fest programmierte Variablen.</p>
<blockquote>
<p>Eine andere alternative Art GeoJSON Daten in ein HTML-Dokument einzubinden 
finden Sie im Kapitel <a href="#HeatmapsundChoroplethenkarten">Choroplethenkarte</a> im Unterkapitel 
<a href="#ChoroplethenkarteOpenData">Open Data</a>.</p>
</blockquote>
<p>Das nachfolgende Programmcodebeispiel enthält einen <em>Punkt</em>. 
Sobald Sie diesen – in GeoJSON formatierten – Punkt in einer 
JSON-Variablen gespeichert haben, können Sie diesen ganz einfach 
zur Karte hinzufügen. 
Leaflet zeigt auf der Karte als Ergebnis einen Marker an.</p>
<blockquote>
<p>Wir haben im Kapitel <a href="#ReihenfolgeKoordinaten">GeoJSON erkunden</a> festgestellt, 
dass Leaflet Koordinaten in einer anderen 
Reihenfolge als GeoJSON schreibt. 
Wenn Sie die Standardfunktionen in Leaflet verwenden, 
müssen Sie sich hierüber aber keine Sorgen machen. 
Leaflet setzt die Koordinaten selbständig in die passende Form.</p>
</blockquote>
<p>Hier also nun das erste praktische Beispiel zum Thema GeoJSON und Leaflet. 
Die relevanten Programmcodestellen habe ich mit einem Stern markiert.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var geojsonFeature1 = {
*"type": "Feature",
*"geometry": {
*"type": "Point",
*"coordinates": [7.26469, 50.27264]
*},
*"properties": {
*"name": "Gering"
*}
*};
*L.geoJSON(geojsonFeature1).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
 &lt;!--index_973.html--&gt;</code></pre>
<p>Was passiert hier genau? Als erste haben wir den GeoJSON Code fest 
in der Variablen <code>geojsonFeature1</code> gespeichert. 
Als nächstes haben wir ein Leaflet Objekt vom Typ GeoJSON erstellt und 
diesem unseren GeoJSON Code, also die Variable <code>geojsonFeature1</code>, übergeben. 
Das GeoJSON Objekt haben wir gleichzeitig mithilfe der Methode <code>addTo()</code> 
zum Leaflet-Kartenobjekt hinzugefügt.<br />
Mehr mussten wir nicht tun! Das Ergebnis ist ein Standard Marker 
an der Stelle auf der Erde, die das GeoJSON Point Element beschreibt.</p>
<blockquote>
<p>Das Leaflet-Objekt <a href="http://leafletjs.com/reference#geojson">GeoJSON</a> 
ist ein Leaflet-Layer. Also eine Ebene. 
Ganz konkret erweitert die Klasse GeoJSON die Klasse 
<a href="http://leafletjs.com/reference#featuregroup">FeatureGroup</a>.</p>
</blockquote>
<p>Auf der nachfolgenden Abbildung können Sie sich das Ergebnis ansehen.</p>
<p><img src="../Images/955.png" alt="Ein Marker auf einer Leaflet Karte mithilfe von GeoJSON eingefügt." /></p>
<p><em>Abbildung: Ein Marker auf einer Leaflet Karte mithilfe von GeoJSON eingefügt.</em></p>
<blockquote>
<p>Wenn Sie an die Zeile<br />
<code>L.geoJSON(geojsonFeature1).addTo(mymap);</code><br />
den Text<br />
<code>.bindPopup('Pop-up Text');</code><br />
anhängen, also<br />
<code>L.geoJSON(geojsonFeature1).addTo(mymap).bindPopup('Pop-up Text');</code><br />
schreiben, öffnet sich ein Pop-up Fenster, wenn Sie den Marker anklicken.</p>
</blockquote>
<h3 id="eine-geojson-featurecollection-leaflet-einbinden">Eine GeoJSON FeatureCollection in Leaflet einbinden</h3>
<p>Das Beispiel des letzten Kapitels enthielt ausschließlich einen Punkt – 
also ein Feature. Geodaten bestehen in der Regel aus mehreren Geometrien 
mit dazugehörigen Eigenschaften – also FeatureCollections. 
Leaflet liest eine FeatureCollection genauso ein, wie Sie es im letzten Beispiel 
anhand des einen Features gesehen haben. Das nächste Beispiel zeigt Ihnen, 
wie Sie einen Punkt, ein Polygon und eine Linie in einem Schritt auf 
Ihrer Karte anzeigen könnten.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var geojsonFeatureCollection =
*{
*"type": "FeatureCollection",
*"features":
*[
*{
*"type": "Feature",
*"geometry": {"type": "Point", "coordinates": [7, 50]},
*"properties": {"prop0": "value0"}
*},
*{
*"type": "Feature",
*"geometry": { "type": "LineString", "coordinates": [
*[7, 50], [7, 51], [6, 51], [6, 52]
*]},
*"properties": { "prop0": "value0", "prop1": 0.0 }
*},
*{ "type": "Feature",
*"geometry": { "type": "Polygon", "coordinates": [
*[ [6, 49], [5, 49], [5, 48], [4, 49], [4, 50] ]
*]
*},
*"properties": { "prop0": "value0", "prop1": {"this": "that"}
*}
*}
*]
*}
*L.geoJSON(geojsonFeatureCollection).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_972.html--&gt;</code></pre>
<p>Voila! Drei Elemente mit Standardeigenschaften auf der Leaflet Karte.</p>
<p><img src="../Images/961.png" alt="Drei Element auf einer Leaflet Karte mithilfe von GeoJSON eingefügt." /></p>
<p><em>Abbildung: Drei Elemente auf einer Leaflet Karte mithilfe von GeoJSON eingefügt.</em></p>
<h3 id="geojson-aus-leaflet-exportieren">GeoJSON aus Leaflet exportieren</h3>
<p>So, und nun machen wir genau das Gegenteil. 
Ein jedes Leaflet Objekt, das wir uns im Kapitel 
<a href="#DieKarteMitDatenBestuecken">Die Karte mit Daten bestücken</a> angesehen haben, 
verfügt über eine Leaflet Methode mit dem Namen <code>toGeoJson()</code>. 
Und diese Methode tut genau das, was der Name schon vermuten lässt: 
Das übergebene Leaflet Objekt wird in ein GeoJSON Objekt umgewandelt und ausgegeben. 
Sehen Sie sich im nächsten Beispiel die Anwendung der Methode <code>toGeoJson()</code> an.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var myMarker=L.marker([50.27264, 7.26469]);
*var markerAsGeoJSON = myMarker.toGeoJSON();
*var geoJsonLayer = L.geoJson().addTo(mymap);
*geoJsonLayer
* .addData(markerAsGeoJSON)
* .bindPopup("Ich bin .... so aus:&lt;br&gt; " + JSON.stringify(markerAsGeoJSON));
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_971.html--&gt;</code></pre>
<p>Was zeigt Ihnen dieses Beispiel genau? 
Das folgende Beispiel zeigt Ihnen, wie Sie einen Marker ins GeoJSON 
Format konvertieren können. 
Dazu erstellen Sie zunächst mit var <code>myMarker=L.marker([50.27264, 7.26469])</code> 
einen Leaflet Marker. Danach rufen Sie die Methode <code>toGeoJSON()</code> 
des Markers auf und speichern das zurückgegeben GeoJSON Objekt in der Variablen 
<code>markerAsGeoJSON</code>. Als Nächstes erstellen Sie einen leeren GeoJSON Layer 
und fügen diesen zum Kartenobjekt hinzu: 
<code>var geoJsonLayer = L.geoJson().addTo(mymap)</code>. 
Sie hätten den GeoJSON Code in der Variablen <code>markerAsGeoJSON</code> 
wie in vorherigen Beispielen sofort beim Erstellen des Layers als 
Parameter mitgeben können. Hier wollte ich ihnen aber die Methode <code>addData()</code> 
zeigen, mit der Sie auch nachträglich noch GeoJSON Objekte zur GeoJSON Ebene 
hinzufügen können.</p>
<blockquote>
<p>Im vorausgehenden Beispiel habe ich die Methode <code>JSON.stringify()</code> 
beim Erstellen des Textes im Pop-up Fenster angewandt. Mit
der Methode <a href="https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify">JSON.stringify()</a> 
können Sie eine JavaScript Variable in einen Text im JSON-Format 
konvertieren.</p>
</blockquote>
<p>Die nachfolgende Abbildung zeigt das Bild, welches Sie im Browser sehen, 
wenn Sie die HTML-Datei des vorausgehenden Beispiels im Browser öffnen.</p>
<p><img src="../Images/960.png" alt="Ein Marker auf einer Leaflet Karte, der seinen eigenen - ins GeoJSON Format konvertieren - Programmcode zeigt." /></p>
<p><em>Abbildung: Ein Marker auf einer Leaflet Karte, der seinen eigenen - ins GeoJSON Format konvertieren - Programmcode zeigt.</em></p>
<p>Sie werden nun sicher mein Beispiel als umständlich ansehen. 
Ich habe einen Marker, denn ich ohne zusätzliche Schritte auf der Karten hätte 
anzeigen könnte, vorher umgewandelt dann in umgewandelter Form zur 
Karte hinzugefügt. Diese Vorgehensweise ist nicht Sinn und Zweck der Leaflet 
Methode <code>toGeoJSON()</code>. Sinn und Zweck ist es eher, Daten 
der Karte zum Export anzubieten.</p>
<blockquote>
<p>Wenn Sie möchten, dass die Methode <code>toGeoJSON()</code> Eigenschaften zu 
Ihren eigenen Leaflet Objekten exportiert, müssen Sie diese
in einer bestimmten Form mit Ihrem Leaflet Objekt speichern. Möchten
Sie beispielsweise ein  <code>Polyline</code>  Objekt exportieren, dann müssen 
Sie mit diesem Polyline-Objekt eine Variable <code>feature</code> speichern. 
Die Variablen <code>feature</code> enthält den Text Feature in der Variablen <code>type</code> und
die zu exportierenden Eigenschaften in der Variablen <code>properties</code>.<br />
<code>var polyline = L.polyline([</code><br />
<code>[50.27264, 7.26469], [51.27264, 7.26469], [51.27264, 6.26469]</code><br />
<code>]);</code><br />
<code>polyline.</code><strong><code>feature</code></strong><code>= {};</code><br />
<code>polyline.</code><strong><code>feature.type</code></strong><code>= "Feature";</code><br />
<code>polyline.</code><strong><code>feature.properties</code></strong><code>= {};</code><br />
<code>polyline.feature.properties["Foo"] = "Bar";</code><br />
Der Export des Polyline Objektes würde wie folgt aussehen:<br />
<code>{"type":"FeatureCollection",</code><br />
<code>"features":[</code><br />
<code>{</code><br />
<code>"type":"Feature",</code><br />
<code>"properties":{"Foo":"Bar"}</code><br />
<code>"geometry":{"type":"LineString",</code><br />
<code>"coordinates":[[7.26469,50.27264],[7.26469,51.27264],[6.26469,51.27264]]</code><br />
<code>}}</code><br />
<code>]</code><br />
<code>}</code>  </p>
</blockquote>
<h3 id="stylen">Stylen</h3>
<p>Ein GeoJSON Layer biete Ihnen mit der 
<a href="https://leafletjs.com/reference-1.1.0.html#geojson-setstyle">Methode <code>setStyle()</code></a> 
die Möglichkeit das Aussehen der Kartenschicht zu gestalten.  </p>
<p>Sie können neben den hier beschriebenen Optionen auf eine große Auswahl 
weitere Stil Optionen zugreifen. 
Die vollständige Liste finden Sie in der 
Dokumentation von Leaflet. 
Sehen Sie sich dazu die Optionen zur Klasse Path an: 
<a href="http://leafletjs.com/reference-1.1.0.html#path">http://leafletjs.com/reference-1.1.0.html#path</a>.</p>
<h4 id="beim-erstellen-eines-geojson-layer-einen-stil-mitgeben">Beim Erstellen eines GeoJSON Layer einen Stil mitgeben</h4>
<p>Der nachfolgende Programmcode zeigt Ihnen, wie Sie 
Stylesheets beim Erstellen eines GeoJSON Layer als Parameter mitgeben können. 
Im nachfolgenden Programmcode finden Sie eine Funktion, 
die je nach GeoJSON Objekt eine andere Farbe zurück gibt. 
Wenn es sich um den Typ LineString handelt, 
gibt die Funktion die Farbe Rot zurück, falls ein Polygon vorliegt, 
antwortet die Funktion mit der Farbe Violett.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([49.3264, 7.26469], 6);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*function styleFunction(feature)
*{
*switch (feature.geometry.type)
*{
*case 'LineString': return {color: "red"};
*case 'Polygon':   return {color: "purple"};
*}
*}
*var geojsonFeatureCollection =
*{
*"type": "FeatureCollection",
*"features":
*[
*{
*"type": "Feature",
*"geometry": {"type": "Point", "coordinates": [7, 50]},
*"properties": {"prop0": "value0"}
*},
*{
*"type": "Feature",
*"geometry": { "type": "LineString", "coordinates": [
*[7, 50], [7, 51], [6, 51], [6, 52]
*]},
*"properties": { "prop0": "value0", "prop1": 0.0 }
*},
*{ "type": "Feature",
*"geometry": { "type": "Polygon", "coordinates": [
*[ [6, 49], [5, 49], [5, 48], [4, 49], [4, 50] ]
*]
*},
*"properties": { "prop0": "value0", "prop1": {"this": "that"}
*}
*}
*]
*}
*var geoJsonLayer = 
* L.geoJson(geojsonFeatureCollection,{style:styleFunction}).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_970.html--&gt;</code></pre>
<blockquote>
<p>Wenn Sie einen Stil auf alle Objekte
anwenden möchten, dann ist es nicht notwendig eine Funktion zu
erstellen. Die Zeile<br />
<code>var geoJsonLayer =</code> 
<code>L.geoJson(geojsonFeatureCollection,{color: "purple"}).addTo(mymap);</code><br />
reicht völlig aus.</p>
</blockquote>
<p>Auf der Karte sehen Sie nun die Objekte in der für sie bestimmten Farbe.</p>
<p><img src="../Images/959.png" alt="Drei Element auf einer Karte in unterschiedlichen Farben." /></p>
<p><em>Abbildung: Drei Element auf einer Karte in unterschiedlichen Farben mithilfe der Option <code>style</code>.</em></p>
<h4 id="ein-komplexeres-beispiel-eine-andere-farbe-beim-uberrollen-m">Ein komplexeres Beispiel: Eine andere Farbe beim Überrollen mit der Maus</h4>
<p>Im vorherigen Kapitel haben Sie gelernt, wie Sie mit der Option 
<code>style</code> des GeoJSON Layers ein Aussehen festlegen können. 
Sicherlich ändert sich das Aussehen Ihrer Objekte im Laufe der Zeit. 
Ganz häufig kommt es vor, dass man Objekte, die anklickbar sind und angeklickt 
wurden, als schon besucht kennzeichnen möchte. Oder Sie möchten ein Objekt, 
über dem sich die Maus gerade befindet, hervorheben. 
Genau diese beiden Anwendungsfälle sind Thema im nachfolgenden Beispielcode.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([49.27264, 7.26469], 6);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
 function styleFunction(feature)
 {
 switch (feature.geometry.type)
 {
 case 'LineString': return {color: "red"};
 case 'Polygon':   return {color: "purple"};
 }
 }
 var geojsonFeatureCollection =
 {
 "type": "FeatureCollection",
 "features":
 [
 {
 "type": "Feature",
 "geometry": {"type": "Point", "coordinates": [7, 50]},
 "properties": {"prop0": "value0"}
 },
 {
 "type": "Feature",
 "geometry": { "type": "LineString", "coordinates": [
 [7, 50], [7, 51], [6, 51], [6, 52]
 ]},
 "properties": { "prop0": "value0", "prop1": 0.0 }
 },
 { "type": "Feature",
 "geometry": { "type": "Polygon", "coordinates": [
 [ [6, 49], [5, 49], [5, 48], [4, 49], [4, 50] ]
 ]
 },
 "properties": { "prop0": "value0", "prop1": {"this": "that"}
 }
 }
 ]
 }
 var geoJsonLayer = L.geoJson(geojsonFeatureCollection,{style:styleFunction}).addTo(mymap);
*geoJsonLayer.on('mouseover', styleWhenMouseOver);
*geoJsonLayer.on('mouseout', styleWhenMouseOut);
*function styleWhenMouseOver(e){
*geoJsonLayer.setStyle({color:"green"});
*}
*function styleWhenMouseOut(e){
*geoJsonLayer.eachLayer(function (layer) {
*geoJsonLayer.resetStyle(layer);
*});
*}
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_969.html--&gt;</code></pre>
<p>Auf den ersten Blick hat sich im Vergleich zum vorherigen Beispiel nichts geändert. 
Wenn Sie allerdings die Maus über ein Objekt bewegen, sehen Sie eine Änderung. 
Das Polygon und die Linie verfärben sich nun grün. 
Der Marker kann seine Farbe nicht ändern. 
Im Grunde genommen handelt sich bei dem Marker um ein Image. 
Das HTML-Element Image verfügt nicht über die CSS Eigenschaft <code>color</code>. 
Wenn Sie das Aussehen des Markers ändern möchten, 
dann müssten Sie diesem eine andere Bilddatei zuordnen.</p>
<p><img src="../Images/958.png" alt="Drei Element auf einer Karte die sich grün färben, wenn man die Maus über sie bewegt." /></p>
<p><em>Abbildung: Drei Element auf einer Karte die sich grün färben, wenn man die Maus über sie bewegt.</em></p>
<p>Wenn Sie ein schon angeklicktes Element
mit der Farbe Grau einfärben möchten, dann könnten Sie dies über
die Funktion  </p>
<pre><code>function styleWhenMouseOut(e){
geoJsonLayer.setStyle({color:"gray"});
});  
}  </code></pre>
<p>anstelle von  </p>
<pre><code>function styleWhenMouseOut(e){
geoJsonLayer.eachLayer(function (layer) {
geoJsonLayer.resetStyle(layer);
});
}  </code></pre>
<p>erreichen.</p>
<blockquote>
<p><strong>Achtung:</strong><br />
Wenn Sie<br />
<code>function styleWhenMouseOut(e){</code><br />
<code>geoJsonLayer.eachLayer(function (layer) {</code><br />
<code>geoJsonLayer.resetStyle(layer);</code><br />
<code>});</code><br />
<code>}</code><br />
anstelle von<br />
<code>geoJsonLayer.on('mouseout',function(e){</code><br />
<code>geoJsonLayer.resetStyle(e.layer);</code><br />
<code>});</code><br />
schreiben würden, würde nur ein Layer – nämlich der, der gerade
überrollt wird – geändert.</p>
</blockquote>
<h3 id="iterieren">Iterieren</h3>
<p>Interessant werden Karten, wenn Sie viele Informationen bieten. 
Eine Karte mit vielen Informationen setzt die Arbeit mit vielen Daten 
für den Kartenersteller voraus. Und, beim Arbeiten mit vielen Daten werden 
Sie die Möglichkeit, alle Features mit einem Schlag zu bearbeiten, 
zu schätzen lernen. 
Iterieren können sie in Leaflet durch GeoJSON Objekte mithilfe der 
<a href="http://leafletjs.com/reference-1.1.0.html#geojson-oneachfeature">Methode <code>onEachFeature()</code></a>.</p>
<h4 id="oneachfeature-bearbeite-jedes-feature">OnEachFeature() – Bearbeite jedes Feature</h4>
<p><a href="http://leafletjs.com/reference-1.1.0.html#geojson-oneachfeature"><code>onEachFeature()</code></a> 
ist eine Methode, die einmal für jedes im Layer vorhandene GeoJSON Objekt 
vom Typ Feature aufgerufen wird. 
Nützlich ist diese Option zum Anhängen von Ereignissen oder Pop-up Fenstern 
an jedes Feature Objekt.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
 var geojsonFeatureCollection =
 {
 "type": "FeatureCollection",
 "features":
 [
 {
 "type": "Feature",
 "geometry": {"type": "Point", "coordinates": [6, 50]},
 "properties": {"name": "Dorf 1"}
 },
 {
 "type": "Feature",
 "geometry": {"type": "Point", "coordinates": [7, 50]},
 "properties": {"name": "Dorf 2"}
 },
 {
 "type": "Feature",
 "geometry": {"type": "Point", "coordinates": [7, 51]},
 "properties": {"name": "Dorf 3"}
 }
 ]
 };
*L.geoJson(geojsonFeatureCollection, {
*onEachFeature: function(feature, layer) {
*layer.bindPopup(feature.properties.name);
*}
*}).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_968.html--&gt;</code></pre>
<p>Der vorhergehende Programmcode zeigt Ihnen, wie Sie jedem Feature Objekt, 
das über die hart kodiert eingefügten GeoJSON Daten eingelesen wird, 
ein Pop-up anhängen können – und zwar jedem ein individuelles. 
Der Text für das Pop-up wird aus den GeoJSON Daten ausgelesen, 
er versteckt sich in der Eigenschaft <code>feature.properties.name</code>.</p>
<p>Das nachfolgende Bild stellt die drei Marker dar.</p>
<p><img src="../Images/957.png" alt="Drei Marker mit individuellem Pop-up Text." /></p>
<p><em>Abbildung: Drei Marker mit individuellem Pop-up Text.</em></p>
<p>Nun würden wir dem Marker aber vielleicht auch gerne ein spezielles Aussehen geben. 
Vielleicht möchten Sie sogar jeden Marker unterschiedlich gestalten. 
<code>onEachFeature()</code> bietet Ihnen hierzu keine Möglichkeit. 
Der Marker wird automatisch mit Standardwerten erstellt. 
Aber Leaflet wäre nicht Leaflet, wenn es hierfür keine Lösung hätte. 
Leaflet bietet Ihnen eine andere Methode für diesen Zweck an. 
Die <a href="https://leafletjs.com/reference-1.3.4.html#geojson-pointtolayer">Methode heißt <code>pointtoLayer()</code></a> und ein Beispiel dazu, 
wie Sie mit dieser Methode einen eigenen Marker erstellen und 
mit individuellen Optionen versehen können, finden Sie im nächsten Kapitel.</p>
<h4 id="pointtolayer-punkt-zu-ebene">PointToLayer – Punkt zu Ebene</h4>
<p>Die <a href="https://leafletjs.com/reference-1.3.4.html#geojson-pointtolayer">Methode <code>pointtoLayer()</code></a>, 
die wir uns in diesem Kapitel ansehen, 
ist spezielle für die Arbeit mit einem GeoJSON Objekten vom Typ <code>Point</code> gemacht. 
Dieses Objekt ist das GeoJSON Pendant zum Leaflet-Marker. 
Wenn wir einen Point beim Erstellen des GeoJSON Layers als Parameter übergeben, 
dann wird ein Standard Marker erstellt. 
Wollen wir diesen Marker individuell gestalten, 
dann brauchten wir entweder einen Variablennamen, 
den wir ansprechen können, 
oder wir müssen den Marker selbst instanziieren. 
Für das Instanziieren brauchen wir eine Position oder einen Point. 
Und nun schließt sich der Kreis. Die Option <code>pointtoLayer</code> gibt uns Zugriff 
auf die Koordinaten. Sehen Sie sich das nächste Beispiel an. 
Ein Beispiel erklärt oft mehr als viele Worte.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
 var geojsonFeatureCollection =
 {
 "type": "FeatureCollection",
 "features":
 [
 {
 "type": "Feature",
 "geometry": {"type": "Point", "coordinates": [6, 50]},
 "properties": {"name": "Dorf 1"}
 },
 {
 "type": "Feature",
 "geometry": {"type": "Point", "coordinates": [7, 50]},
 "properties": {"name": "Dorf 2"}
 },
 {
 "type": "Feature",
 "geometry": {"type": "Point", "coordinates": [7, 51]},
 "properties": {"name": "Dorf 3"}
 }
 ]
 };
 var options_draggable = {
 draggable: true, 
 title: "Ein Ort in der Nähe von Gering"
 };
 var options_notdraggable = {
 draggable: false,
 title: "Ein Ort in der Nähe von Gering"
 };
*L.geoJson(geojsonFeatureCollection, {
*pointToLayer: function(feature, latlng) {
*switch(feature.properties.name)
*{
*case "Dorf 1": return L.marker(latlng, options_draggable)
* .bindPopup(feature.properties.name);
*case "Dorf 2": return L.marker(latlng, options_notdraggable)
* .bindPopup(feature.properties.name);
*case "Dorf 3": return L.marker(latlng, options_notdraggable)
* .bindPopup(feature.properties.name);
*}
*}
*}).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_967.html--&gt;</code></pre>
<p>Im vorhergehenden Programmcodebeispiel sehen Sie, 
wie ein Marker erstellt und mit einem individuellen Pop-up Text versehen wird. 
Das Ergebnis ist auf den ersten Blick genau das Gleiche, 
wie im vorhergehenden Kapitel. 
Welcher Pop-up Text dem Marker genau zugewiesen wird, 
ist in dem Beispiel auch von der Eigenschaft <code>feature.properties.name</code> abhängig. 
Zusätzlich werden in diesem Beispiel Optionen von dem Namen abhängig gemacht. 
Nur der Marker von Dorf 1 kann auf der Karte verschoben werden. 
Der größte Unterschied ist aber, dass wir den Marker hier selbst erstellen 
und deshalb Einfluss auf die Optionen haben.</p>
<p>Sehen Sie sich die Karte, die Sie in der folgenden Abbildung sehen, 
in Ihrem Browser an. 
Auf den ersten Blick hat sich nichts zu dem Beispiel des vorherigen Kapitels geändert. 
Auf den zweiten Blick werden Sie feststellen, dass Sie nur den Marker von 
Dorf 1 auf der Karte verschieben können.</p>
<p><img src="../Images/956.png" alt="Drei Marker auf einer Karte. Sie können nur einen Marker mit der Maus bewegen." /></p>
<p><em>Abbildung: Drei Marker auf einer Karte. Sie können nur einen Marker mit der Maus bewegen.</em></p>
<h4 id="filtern-mit-der-option-filter">Filtern mit der Option filter</h4>
<p>Mithilfe der Option <code>filter</code> können Sie große Datenbestände auf das 
Wesentliche beschränken. Sehen Sie sich dies <em>im Kleinen</em> im nächsten Beispiel an.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
 var geojsonFeatureCollection =
 {
 "type": "FeatureCollection",
 "features":
 [
 {
 "type": "Feature",
 "geometry": {"type": "Point", "coordinates": [6, 50]},
 "properties": {"name": "Dorf 1"}
 },
 {
 "type": "Feature",
 "geometry": {"type": "Point", "coordinates": [7, 50]},
 "properties": {"name": "Dorf 2"}
 },
 {
 "type": "Feature",
 "geometry": {"type": "Point", "coordinates": [7, 51]},
 "properties": {"name": "Dorf 3"}
 }
 ]
 };
 var options = {
 draggable: true,
 title: "Ein Ort in der Nähe von Gering"
 };
*L.geoJson(geojsonFeatureCollection, {
*filter: function(feature, latlng) {
*switch (feature.properties.name) {
*case "Dorf 1": return true;
*default:  return false;
*}
*}
*}).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_966.html--&gt;</code></pre>
<p>Im Beispiel sehen Sie, dass auf einem GeoJSON Layer nur die Elemente angezeigt werden, 
deren Rückgabewert beim Filtern positiv oder <code>true</code> ist. Im Beispiel bedeutet dies genau,
das nur die Marker angezeigt werden, bei den 
<code>feature.properties.name</code> gleich <code>Dorf 1</code> ist. Nur hier wird, wegen<br />
<code>case "Dorf 1": return true</code> ein positiver Wert, also <code>true</code>, zurück gegeben. 
Ansonsten, ist die Ausgabe der Filterfunktion wegen <code>default:  return false;</code> gleich <code>false</code>.</p>
<p>Die nachfolgende Abbildung zeigt es Ihnen: Nur Dorf 1 wird angezeigt. 
Die beiden anderen Orte, die sich in den GeoJSON Daten befinden, 
werden heraus gefiltert. Sie sehen nur einen Marker.</p>
<p><img src="../Images/955.png" alt="Nur ein Marker wird angezeigt! Alle anderen Marker werden herausgefiltert." /></p>
<p><em>Abbildung: Nur ein Marker wird angezeigt! Alle anderen Marker werden herausgefiltert.</em></p>
<h2 id="diesem-kapitel-haben-wir">In diesem Kapitel haben wir …</h2>
<p>In diesem Kapitel haben wir uns das Format GeoJSON genau angesehen. 
Wir haben die GeoJSON Typen mit den Objekten, die wir mit Leaflet erstellen können, verglichen. 
Außerdem haben wir viele der Methoden und Optionen, die Leaflet zum Arbeiten mit GeoJSON bietet, 
angewandt. 
Wir können nun eine Karte mit Daten füllen! Im nächsten Kapitel sehen wir uns an, 
wie wir mit den Daten auch </p>
<ul>
<li>Aussagen treffen oder </li>
<li>Fragen beantworten </li>
</ul>
<p>können.</p><h1 id="heatmaps-und-choroplethenkarten">Heatmaps und Choroplethenkarten</h1>
<p><a href="#" id="HeatmapsundChoroplethenkarten"></a></p>
<p>In den vorherigen Kapiteln haben wir uns angesehen, 
wie Sie Elemente direkt – oder mithilfe von in GeoJSON formatierten Daten – 
zu Ihrer Karte hinzugefügt können. 
Jetzt geht es darum, dieses Wissen in die Tat umzusetzen und eigene 
Vorstellungen umzusetzen.</p>
<h2 id="diesem-kapitel-werden-wir">In diesem Kapitel werden wir …</h2>
<p>In diesem Kapitel werden wir nicht nur einfach Elemente auf die Karte zeichnen. 
Wir werden mit der Karte Informationen weitergeben und Fragen beantworten. 
Insbesondere statistische Daten können auf Karten viel besser veranschaulicht werden, 
als in einer trockenen Tabelle – und nebenbei macht es sogar Spaß 
eine solche Karte zu erkunden.</p>
<p>Zwei Typen von Karten – nämlich Heatmaps und Choroplethenkarten – sehen wir uns 
nun in diesem Kapitel näher an. Beginnen wir mit der Heatmap.</p>
<h2 id="heatmaps">Heatmaps</h2>
<p><a href="https://de.wikipedia.org/w/index.php?title=Heatmap&amp;oldid=181851051">Heatmaps</a> kennen wir im Deutschen auch 
unter dem Namen Wärmebild.</p>
<h3 id="was-ist-eine-heatmap">Was ist eine Heatmap?</h3>
<p>Eine Heatmap ist im Grunde genommen ein Diagramm, 
mit dem Daten visualisiert werden. 
Diese Visualisierung dient dazu, in einer großen Datenmenge intuitiv 
und schnell einen Überblick zu bekommen. 
In der grafischen Darstellung kristallisieren sich besonders 
markante Werte oft schnell heraus.</p>
<p>Heatmaps färben Bereich unterschiedlich, wenn die <em>Intensität</em> oder die <em>Dichte</em> 
des untersuchten Objektes unterschiedlich ist.</p>
<blockquote>
<p>Möchten
Sie gerne wissen, wie die Darstellung einer Heatmap technisch
umgesetzt wird? Vereinfacht ausgedrückt wird zunächst ein
Gitternetz über die Karte gelegt. Im nächsten Schritt wird die Anzahl 
der Punkte in jedem Bereich des Gitternetzes gezählt. Je nach Punktanzahl 
wird zum Schluss die
Anzeige angepasst. Ist in einem Bereich kein Punkt vorhanden, wird
dieser Bereich nicht mit Farbe gefüllt. Bei den anderen Bereichen
wird je nach Anzahl der Punkte die passende Farbe im Bereich eingeblendet.
Dieses Verfahren nennt man Multivariate Kerndichte Schätzung
(englisch: Multivariate kernel density estimation). Detaillierter
können Sie dies beispielsweise bei 
<a href="https://de.wikipedia.org/w/index.php?title=Kerndichtesch%C3%A4tzer&amp;oldid=182712162">Wikipedia</a> 
nachlesen.</p>
</blockquote>
<p><img src="../Images/946.png" alt="(By Drleft (Own work) [CC BY-SA 3.0 (http://creativecommons.org/licenses/by-sa/3.0) or GFDL (http://www.gnu.org/copyleft/fdl.html)], via Wikimedia Commons)" /></p>
<p><em>Abbildung: (By Drleft (Own work) [CC BY-SA 3.0 (<a href="http://creativecommons.org/licenses/by-sa/3.0">http://creativecommons.org/licenses/by-sa/3.0</a>) or GFDL (<a href="http://www.gnu.org/copyleft/fdl.html">http://www.gnu.org/copyleft/fdl.html</a>)], via Wikimedia Commons).</em></p>
<p>Meist werden bei geringer Intensität oder geringer Dichte kalte Farben verwendet. 
Bei einem hohen Aufkommen wird der Bereich mit warmen Farben eingefärbt. 
Dies erklärt auch den Namen Heatmap – der englische Begriff für Hitze ist <em>heat</em>. 
Blau gilt als <a href="https://de.wikipedia.org/w/index.php?title=Kalte_Farbe&amp;oldid=182760035">kalte Farbe</a>, 
Rot, Orange und Gelb gelten als <a href="https://de.wikipedia.org/w/index.php?title=Warme_Farbe&amp;oldid=137765311">warme Farben</a>.</p>
<h3 id="heatmaps-leaflet-dichte">Heatmaps in Leaflet – Dichte</h3>
<p>Unser erstes Beispiel zeigt eine Heatmap, die die unterschiedliche Dichte 
von Punkten sichtbar macht. Die Funktionen zum Anzeigen einer Heatmap werden nicht 
im Standardumfang von Leaflet mitgeliefert. 
Es handelt sich hierbei um eine besondere Funktion, 
die im Normalfall nicht zur Darstellung einer digitalen Karte benötigt wird. 
Leaflet selbst konzentriert sich auf die Anwendungsfälle, 
die üblicherweise beim Anzeigen einer Karte benötigt werden – 
ist aber offen für Plugins. 
Eines dieser Plugins ist <a href="https://github.com/Leaflet/Leaflet.heat">Leaflet.heat</a>.</p>
<blockquote>
<p>Weitere Plugins, mit denen Sie
Wärmeabbildungen oder ähnliche Visualisierungen aus Vektordaten
erstellen können, finden Sie auf der Website von Leaflet im Bereich
Plugins: <a href="http://leafletjs.com/plugins.html#heatmaps">http://leafletjs.com/plugins.html#heatmaps</a>.</p>
</blockquote>
<p>Nachfolgende finden Sie das erste Beispiel für diesen Themenbereich.</p>
<pre><code>&lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="leaflet-heat.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.00555, 7.591838], 10);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var points = [
*[50.1555, 7.591838, 0.2],
*[50.0931, 7.664177, 0.2],
*...
*[50.088041, 7.652033, 0.2],
*[50.088041, 7.652033, 0.2],
*[50.088041, 7.652033, 0.2],
*[50.088041, 7.652033, 0.2]
*];
*var heat = L.heatLayer(points,
*{
*minOpacity: 0.95,
*blur: 15,
*maxZoom: 15,
*max: 1,
*radius: 15,
*gradient: {0.4: 'blue', 0.65: 'lime', 1: 'red'}
*}).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_965.html--&gt;</code></pre>
<p>Was zeigt Ihnen dieses Beispiel? 
Als Erstes haben wir die Skript-Datei zum Plugin mit 
<code>&lt;script src="leaflet-heat.js"&gt;&lt;/script&gt;</code> eingebunden. 
Ich hatte die Datei von der oben verlinkten Website kopiert und unter dem Namen 
<code>leaflet-heat.js</code> im gleichen Verzeichnis wie die Datei <code>index.html</code> abgelegt. 
Danach habe ich eine Variable mit dem Namen <code>points</code> vom Typ <code>Array</code> erstellt. 
In dieser Variablen habe ich 700 Koordinaten gespeichert. 
Zu guter Letzt habe ich ein Objekt der Klasse <code>L.heatLayer</code> instanziiert 
und diesem die Koordinaten in der Variablen <code>points</code> und einige Optionen übergeben.</p>
<blockquote>
<p>Der Dritte Wert bei der Übergabe der
Koordinaten steht für die Intensität.<br />
<code>var points = [</code><br />
<code>[50.1555 , 7.591838 ,</code><strong><code>0.2</code></strong><code>],</code><br />
<code>…</code><br />
Ich habe diesen Wert hier absichtlich immer mit der gleichen Zahl belegt. 
Ich nutze dieses Plugin nicht für die Visualisierung der Intensität. 
Hierfür zeige ich Ihnen im nächsten Kapitel eine andere Leaflet Erweiterung.</p>
</blockquote>
<p>Das Ergebnis sehen Sie im nachfolgenden Bild. 
Da wir noch nichts gestaltet haben, sehen Sie die Standardansicht. 
Diese ist noch sehr rudimentär. Das geht besser, Sie werden sehen.</p>
<p><img src="../Images/950.png" alt="Heatmap" /></p>
<p><em>Abbildung: Heatmap zur Anzeige der Dichte von Punkten.</em></p>
<h4 id="stile-und-optionen">Stile und Optionen</h4>
<p>Das <a href="https://github.com/Leaflet/Leaflet.heat">Plugin Leaflet.heat</a> 
erlaubt es Ihnen Parameter zu übergeben. Dabei haben Sie folgende Möglichkeiten:</p>
<ul>
<li><code>minOpacity:</code><br />
Die Option  <code>minOpacity</code>  gibt die minimale Dichte an, ab der die Anzeige beginnt. </li>
<li><code>maxZoom:</code><br />
Die Opiton <code>maxZoom</code> sollte auf die Zoomstufe gesetzt werden, 
bei der die Punkte die maximale Intensität erreichen. 
Als Standard wird der Wert, der für <code>maxZoom</code> in der Karte gesetzt ist, 
verwendet. 
Auf die Darstellung der Heatmap Ebene hat diese Option keine Auswirkungen. 
Sie sollten den Wert so setzten, dass Ihre Karte die beste Aussagekraft hat. 
Wenn der Wert zu hoch ist, kann es sein, dass die Punkte so weit auseinander liegen, 
dass der dichteste Bereich nicht mehr deutlich erkennbar ist. 
Setzen Sie den Wert zu niedrig an, kann man die Daten vielleicht nicht mehr 
zusammenhängend im Überblick sehen. </li>
<li><code>max:</code><br />
Der Standardwert der maximalen Punktintensität ist 1.0. </li>
<li><code>radius:</code><br />
Diese Option erklärt sich meiner Meinung nach von selbst. 
Mit dem Wert <code>radius</code> geben Sie die Größe an, in der die Punkte angezeigt 
werden sollen. 25 ist der Standardwert. </li>
<li><code>blur:</code><br />
Mit der Option <code>blur</code> können Sie die Schärfe beeinflussen. 
Der Wert bestimmt, wie viele Punkte zusammen gefasst werden. 
Ein niedriger <code>blur</code> Wert erzeugt einzelne Punkte, wohingegen ein hoher Wert 
Punkte zusammenfasst. Standardmäßig ist der Wert auf 15 festgesetzt. </li>
<li><code>gradient:</code><br />
Die Option  <code>gradient</code>  steht für die Konfiguration des Farbverlaufs. 
Standardwert ist  <code>{0.4: 'blue', 0.65: 'lime', 1: 'red'}</code>. 
Sie können beliebig viele Werte zwischen 0 und 1 zwischen den Klammern angeben. 
Die Farbe, die am Rand angezeigt werden soll, 
sollten Sie mit dem niedrigen Wert angeben. 
Der Rand ist der Bereich in dem die Punkte nicht dicht beieinander sind. 
Die Farbe, die im Zentrum zu sehen sein soll, 
geben Sie idealerweise nahe beim Wert 1 an. 
Das Zentrum ist der Bereich in dem die Punkte am dichtesten beieinander liegen. </li>
</ul>
<h5 id="nachfolgend-sehen-sie-einen-vergleich-einer-ansichten-mit-un">Nachfolgend sehen Sie einen Vergleich einer Ansichten mit unterschiedlichen Werten für die Optionen blur, gradient und maxZoom</h5>
<p><img src="../Images/980a.png" alt="`blur` *= 1*" /></p>
<p><em>Abbildung: <code>blur</code> </em>= 1<em> - Es werden soviele Punkte zusammengefasst, dass jeder Hitzepunkt der Heatmap sehr scharf dargestellt wird. Ein Zentrum ist nicht mehr auszumachen.</em></p>
<p><img src="../Images/980b.png" alt="`blur` *= 40*" /></p>
<p><em>Abbildung: <code>blur</code> </em>= 40<em> - Randbereiche und Zentrum sind erkennbar.</em></p>
<p><img src="../Images/980c.png" alt="`maxZoom` * = 6*" /></p>
<p><em>Abbildung: <code>maxZoom</code> </em> = 6<em> - Bei dieser niedrigen Zoomstufe kann die Verteilung nicht visualisiert werden. Alles liegt so nah beieinander, dass nur ein Punkt zu sehen ist.</em></p>
<p><img src="../Images/980d.png" alt="`maxZoom` * = 15*" /></p>
<p><em>Abbildung: <code>maxZoom</code> </em> = 15<em> - Bei dieser Zoomstufe kann eine Verteilung dargestellt werden.</em></p>
<p><img src="../Images/980e.png" alt="`gradien {0.1: &#039;#edf8fb&#039;, 0.2: &#039;#ccece6&#039;, 0.3: &#039;#99d8c9&#039;, 0.5: &#039;#66c2a4&#039;, 0.7: &#039;#2ca25f&#039;, 1: &#039;#006d2c&#039;}`" /></p>
<p><em>Abbildung: Eine Heatmap mit benutzerdefinierten Farben: <code>gradien {0.1: '#edf8fb', 0.2: '#ccece6', 0.3: '#99d8c9',</code> <code>0.5: '#66c2a4', 0.7: '#2ca25f', 1: '#006d2c'}</code>.</em></p>
<blockquote>
<p>Gefallen Ihnen die standardmäßig gesetzten kalten und warmen
Farben nicht? Möchten Sie lieber Ihre eigene Farbzusammenstellung
nutzen? Die Website <a href="http://colorbrewer2.org">http://colorbrewer2.org</a> 
hilft beim Auswählen von Farben.</p>
</blockquote>
<h4 id="methoden">Methoden</h4>
<p>Zusätzlich zu den Stylesheet Optionen bietet Ihnen das Plugin  <code>Leaflet.heat</code>  vier Methoden:</p>
<ul>
<li><code>setOptions(options):</code><br />
Diese Methode setzt die Optionen der Heatmap neu und zeichnet die Heatmap neu. </li>
<li><code>addLatLng(latlng):</code><br />
Diese Methode fügt einen Punkt zur Heatmap hinzu und aktualisiert 
die Ansicht gleichzeitig. </li>
<li><code>setLatLngs(latlngs):</code><br />
Diese Methode liest die Daten neu ein und aktualisiert danach die Ansicht. </li>
<li><code>redraw():</code><br />
Diese Methode zeichnet die Heatmap neu. 
Sie wird beim Ausführen der drei vorher genannten Methoden automatisch ausgeführt, 
so das Sie dies nicht selbst veranlassen müssen. </li>
</ul>
<h5 id="ein-beispiel-zur-anwendung-der-methoden-die-methode-addlatln">Ein Beispiel zur Anwendung der Methoden - Die Methode addLatLng()</h5>
<p>Mithilfe der Methode <code>addLatLng()</code> können Sie nachträglich 
einen Punkt zum Heatmap Layer hinzufügen.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
*&lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;script src="leaflet-heat.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 10);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
 var points = [
 [50.1555, 7.591838, 0.2],
 [50.0931, 7.664177, 0.2],
 ...
 [50.088041, 7.652033, 0.2],
 [50.088041, 7.652033, 0.2],
 [50.088041, 7.652033, 0.2]
 ];
 var heat = L.heatLayer(points,
 {
 minOpacity: 0.95,
 blur: 15,
 maxZoom: 15,
 max: 1.0,
 radius: 25,
 gradient: {0.4: 'blue', 0.65: 'lime', 1: 'red'}
 }).addTo(mymap);
*heat.addLatLng([50.27264, 7.26469, 0.2]);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_964.html--&gt;</code></pre>
<p>In der nächsten Abbildung können Sie den neu hinzugefügten Punkt erkennen.</p>
<p><img src="../Images/979.png" alt="Heatmap mit einem mithilfe der Methode `addLatLng` hinzugefügten Punkt." /></p>
<p><em>Abbildung: Heatmap mit einem mithilfe der Methode <code>addLatLng</code> hinzugefügten Punkt.</em></p>
<blockquote>
<p>Möchten Sie es Website Besuchern 
ermöglichen selbst Punkte zur Heatmap auf ihrer Karte hinzuzufügen? Eine
Demo auf der Website zum Plugin zeigt genau solch ein Beispiel: 
<a href="http://leaflet.github.io/Leaflet.heat/demo/draw.html">http://leaflet.github.io/Leaflet.heat/demo/draw.html</a></p>
</blockquote>
<h5 id="die-methoden-addlatlng-addlatlngs-und-setoptions-der-klasse">Die Methoden addLatLng(), addLatLngs() und setOptions() der Klasse L.heatLayer zusammen in einem Beispiel</h5>
<p>In diesem Kapitel stelle ich Ihnen ein Beispiel vor, 
das per Schaltfläche die verschiedenen Methoden anwendet.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="leaflet-heat.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
*&lt;button onclick="add()"&gt;
*Punkt hinzufügen
*&lt;/button&gt;
*&lt;br&gt;
*&lt;button onclick="newPoint()"&gt;
*Daten neu setzen
*&lt;/button&gt;
*&lt;br&gt;
*&lt;button onclick="reset()"&gt;
*Reset
*&lt;/button&gt;
*&lt;br&gt;
*&lt;button onclick="setOptions()"&gt;
*Farben ändern
*&lt;/button&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([49.07264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
 var points = [
 [50.1555, 7.591838, 0.2],
 [50.0931, 7.664177, 0.2],
 ...
 [50.088041, 7.652033, 0.2],
 [50.088041, 7.652033, 0.2],
 [50.088041, 7.652033, 0.2]
 ];
 var heat = L.heatLayer(points,
 {
 minOpacity: 0.95,
 blur: 15,
 maxZoom: 15,
 max: 1.0,
 radius: 25,
 gradient: {0.4: 'blue', 0.65: 'lime', 1: 'red'}
 }).addTo(mymap);
*function add()
*{
*heat.addLatLng([50.1, 7.1, 0.2]);
*}
*function newPoint()
*{
*heat.setLatLngs([[50.5, 7, 0.2]]);
*}
*function reset()
*{
*heat.setLatLngs(points);
*}
*function setOptions()
*{
*heat.setOptions({gradient: {0.4: 'black', 0.65: 'gray', 1: 'white'}
*});
*}
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_963.html--&gt;</code></pre>
<p>Was passiert genau in diesem Beispiel? 
Zunächst fügen wir vier Schaltflächen in das HTML-Dokument ein. 
Jede Schaltfläche führt eine der Methoden <code>add()</code>, <code>newPoint()</code>, <code>reset()</code> 
oder <code>setOptions()</code> der Klasse L.heatLayer aus, wenn sie angeklickt wird.  </p>
<ul>
<li>Der Aufruf von <code>add()</code> führt den Code <code>heat.addLatLng([50.1, 7.1, 0.2]);</code> aus 
und fügt dabei den Punkt <code>[50.1, 7.1, 0.2]</code> zu den Daten der  Heatmap Ebene hinzu.   </li>
<li>Die Methode <code>newPoint()</code> führt die Programmcodezeile 
<code>heat.setLatLngs([[50.5, 7, 0.2]]);</code> aus und setzt 
dabei die Daten der Heatmap Ebene neu. 
Die Heatmap Ebene enthält nun nur den einen Punkt <code>[[50.5, 7, 0.2]]</code> im Array.   </li>
<li>Die Methode <code>reset()</code> führt den Code 
<code>heat.setLatLngs(points);</code> aus und ersetzt damit die Daten der 
Heatmap Ebene wieder mit den Daten der Variablen <code>points</code>.<br />
<strong>Achtung:</strong>  Wenn Sie einen Punkt zum Layer hinzugefügt haben, 
als die Variable <code>points</code> Datenbestand des Layers war, 
dann ist dieser Punkt nun auch in der Variablen <code>points</code> enthalten! </li>
<li>Die Methode <code>setOptions()</code> ist meiner Meinung nach selbsterklärend. 
Sie ändert einfach das Aussehen, also die CSS-Eigenschaften der Ebene. </li>
</ul>
<p>Einen Screenshot der Karte zu diesem Beispiel sehen Sie in der nachfolgenden 
Abbildung.</p>
<p><img src="../Images/953.png" alt="Eine Karte mit Schaltfläche die die Methoden `add()`, `newPoint()`, `reset()` oder `setOptions()` per Klick ausführen." /></p>
<p><em>Abbildung: Eine Karte mit Schaltfläche die die Methoden <code>add()</code>, <code>newPoint()</code>, <code>reset()</code> oder <code>setOptions()</code> der Klasse L.heatLayer per Klick ausführen.</em></p>
<h4 id="marker">Marker</h4>
<p>Im nächsten Beispiel zeige ich Ihnen, wie Sie zu jedem Punkt in einer Heatmap 
einen Marker hinzufügen können. Das ist ganz praktisch, wenn Sie die Eigenschaften 
der einzelnen Punkte aufzeigen möchten.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;script src="leaflet-heat.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.1555 , 7.591838], 10);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
 var points = [
*[50.1555 , 7.591838 , "&lt;img src='http://lorempixel.com/200/200/'&gt;"],
* [50.0931 , 7.664177 , "&lt;img src='http://lorempixel.com/200/200/'&gt;"],
 ...
*[50.088041 , 7.652033 , "&lt;img src='http://lorempixel.com/200/200/'&gt;"],
*[50.088041 , 7.652033 , "&lt;img src='http://lorempixel.com/200/200/'&gt;"]
 ];
*for(var i=0;i&lt;points.length;i++)
*{
*L.marker(
*[parseFloat(points[i][0]),parseFloat(points[i][1])],
*{opacity:0}).bindPopup(points[i][2],{keepInView:true}).addTo(mymap);
*}

 var heat = L.heatLayer(points,
 {
 minOpacity: 0.95,
 blur: 15,
 maxZoom: 15,
 max: 1,
 radius: 15,
 gradient: {0.4: 'blue', 0.65: 'lime', 1: 'red'}
 }).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_962.html--&gt;</code></pre>
<p>Was ist in diesem Beispiel anders? Wir haben der Variablen <code>point</code> 
einen dritten Wert mitgegeben. Dieser dritte Wert beschreibt 
die Adresse zu einem Image. Dies hätte aber auch ein gewöhnlicher Text sein können. 
Diesen dritten Wert haben wir dann in der Methode 
<code>bindPopup(points[i][2],{keepInView)</code> 
dazu genutzt, einen individuellen Marker zu kreieren.</p>
<p>So wie in der nächsten Abbildung könnte die fertige Karte auch bei Ihnen aussehen.</p>
<p><img src="../Images/980.png" alt="Eine Heatmap mit benutzerdefinierten Markern pro Hitzepunkt." /></p>
<p><em>Abbildung: Eine Heatmap mit benutzerdefinierten Markern pro Hitzepunkt.</em></p>
<h3 id="heatmaps-mit-leaflet-intensitat">Heatmaps mit Leaflet – Intensität</h3>
<p>Im vorhergehenden Kapitel haben wir eine Heatmap mithilfe des 
Plugins <a href="https://github.com/Leaflet/Leaflet.heat">Leaflet.heat</a> erstellt. 
Diese Heatmap hat die Dichte von Punkten auf einer Karte visualisierte. 
Wir haben bisher die Möglichkeit die Intensität zu visualisieren nicht genutzt. 
Ich stelle Ihnen hier ein anderes Plugin für diesen Zweck vor. 
Als nächstes möchte ich nun mit Ihnen eine Heatmap, die die Intensität 
der Eigenschaft eines Punktes darstellt, mithilfe des Plugins 
<a href="https://github.com/pa7/heatmap.js">heatmap.js</a> erarbeiten. 
Herunterladen können Sie das Plugin unter der Adresse 
<a href="https://www.patrick-wied.at/static/heatmapjs/plugin-leaflet-layer.html">https://www.patrick-wied.at/static/heatmapjs/plugin-leaflet-layer.html</a>. 
Hier finden Sie auch die Dokumentation zum Plugin.</p>
<p>Nachfolgende sehen Sie das erste Beispiel.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="heatmap.js"&gt;&lt;/script&gt;
*&lt;script src="leaflet-heatmap.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var myData={
 max: 100,
*data: [
*{lat: 51.0934, lon:8.666819, value: 99},
*{lat: 51.0972, lon:8.667964, value: 99},
*...
*{lat: 50.088041, lon:7.652033, value: 23},
*{lat: 50.088041, lon:7.652033, value: 23}]
*};
 var baseLayer = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png');
*var cfg = {
*"radius": .1,
*"maxOpacity": .5,
*"scaleRadius": true,
*"useLocalExtrema": true,
*latField: 'lat',
*lngField: 'lon',
*valueField: 'value'
*};
*var heatmapLayer = new HeatmapOverlay(cfg);
*heatmapLayer.setData(myData);
*var map = new L.Map('mapid', {
*center: new L.LatLng(50.0586, 7.6568),
*zoom: 8,
*layers: [baseLayer, heatmapLayer]
*});
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_961.html--&gt;</code></pre>
<p>Was zeigt Ihnen dieses Beispiel genau? Sie sehen, dass Sie neben dem Skript 
<code>leaflet.heat.js</code> auch das Skript <code>heat.js</code> einbinden können oder müssen. 
Als nächstes müssen Sie die Daten, die Sie visualisieren möchten, 
angeben – diese müssen eine Angabe zu dem maximal möglichen Wert enthalten: 
<code>var myData={</code><strong><code>max:100</code></strong><code>, data: [ {lat: 51.0934, lon:8.666819, value: 99} ….</code>. 
Danach können Sie die Heatmap Ebene erstellen. 
Der Übersicht halber habe ich die Optionen der Heatmap Ebene in einer separaten Variablen, 
nämlich der Variablen <code>cfg</code>, definiert. 
Die Anweisung zum Erstellen der Heatmap Ebene mit den Optionen in der Variablen 
<code>cfg</code> lautet <code>var heatmapLayer = new HeatmapOverlay(cfg);</code>. 
Dieser Ebene können Sie nun die Daten mit dem Befehl 
<code>heatmapLayer.setData(myData);</code> hinzufügen. 
Zum Schluss fügen Sie diesen Layer nun zum Kartenobjekt hinzu. 
Die Anweisung hierfür lautet: 
<code>L.Map('mapid', { center: new L.LatLng(50.0586, 7.6568),</code> <code>zoom: 8, layers: [baseLayer,</code><strong><code>heatmapLayer</code></strong><code>]});</code>.</p>
<p>Wie das aussehen sollte, können Sie sich in der nächsten Abbildung ansehen.</p>
<p><img src="../Images/952.png" alt="Eine Heatmap - erstellt mithilfe des Plugins [heatmap.js](https://github.com/pa7/heatmap.js) - die die Intensität darstellt." /></p>
<p><em>Abbildung: Eine Heatmap - erstellt mithilfe des Plugins <a href="https://github.com/pa7/heatmap.js">heatmap.js</a> - die die Intensität darstellt.</em></p>
<h4 id="dokumentation-und-methoden">Dokumentation und Methoden</h4>
<p>Das nachfolgende Beispiel demonstriert Ihnen, wie unterschiedlich Punkte 
mit unterschiedlicher Intensität aussehen können.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;script src="heatmap.js"&gt;&lt;/script&gt;
 &lt;script src="leaflet-heatmap.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var myData={
*max: 100,
 data: [
 {lat: 51.0934, lon:8.666819, value: 99},
 {lat: 51.0972, lon:8.667964, value: 99},
 ...
 {lat: 50.088041, lon:7.652033, value: 23},
 {lat: 50.088041, lon:7.652033, value: 23}]
 };
 var baseLayer = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png');
 var cfg = {
 "radius": .1,
 "maxOpacity": .5,
 "scaleRadius": true,
 "useLocalExtrema": true,
 latField: 'lat',
 lngField: 'lon',
 valueField: 'value',
 gradient: {
 '.4': 'blue',
 '.8': 'lime',
 '.95': 'red'
 },
 blur: 0.75
 };
 var heatmapLayer = new HeatmapOverlay(cfg);
 var map = new L.Map('mapid', {
 center: new L.LatLng(50.0586, 7.6568),
 zoom: 8,
 layers: [baseLayer, heatmapLayer]
 });
 heatmapLayer.setData(myData);
*var test1 = {lat:51,lon:6,value:99};
*var test2 = {lat:50.5,lon:6,value:60};
*var test3 = {lat:50,lon:6,value:40};
*var test4 = {lat:49.5,lon:6,value:20};
*heatmapLayer.addData(test1);
* heatmapLayer.addData(test2);
*heatmapLayer.addData(test3);
*heatmapLayer.addData(test4);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_960.html--&gt;</code></pre>
<p>Im vorhergehen Codebeispiel haben wir 4 Punkte mit unterschiedlicher 
Intensität zur Karte hinzugefügt. 
Die Werte für die Intensität betragen 99, 60, 40 und 20 bei einem maximalen Wert 
von 100. 
In der nachfolgenden Abbildung sehen Sie die unterschiedliche Darstellung 
auf der Karte.</p>
<p><img src="../Images/949.png" alt="Punkte mit unterschiedlicher Intensität auf einer Heatmap." /></p>
<p><em>Abbildung: Punkte mit unterschiedlicher Intensität auf einer Heatmap.</em></p>
<h3 id="interaktive-heatmaps">Interaktive Heatmaps</h3>
<p>Besonders spannend sind Karten, wenn wenn man sie bearbeiten und somit verändern kann. 
Auch eine Heatmap kann interaktiv programmiert werden. 
Sie können es beispielsweise Benutzern ermöglichen, 
Daten zur Heatmap Ebene hinzuzufügen. 
Wie das geht sehen Sie im nachfolgenden Beispiel.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
*&lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="leaflet-heat.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {doubleClickZoom:false}).setView([50.1555 , 7.591838], 15);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
 var points = [];
 var heat = L.heatLayer(points,
 {
 blur: 15,
 maxZoom: 15,
 max: 1.0,
 radius: 25,
 gradient: {0.4: 'blue', 0.65: 'lime', 1: 'red'}
 }).addTo(mymap);
*function addpoint(e){
*heat.addLatLng(e.latlng);
*}
*mymap.on('click', addpoint);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_959.html--&gt;</code></pre>
<p>Was haben wir genau gemacht? 
Als erstes haben wir mit der Zeile <code>&lt;script src="leaflet-heat.js"&gt;&lt;/script&gt;</code> 
das Plugin <code>leaflet.heat</code> eingebunden. In diesem konkreten Beispiel ist es wichtig, 
dass ein Doppelklick keine Änderung der Zoom-Stufen auf der Karte auslöst. 
Deshalb stellen wir sicher, dass jemand nicht versehentlich zu schnell klickt 
und ungewollt die Zoom-Stufe ändert, obwohl er eigentlich zwei Punkte hinzufügen 
möchte. 
Dies verhindern wir, indem wir die Option <code>doubleClickZoom</code> auf <code>false</code> setzen. 
Zu Beginn sollen in unserem Beispiel noch keine Daten auf der Karte angezeigt werden. 
Deshalb haben wir zunächst einen leeren Datensatz mit <code>var points = [];</code> erstellt. 
Diesen leeren Datensatz geben wir einem <code>L.heatLayer</code> Objekt bei der 
Instanziierung als Parameter mit: <code>var heat = L.heatLayer(points, {…}</code>. 
Nun fehlt noch die Methode, mit der ein Punkt hinzugefügt wird. 
Diese Methode ist mit der Anweisung 
<code>function addpoint(e){ heat.addLatLng(e.latlng); }</code> schnell erstellt. 
Und <code>mymap.on('click', addpoint);</code> bewirkt, dass diese auch ausgeführt wird, 
wenn jemand auf die Karte klickt.</p>
<p>Das Ergebnis sehen Sie im Browser, wenn Sie die HTML Datei dieses Beispiels öffnen. 
Zunächst wird die Karte ganz normal angezeigt. Sie sehen keinen Wärmepunkt. 
Wenn Sie mit der Maus eine Stelle auf der Karte klicken, 
wird an dieser Koordinate ein Wärmepunkt hinzugefügt.</p>
<p><img src="../Images/951.png" alt="Die Leaflet Karte dieses Beispiels, nachdem mit der Maus einmal auf sie geklickt wurde." /></p>
<p><em>Abbildung: Die Leaflet Karte dieses Beispiels, nachdem mit der Maus einmal auf sie geklickt wurde.</em></p>
<h3 id="animierte-heatmaps">Animierte Heatmaps</h3>
<p>Das ist fast wie Kino – im nächsten Beispiel verändert sich die Karte automatisch.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
*&lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="leaflet-heat.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {doubleClickZoom:false}).setView([50.1555 , 7.591838], 10);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var points = [];
*var points1 = [
*[50.1555 , 7.591838 ],
*...
*[50.088041 , 7.652033 ],
*[50.088041 , 7.652033 ]
*];
*var points2 = [
*[50.0371 , 7.618306 ],
*...
*[50.088041 , 7.652033 ],
*[50.088041 , 7.652033 ]
*];
*var points3 = [
*[50.088 , 7.65159 ],
*...
*[50.088041 , 7.652033 ],
*[50.088041 , 7.652033 ]
*];
*var heat = L.heatLayer(points).addTo(mymap);
*x=1;
*var name='';
*var interval = setInterval(function(){run()},2000);
*function run(){
*mymap.removeLayer(heat);
*name="points"+x.toString();
*heat = L.heatLayer(
*window[name],
*{blur:15,maxZoom:10,radius:25,
*gradient:{0.4: 'blue', 0.65: 'lime', 1: 'red'}})
*.addTo(mymap);
*if (x == 3)
*{
*x=1;
*}
*else
*{
*x++;
*}
*}
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_958.html&gt;</code></pre>
<p>Wie entsteht die Animation im Beispiel genau? Als erstes integrieren wir wieder 
die notwendigen Skripte. Danach erstellen wir die vier Daten-Arrays und nennen diese 
<code>points</code>, <code>points1</code>, <code>points2</code> und <code>points3</code>. Jedes Array enthält unterschiedliche 
Daten. Mit dem ersten leeren Array erstellen wir die Schicht mit den Daten für 
die Heatmap - also das Objekt des Typs <code>heatLayer</code>. 
Die Hilfsvariable <code>x</code> in Verbindung mit der Methode <code>setIntervall()</code> 
ermöglicht es uns dann, die Heatmap Ebenen fortlaufend mit anderen Daten 
zu belegen und somit andere Daten anzuzeigen.</p>
<blockquote>
<p>In diesem Beispiel habe ich zwei
JavaScript Elemente verwendet, die vielleicht erklärungsbedürftig
sind. Als erstes habe ich den Variablennamen mit <code>window[name]</code> zusammengesetzt. 
Was bedeutet dies genau? Da es sich um JavaScript Objekte handelt, 
wird jede Variable in einem globalen JavaScript Object gespeichert. 
Wenn Sie also die Variable <code>points1</code> im globalen Bereich initialisieren – 
also nicht in einem Funktionskontext –, 
dann schreiben Sie diese Variablen implizit in ein
globales Objekt. In einem Browser ist dies das <a href="https://developer.mozilla.org/de/docs/Web/API/Window">Objekt 
<code>window</code></a>.
Der Wert dieser Variablen kann mit der Punkt Notation oder der Klammer Notation
abgerufen werden. Also entweder mit var <code>name = window.points1;</code> oder mit 
<code>var name = window['points1'];</code>. 
Außerdem haben wir die <a href="https://developer.mozilla.org/de/docs/Web/API/WindowTimers/setInterval">Methode <code>setInterval()</code></a> 
eingesetzt. Mit dieser Methode können Sie eine Funktion
wiederholt aufrufen. Hierbei können Sie ein Intervall zwischen den
einzelnen Aufrufen definieren.</p>
</blockquote>
<p>So wie im nachfolgenden Bild sieht die Karte nur alle 6 Sekunden aus. 
In der Zwischenzeit wechselt die Ansicht zweimal.</p>
<p><img src="../Images/950.png" alt="Eine Heatmap mit wechselnden Daten - hier sehen Sie die Daten der Variablen `point1`." /></p>
<p><em>Abbildung: Eine Heatmap mit wechselnden Daten - hier sehen Sie die Daten der Variablen <code>point1</code>.</em></p>
<h2 id="choroplethenkarte">Choroplethenkarte</h2>
<p><a href="#" id="inChoroplethenkarte"></a></p>
<p>Im vorherigen Kapitel haben wir eine Heatmap zum visualisieren von Daten verwendet. 
Wir haben zunächst mithilfe des Plugin <code>leaflet.heat</code> Bereiche, 
in denen Punkte dichter vorkommen, farblich hervorgehoben. 
Dann haben wir zusätzlich das Plugin <code>heat.js</code> geladen und Bereiche, 
in denen die Punkte eine hohe Intensität haben, farblich besonders markiert.  </p>
<p>Eine <a href="https://de.wikipedia.org/w/index.php?title=Choroplethenkarte&amp;oldid=175744569">Choroplethenkarte</a> 
macht erst einmal nichts anderes. 
Sie visualisiert die Dichte oder die Intensität bestimmter Objekte. 
Sie tut dies aber auf eine andere Art und Weise als die Heatmap. </p>
<h3 id="was-genau-unterscheidet-eine-choroplethenkarte-von-einer-hea">Was genau unterscheidet eine Choroplethenkarte von einer Heatmap?</h3>
<p>Ich hatte Ihnen erklärt, das eine Heatmap ein Raster über die Karte legt. 
Je nachdem wie die zu visualisierenden Punkte in diesem Raster verteilt sind, 
werden Farben sichtbar. 
Eine Choroplethenkarte verwendet kein separates Raster. 
Sie verwendet ein Polygon. Ein Polygon kann zum Beispiel ein Land 
oder das Einzugsgebiet eines Unternehmens sein. 
Im Kapitel <a href="#DieKarteMitDatenBestuecken">Die Karte mit Daten bestücken</a> 
hatte ich die Besonderheit eines Polygons beschrieben. 
Dieses Vieleck hat eine Grenzlinie die einen Innenbereich und einen 
Außenbereich voneinander abgrenzt. 
Eine populäre Choroplethenkarte, die Sie sicherlich schon einmal gesehen haben, 
ist die Darstellung der Bevölkerungsdichte eines Gebietes auf der Erde. 
Ich habe hier ein Beispiel erstellt, welches genau dies tut. 
Ich zeige Ihnen, wie Sie eine Karte, die die Verteilung der Bevölkerung in 
Rheinland-Pfalz grafisch darstellt, selbst erstellen können.</p>
<h3 id="choroplethenkarten-leaflet">Choroplethenkarten in Leaflet</h3>
<p>Das Schöne ist, dass wir mit Leaflet keine zusätzlichen Plugins für das 
Erstellen einer Choroplethenkarte benötigen. 
Leaflet ist wie dafür gemacht, GeoJSON Daten als Choroplethenkarte anzuzeigen. 
Beginnen tun wir ganz vorne mit dem Klären der Frage: Wo bekommen Sie die Daten her?</p>
<h4 id="open-data">Open Data</h4>
<p><a href="#" id="ChoroplethenkarteOpenData"></a></p>
<p>Wenn Sie nicht selbst über Daten verfügen, können sie auf jede Menge 
offener Data zugreifen.</p>
<blockquote>
<p><a href="https://de.wikipedia.org/w/index.php?title=Open_Data&amp;oldid=182539018">Open Data</a>, 
also offene Daten, sind Daten, die von jedem ohne jegliche
Einschränkungen verwendet und weitergegeben werden dürfen. Warum
gibt es Open Data? Viele Menschen vertreten die Meinung, dass frei
nutzbare Daten zu mehr Transparenz und Zusammenarbeit führen. Die
Bereitstellung offener Daten durch öffentliche Einrichtungen wird
als eine Voraussetzung für 
<a href="https://de.wikipedia.org/w/index.php?title=Open_Government&amp;oldid=180459228">Open Government</a>, 
also der Öffnung von Regierung und Verwaltung
gegenüber der Bevölkerung und der Wirtschaft, angesehen. Die
Befürworter von Open Data teilen somit viele Argumente mit den
Befürwortern von <a href="https://de.wikipedia.org/w/index.php?title=Open_Source&amp;oldid=183919330">Open-Source</a>. 
Open Data und Leaflet als Open Source Software passen gut zusammen.</p>
</blockquote>
<p><a href="http://opendatalab.de/projects/geojson-utilities/">GeoJSON Utilities</a> 
ist ein Projekt, welches den Export von Gemeindeflächen, Landkreisflächen und 
Bundeslandflächen in Deutschland im GeoJSON Format ermöglicht. 
Jede exportierte Fläche enthält zusätzliche Eigenschaften wie die Einwohnerzahl 
und die Größe der Fläche in Quadratmetern. 
Ich habe diese Daten für Rheinland-Pfalz in eine Datei exportiert. 
Im nächsten Beispiel zeige ich Ihnen, wie Sie mithilfe dieser Datei 
eine Chorophletenkarte erstellen können. 
<a href="http://opendatalab.de/projects/geojson-utilities/">GeoJSON Utilities</a> 
ist übrigens auch eine mit Leaflet erstellte Anwendung.</p>
<p>Die Datei, die ich heruntergeladen haben, ist relativ groß. 
Deshalb habe ich die Daten in einer separaten Datei abgelegt. 
Ich schlage Ihnen vor, dies auch zu tun. 
So bleibt Ihre HTML-Datei übersichtlich und Sie können sich voll und ganz auf das 
Erstellen der Karte konzentrieren. 
Wenn Sie die Daten in einer JavaSript Datei ablegen, 
können Sie diese gleichzeitig als Variabel deklarieren. 
Wie das geht, zeigt ihnen das nachfolgende Beispiel. 
Zunächst sehen Sie die Datei, die die GeoJSON Daten enthält. 
Dieser Datei habe ich den Namen <code>gemeinden.js</code> gegeben. 
Die GeoJSON Daten werden in der Datei <code>gemeinden.js</code> in die Variable <code>ct</code> geladen.</p>
<pre><code>*var ct =
 {
 "type":"**FeatureCollection**",
 "crs":{
 "type":"name",
 "properties":{"name":"urn:ogc:def:crs:OGC:1.3:CRS84"}},
 "source":"© GeoBasis-DE / BKG 2013 (Daten verändert)",
*"features":[
*{"type":"Feature",**
 "properties":
 {
 "ADE":6,
 "GF":4,
 "BSG":1,
 "RS":"073345001001",
 "AGS":"07334001","SDV_RS":"073345001001",
 "GEN":"Bellheim",
 "BEZ":"Gemeinde",
 "IBZ":64,
 "BEM":"gemeinschaftsangehörig",
 "NBD":"ja",
 "SN_L":"07",
 "SN_R":"3",
 ...,
*"destatis":{
  "RS":"073345001001",
* "area":20.44,
  "area_date":"31.12.2014",
* "population":8519,
  "population_m":4198,
  "population_w":4321,
  "population_density":417,
  "zip":"76756",
  "center_lon":"8,284042",
  ..,
*"geometry":{
* "type":"Polygon",
* "coordinates":**[[[8.276302148832034,49.21145214735215],
   [8.295112386392997,49.21205183793759],
  ...
 ]]}},

*{"type":"Feature",*
 "properties":{"ADE":6,
 "GF":4,
 "BSG":1,
 "RS":"073405003205",
 "AGS":"07340205",
 "SDV_RS":"073405003205",
 ...
&lt;!--gemeinden.js&gt;</code></pre>
<p>In den Properties der einzelnen GeoJSON
Features sind unter anderem der Regionalschlüssel (<code>RS</code>), der
geographische Name (<code>GEN</code>), die amtliche Bezeichnung der
Verwaltungseinheit (<code>BEZ</code>) und die Destatis-Daten – insbesondere die Werte für 
die Größe der Fläche in Quadratmetern (<code>area</code>) und die Einwohnerzahl (<code>population</code>) – 
enthalten. Das vorherige Programmcodebeispiel zeigt nur einen Ausschnitt 
der Datei <code>gemeinden.js</code>. Beachten Sie, dass es sich nicht um reines GeoJSON handelt. 
Ganz genau handelt es sich um JavaScript. 
Dieser JavaScript Code deklariert eine Variable, nämlich die Variable <code>ct</code>. 
Einbinden können Sie die JavaScript Datei genau wie jedes andere Skript in Ihre 
HTML-Datei mit der Zeile</p>
<p><code>&lt;script src="gemeinden.js"&gt;&lt;/script&gt;</code></p>
<p>Wenn die Datei <code>gemeinden.js</code> richtig eingebunden ist, 
können Sie auf die GeoJSON Daten in dieser Datei ab nun über die Variable <code>ct</code> 
zugreifen.</p>
<h4 id="farben">Farben</h4>
<p>Der nächste Schritt zum Fertigstellen der Choroplethenkarte ist die Farbauswahl. 
Beim Erstellen der Heatmaps im vorhergehenden Kapitel haben wir Farben übergeben 
und das jeweilige Plugin hat diese entsprechend zugewiesen. 
Beim Erstellen der Choroplethenkarte müssen wir uns selbst um diese Aufgabe kümmern. 
Deshalb definieren wir eine Funktion, 
die je nach Wert eine bestimmte Farbe errechnet und zurück gibt. 
Idealerweise kennen Sie den höchsten Wert und den niedrigsten Wert in der Datenmenge. 
Dann können Sie, je nach Verteilung der Werte, 
bestimmten Wertbereichen eine Farbe zuordnen.</p>
<p>Der nachfolgende Programmcodeausschnitt nimmt den Parameter <code>x</code> entgegen und 
berechnet anhand des Wertes dieses Parameters eine Farbe. 
Die Funktion <code>color(x)</code> gibt bei einem höhere <code>x</code> Werte eine dunklere Farben aus. 
Bei einem niedrigeren <code>x</code> Wert gibt die Funktion eine hellere Farben zurück.</p>
<pre><code>function color(x) {
return x &gt; 1000 ? '#990000' :
x &gt; 750 ? '#d7301f' :
x &gt; 500 ? '#ef6548' :
x &gt; 250 ? '#fc8d59' :
x &gt; 200 ? '#fdbb84' :
x &gt; 100 ? '#fdd49e' :
x &gt; 0   ? '#fee8c8' :'#fff7ec';
}</code></pre>
<h4 id="stile">Stile</h4>
<p>Nun benötigen wir noch eine Funktion, die das Zuweisen des passenden CSS 
Stylesheets zu den Daten übernimmt. 
Nur so können wir jedes GeoJSON Feature individuell ansehen und 
ihm den passenden Stil zuweisen. Im nachfolgenden Programmcodeausschnitt 
sehen Sie eine Funktion, die als Parameter ein GeoJSON Feature erwartet. 
Je nach Eigenschaft im Feature gibt die Funktion die passenden Optionen zurück. 
Sie erkennen sicherlich sofort, dass die wesentliche Option die mit dem Namen 
<code>fillColor</code> ist. 
Hier ist genau die Stelle, an der wir die eben erstellte Funktion <code>color()</code> 
aufrufen und dieser als Parameter den Wert <code>feature.properties.destatis.population</code>, 
also die Bevölkerungsanzahl, mitgeben.</p>
<pre><code>function myStyle(feature) {
return {
fillColor: color(feature.properties.destatis.population),
weight: 1,
opacity: 1,
color: 'white',
fillOpacity: 0.85
};
}</code></pre>
<h4 id="das-vollstandige-beispiel">Das vollständige Beispiel</h4>
<p>Nachfolgenden habe ich die gerade besprochenen Codeschnipsel in einem 
vollständigen Beispiel zusammengesetzt.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
*&lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="gemeinden.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {doubleClickZoom:false}).setView([49.9555 , 7.591838], 8);
*L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*function color(x) {
*return x &gt; 1000 ? '#990000' :
*x &gt; 750 ? '#d7301f' :
*x &gt; 500 ? '#ef6548' :
*x &gt; 250 ? '#fc8d59' :
*x &gt; 200 ? '#fdbb84' :
*x &gt; 100 ? '#fdd49e' :
*x &gt; 0   ? '#fee8c8' :'#fff7ec';
*}
*function myStyle(feature) {
*return {
*fillColor: color(feature.properties.destatis.population),
*weight: 1,
*opacity: 1,
*color: 'white',
*fillOpacity: 0.85
*};
*}
*var geoJsonLayer = L.geoJson(ct, {style: myStyle}).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_957.html--&gt;</code></pre>
<p>In Ihrem Browser sollte die Karte nun so wie in der nächsten Abbildung aussehen.</p>
<p><img src="../Images/947.png" alt="Choroplethenkarten - Verteilung der Bevölkerung in Rheinland-Pfalz." /></p>
<p><em>Abbildung: Choroplethenkarten - Verteilung der Bevölkerung in Rheinland-Pfalz.</em></p>
<p>In diesem Beispiel haben wir einen festen Wert ganz unabhängig von anderen Werten 
verwendet. Wir haben die Bevölkerungszahl unabhängig von der Flächengröße 
der Gemeinde als Wert für die Farbe verwendet. 
In dieser Karte können wir zwar ablesen, wo die Gemeinden mit hoher Bevölkerungszahl 
sich befinden und wo die Gemeinden mit niedriger Bevölkerungsanzahl sind. 
Wie dicht die Besiedelung ist, sagt diese Karte aber nicht aus. 
Hierzu müssten wir die Bevölkerungszahl noch relativ zur Fläche der Gemeinde setzten. 
Dies tun wir nun im nächsten Beispiel.</p>
<h3 id="normalisierte-choroplethenkarten">Normalisierte Choroplethenkarten</h3>
<p>Es kommt sicherlich sehr oft vor, dass Sie mit einer Choroplethenkarten 
nicht nur einen absoluten Wert darstellen möchten. 
Oft möchten Sie die Daten zu anderen Daten ins Verhältnis stellen. 
Zum Beispiel könnten Sie den Anteil von Menschen, 
die älter als 60 Jahre sind, darstellen wollen. 
Da Geodaten einen Bezug zu einer Fläche haben, wird es in der Regel so sein, 
dass Sie die Daten in Relation zu dieser Fläche visualisieren möchten – diese also 
normalisieren möchten.</p>
<p>In unser GeoJSON Datei ist die Fläche der Gemeinde in der Eigenschaft 
<code>area</code> gespeichert. Wir können es uns also einfach machen und auf die Zahl 
die für die Fläche einer Gemeinde gespeichert ist, zugreifen. 
Um die Choroplethenkarte, die wir im vorhergehenden Kapitel erstellt haben zu 
normalisieren, ist somit nur ein Schritt – 
nämlich das Teilen der Bevölkerungsanzahl durch die Fläche des betreffenden Bereichs – 
erforderlich. Sehen wir uns das ganze Beispiel zusammenhängend an.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
*&lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="gemeinden.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
*&lt;button onclick="total()"&gt;Population&lt;/button&gt;
*&lt;button onclick="density()"&gt;Population/Fläche&lt;/button&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {doubleClickZoom:false}).setView([49.9555 , 7.591838], 8);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
 function color(x) {
 return x &gt; 1000 ? '#990000' :
 x &gt; 750 ? '#d7301f' :
 x &gt; 500 ? '#ef6548' :
 x &gt; 250 ? '#fc8d59' :
 x &gt; 200 ? '#fdbb84' :
 x &gt; 100 ? '#fdd49e' :
 x &gt; 0   ? '#fee8c8' :'#fff7ec';
 }
 function densityColor(x) {
 return x &gt; 500 ? '#990000' :
 x &gt; 400 ? '#d7301f' :
 x &gt; 300 ? '#ef6548' :
 x &gt; 200 ? '#fc8d59' :
 x &gt; 100 ? '#fdbb84' :
 x &gt; 50  ? '#fdd49e' :
 x &gt; 0   ? '#fee8c8' :'#fff7ec';
 }
 function myStyle(feature) {
 return {
 fillColor: color(feature.properties.destatis.population),
 weight: 1,
 opacity: 1,
 color: 'white',
 fillOpacity: 0.85
 };
 }
*function myDensityStyle(feature) {
*return {
*fillColor: 
*densityColor(feature.properties.destatis.population/feature.properties.destatis.area),
*weight: 1,
*opacity: 1,
*color: 'white',
*fillOpacity: 0.85
*};
*}
 function total(){
 var geoJsonLayer = L.geoJson(ct, {style: myStyle}).addTo(mymap);
 removeLayer(densitylayer);
 }
 function density(){
 var densitylayer=L.geoJson(ct, {style: myDensityStyle}).addTo(mymap);
 removeLayer(geoJsonLayer);
 }
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_956.html--&gt;</code></pre>
<p>Das vorhergehende Codebeispiel baut auf dem davor erstellten Codebeispiel auf. 
Neben der <code>style</code> Funktion fügen wir eine weitere Funktion, 
nämlich die Funktion <code>densityStyle()</code>, ein. 
Die Funktion <code>densityStyle()</code> gibt, wie der Name schon sagt, 
die Farbe für die <em>relative Angabe</em> zurück. 
Damit wir die Choroplethenkarten Ebenen der beiden vorhergehenden Beispiele 
vergleichen können, 
habe ich eine Schaltfläche in das HTML Dokument integriert. 
Je nachdem welche Schaltfläche angeklickt wird, wird die passende Formel ausgeführt. 
Einmal die, die absoluten Werte anzeigt, ein anderes mal die, 
die die relativen Werte ausgibt.</p>
<p>Nun werden Sie feststellen, dass viele große Bereiche in ländlichen Gegenden, 
nicht mehr dunkel eingefärbt sind. Im ersten Beispiel, 
in dem wir mit den absoluten Zahlen gearbeitet haben, 
waren diese Bereiche teilweise dunkel. 
Die Bevölkerungszahl ist aber in Relation zur Fläche dort gar nicht hoch.</p>
<p><img src="../Images/948.png" alt="Choroplethenkarten - Dichte der Bevölkerung in Rheinland-Pfalz." /></p>
<p><em>Abbildung: Choroplethenkarten - Dichte der Bevölkerung in Rheinland-Pfalz.</em></p>
<h2 id="diesem-kapitel-haben-wir">In diesem Kapitel haben wir …</h2>
<p>In diesem Kapitel haben Sie alles das, 
was Sie in den ersten Teilen kennengelernt haben, zum visualisieren eingesetzt. 
Sie haben Plugins kennen gelernt, die Sie beim Erstellen von Heatmaps unterstützen. 
Sie können nun eine Heatmap erstellen, mit der interagiert werden kann. 
Außerdem können Sie eine animierte Heatmap erstellen. 
Sie kennen die Besonderheiten von Choroplethenkarten und wissen, 
wann absolute und wann relative Werte sinnvoll sind. 
Sie können nun die Anzeige von absoluten und relativen Werten selbst umsetzten.</p>
<p>Im nächsten Kapitel werden wir noch einmal den Schwerpunkt auf 
die individuelle Gestaltung setzten. 
Hier geht es um benutzerdefinierte Marker.</p><h1 id="custom-markers">Custom Markers</h1>
<p><a href="#" id="CustomMarkers"></a></p>
<p>Sie wissen nun wie Sie die unterschiedlichsten Geodaten auf Ihrer Karte anzeigen 
können und auch wie Sie mit den Geodaten ein Thema visualisieren können.</p>
<h2 id="diesem-kapitel-werden-wir">In diesem Kapitel werden wir …</h2>
<p>In diesem Kapitel werden wir über die reine Anzeige hinaus 
noch einen Schritt weiter gehen. 
Nun geht es darum, der Karte eine individuelle Note zu geben. 
Wir sehen uns an, wie Sie Marker beliebig gestalten können. 
Außerdem sehen wir uns Plugins an, die Sie bei dieser Arbeit unterstützen.</p>
<h2 id="ein-individueller-marker-auf-ihrer-karte">Ein individueller Marker auf Ihrer Karte</h2>
<p><a href="#" id="inEinindividuellerMarkeraufIhrerKarte"></a></p>
<p>Wenn Leaflet einen Marker auf einer Karte anzeigt, werden gleich zwei 
Bilddateien angezeigt. 
Zunächst wird das eigentliche Bild an die passende Stelle auf die Karte gelegt. 
Danach wird ein Schatten zu diesem Bild hinzugefügt. 
Mit einem passenden Schatten fallen die Marker eher ins Auge. 
Der Schatten verleiht einem Marker eine Tiefe. 
So hebt dieser sich besser von der Karte ab.</p>
<p>Wenn Sie die Dateien zu Leaflet, wie im Kapitel 
<a href="#EineKarteMitLeafletErstellenEinelokaleLeafletKopieeinbinden">Eine lokale Leaflet-Kopie einbinden</a> 
beschrieben, 
auf Ihren Rechner kopiert haben, 
sehen Sie unter den kopierten Daten einen Unterordner mit dem Namen <code>images</code>. 
In den Beispieldateien zu diesem Buch befindet sich ebenfalls eine Leaflet Kopie 
in der der Ordner <code>images</code> enthalten ist.
Dieser Ordner <code>images</code> enthält die Imagedateien die angezeigt werden, 
wenn kein individuelles Image angegeben ist. 
Ich habe die Bilder hier nachfolgend abgedruckt. 
Wenn Sie dieses Buch bisher durchgearbeitet haben, 
kommen Ihnen die Bilder sicher teilweise bekannt vor.</p>
<p><img src="../Images/978.png" alt="(Bilder, die standardmäßig in Leaflet verwendet werden.)" /></p>
<p><em>Abbildung: Bilder, die standardmäßig in Leaflet verwendet werden.</em></p>
<p>Oft ist es so, dass das Bekannte vertraut ist und man sich deshalb damit 
sicher und wohl fühlt. Manchmal möchte man aber aus der Reihen tanzen. 
Wenn Sie auf Ihrer Karte außergewöhnliche Stellen mit einem Marker markieren möchten, 
dann sollten diese Marker vielleicht aus der Reihe tanzen. 
Wenn Sie an einer besonderen Stelle keine blaue Einheitsgrafik anzeigen möchten, 
dann zeigen Sie doch Ihre eigene Grafik an!  </p>
<p>Haben Sie schon eine schöne Grafik für Ihren Marker und den passenden Schatten dazu? 
Wie Sie ein eigenes Image mit einem Grafikprogramm erstellen, 
gehört nicht zum Thema dieses Buches. 
Hier möchte ich Ihnen nur ein paar Punkte aufzählen, 
die Sie beim Erstellen des Images für einen Leaflet Marker beachten sollten.  </p>
<p>Falls Sie keine Grafiken besitzen und auch nicht selbst Hand anlegen möchten, 
dann können Sie entweder die Übungen mit den Beispielbildern des<br />
<a href="http://leafletjs.com/examples/custom-icons/">Leaflet Tutorials</a> durcharbeiten – 
oder Sie blättern direkt weiter zum nächsten Kapitel. 
Das Kapitel <a href="#inEinMarkerPlugin">Ein Marker Plugin</a> bietet Ihnen einen Kompromiss. 
Sie benötigen keine eigenen Grafiken, können einem Marker aber trotzdem ein 
anderes Aussehen verleihen.</p>
<blockquote>
<p>Sie möchten gerne selbst die Grafiken erstellen, wissen aber noch nicht genau 
wie und womit? Dann sehen Sie
sich doch das Programm <a href="https://www.gimp.org">GIMP</a> an. GIMP
(GNU Image Manipulation Program) ist eine gute kostenlose Alternative
zum Bildbearbeitungsprogramm 
<a href="http://www.adobe.com/de/products/photoshop.html">Photoshop von Adobe</a> und 
kommt mit zahlreichen professionellen 
Bearbeitungsfunktionen.  </p>
</blockquote>
<p>Wenn Sie zwei Bilder haben – also ein Bild, das Ihren Marker selbst darstellt 
und eines, das den Schatten zeigt – dann können wir diese beiden Bilder als 
Marker in Ihre Karte einbinden. Ich habe hier zum Ausprobieren die Bilddateien 
aus dem Leaflet Tutorial 
<a href="http://leafletjs.com/examples/custom-icons/">Markers with Custom Icons</a> verwenden.</p>
<p><img src="../Images/945.png" alt="(Bilddateien aus dem Leaflet Tutorial [Markers with Custom Icons](http://leafletjs.com/examples/custom-icons/).)" /></p>
<p><em>Abbildung: Bilddateien aus dem Leaflet Tutorial <a href="http://leafletjs.com/examples/custom-icons/">Markers with Custom Icons</a>.</em></p>
<p>Im nachfolgenden Beispiel habe ich den Text, 
der für die Anzeige des benutzerdefinierten Markers verantwortlich ist, 
mit einem Stern markiert.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.27264, 7.26469], 10);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var greenIcon = L.icon({
*iconUrl: 'http://leafletjs.com/examples/custom-icons/leaf-green.png',
*shadowUrl: 'http://leafletjs.com/examples/custom-icons/leaf-shadow.png',
*iconSize:     [38, 95],
*shadowSize:   [50, 64],
*iconAnchor:   [22, 94],
*shadowAnchor: [4, 62],
*popupAnchor:  [-3, -76]
*});
*L.marker([50.27264, 7.26469], {icon: greenIcon}).
*addTo(mymap).bindPopup("Ich bin ein Marker mit einem individuellen Image.");
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_955.html--&gt;</code></pre>
<p>Sehen wir uns diese Zeilen genau an: 
Zunächst einmal sticht die Instanziierung des Bildes hervor.</p>
<pre><code>var greenIcon = L.icon({
iconUrl: 'http://leafletjs.com/examples/custom-icons/leaf-green.png',
shadowUrl: 'http://leafletjs.com/examples/custom-icons/leaf-shadow.png',
iconSize:     [38, 95],
shadowSize:   [50, 64],
iconAnchor:   [22, 94],
shadowAnchor: [4, 62],
popupAnchor:  [-3, -76]
});</code></pre>
<p>Die Bedeutung der einzelnen Optionen habe ich in der nachfolgenden Abbildung 
veranschaulicht. Aber zunächst einmal sehen wir uns das Problem genauer an:  </p>
<p>Die Schwierigkeit beim Positionieren des Bildes liegt darin, 
die Position des Icons mit der Stelle auf der Erde, die markiert werden soll, 
zu verbinden. Das Bild ist in der Regel größer als der zu markierende Punkt. 
Außerdem enthält das Bild oft eine Art Pfeil, 
dessen Spitze auf den zu markierenden Punkt zeigen sollte. 
Zudem gibt es meist noch ein Pop-up Fenster, 
das relativ zum Bild geöffnet werden sollte. 
Wie also nutzen Sie die Optionen, um das Bild an der passende Stelle 
auf der Karte anzuzeigen? Dies erkläre ich Ihnen nachfolgend.  </p>
<p>Sie können mit der optionalen Option <code>iconSize: [38, 95]</code> die Größe des Bildes 
mitgeben. Mit der optionalen Option <code>shadowSize: [50, 64]</code> können Sie die Größe 
des Schattens beeinflussen. Wenn Sie die Werte für diese Option nicht setzten, 
wird die Originalgröße des Images verwendet.<br />
Die Option <code>iconAnchor: [22, 94]</code> gibt Ihnen nun die Möglichkeit, 
die Stelle, an der das Bild in die Karte eingefügt werden soll, 
zu definieren. 
Ohne ein Setzen dieser Option, würde die linke obere Ecke des Bildes an der Stelle, 
die markiert werden soll, beginnen. 
In der Regel ist es aber so, dass man das Bild mittig oder vielleicht sogar 
über dieser Stelle einfügen möchte. <code>iconAnchor: [22, 94]</code> fügt das Bild 
22 Pixel weiter links und 94 Pixel oberhalb der zu markierenden Stelle ein.<br />
Wenn Sie sich die nachfolgende Abbildung ansehen, wird dies klar. 
Der rote Punkt stellt in der Abbildung die zu markierende Stelle dar. 
Für die Option <code>shadowAnchor: [4, 62]</code> gilt das gleiche wie für 
<code>iconAnchor</code>. Das Schattenbild wird 4 Pixel links und 76 Pixel oberhalb 
des roten Punktes, also der zu markierenden Stelle, eingefügt. 
Die Belegung der Wert in der Option <code>popupAnchor: [-3, -76]</code> ist meiner Meinung 
nach etwas verwirrend, weil im Gegensatz zu den anderen Optionen 
für die gleiche Wirkung ein Minuszeichen vorangestellt werden muss. 
Wenn Sie das Pop-up Fenster links obenhalb der zu markierenden Position öffnen möchten, 
müssen Sie bei der Option <code>popupAnchor</code> also ein Minuszeichen voran stellen!  </p>
<p><img src="../Images/928.png" alt="(Das Bild zu einem Marker auf einer Leaflet Karte positionieren.)" /></p>
<p><em>Abbildung: Das Bild zu einem Marker auf einer Leaflet Karte richtig positionieren.</em></p>
<p>Im Kapitel <a href="#DieKarteMitDatenBestuecken">Die Karte mit Daten bestücken</a>  –  genau 
im Unterkapitel <a href="#DieKarteMitDatenBestueckenPunkteundMarker">Punkte und Marker</a><br />
–  haben wir schon Marker mit Optionen angelegt. 
Im nächsten Codeschnipsel sehen Sie nun, dass Sie auch das Bild zum Marker – 
also das Icon – als Option angeben können. 
Im Programmcode geben Sie dazu einfach den Namen des eben erstellen 
<code>L.Icon</code> Objektes an.</p>
<pre><code>L.marker(
[50.27264, 7.26469], 
{icon: greenIcon})
.addTo(mymap)
.bindPopup("Ich bin ein Marker mit einem individuellen Image.");</code></pre>
<p>Wenn Sie das HTML Dokument dieses Beispiels im Browser öffnen, 
sehen Sie eine Karte auf der das grüne Icon als Marker an der festgelegten Koordinate 
– passend positioniert – erscheint.</p>
<p><img src="../Images/977.png" alt="(Eine Karte mit einem benutzerdefinierten Icon als Marker.)" /></p>
<p><em>Abbildung: Eine Karte mit einem benutzerdefinierten Icon als Marker.</em></p>
<h3 id="eigenschaften-eines-individuellen-marker">Eigenschaften eines individuellen Marker</h3>
<p>Ein eigenes Marker Bild erstellen Sie in Leaflet mithilfe der 
Kasse <a href="http://leafletjs.com/reference-1.1.0.html#icon">L.icon</a>. 
Das haben Sie eben praktisch gesehen. Diese Klasse bietet Ihnen eine Menge Optionen.</p>
<ul>
<li><code>iconUrl:</code><br />
Die <code>iconUrl</code>  müssen Sie auf alle Fälle angeben. 
Diese Option muss die Adresse zur Bilddatei enthalten – absolut oder relativ zu 
dem Verzeichnis, in dem Ihr Skript gespeichert ist. </li>
<li><code>iconRetinaUrl:</code><br />
Die <code>iconRetinaUrl</code> bietet Ihnen optional die Möglichkeit, 
die Adresse einer für Retina Bildschirme optimierten Version des Bildes – 
absolut oder relativ zu dem Verzeichnis, in dem Ihr Skript gespeichert ist – 
anzugeben. Wie Leaflet dieses Bild genau optimiert, 
erkläre ich Ihnen im Anschluss an die Auflistung dieser Optionen.</li>
<li><code>iconSize:</code><br />
Die optionale <code>iconSize</code> beeinflusst die Größe, mit der das Bild angezeigt wird. </li>
<li><code>IconAnchor:</code><br />
Die Option <code>IconAnchor</code> beschreibt die Pixelkoordinate, an der das Bild eingefügt 
werden soll. Die Koordinate gibt die Pixelwerte relativ zu der Stelle an, 
die markiert werden soll. 
<strong>Achtung</strong>, verwechseln Sie die Pixelkoordinat nicht mit der geografischen Koordinate. </li>
<li><code>PopupAnchor:</code><br />
Die Option <code>PopupAnchor</code> beschreibt den Punkte, an dem ein Pop-up Fenster geöffent 
werden soll. Die Koordinate gibt die Pixelwerte relativ zu der Stelle an, 
die markiert werden soll. 
Wenn Sie das Pop-up Fenster links obenhalb der zu markierenden Position öffnen möchten, 
müssen Sie bei den Werten der Option <code>popupAnchor</code> ein Minuszeichen voran stellen! 
Sind die Werte positiv, öffnet sich das Pop-up rechts unterhalb zu markierenden Position. </li>
<li><code>ShadowUrl:</code><br />
Die Option <code>ShadowUrl</code> enthält die Adresse zur Imagedatei, die den Schatten 
darstellen soll. Wenn nichts angegeben ist, wird kein Schattenbild erstellt. </li>
<li><code>ShadowRetinaUrl:</code><br />
Mit der Option <code>ShadowRetinaUrl</code> können Sie ein Bild angeben, dass speziell 
für Retina Displays optimiert ist. Wie Leaflet dieses Bild genau optimiert, 
erkläre ich Ihnen im Anschluss an die Auflistung dieser Optionen. </li>
<li><code>shadowSize:</code><br />
<code>shadowSize</code> beschreibt die Höhe und Breite des Bildes, dass den Schatten 
darstellen soll, in Pixeln. </li>
<li><code>shadowAnchor:</code><br />
Die Pixel Koordinaten an der das Schattenbild eingefügt werden soll, 
können Sie mit der Option <code>ShadowAnchor</code> übergeben. 
Ansonsten gilt für diese Option das gleiche, was ich bei der Option <code>iconAnchor</code> 
geschrieben habe. </li>
<li><code>className:</code><br />
Mit der Option <code>className</code> können Sie für beide Bilder - also dem Schattenbild und 
dem eigentlichen Marker Bild - 
den Namen einer CSS-Klasse definieren. </li>
</ul>
<p><a href="#" id="RetinaDisplay"></a></p>
<blockquote>
<p>Besonderheiten beim <a href="https://de.wikipedia.org/w/index.php?title=Retina-Display&amp;oldid=183031043">Retina Display</a><br />
Hochauflösende Displays haben eine höhere Pixeldichte als gewöhnliche Monitore.
Auf der gleichen Fläche werden etwa viermal so viele Pixel
dargestellt. Der Vorteil dieser Technologie liegt darin, dass die
Pixel nun so klein sind, dass das menschliche Auge sie nicht mehr
auflösen kann. Das Ergebnis sind sehr scharfe Grafiken und Texte.
Damit das Bild nun auf einem HiDPI (High Dots Per Inch) Bildschirm,
also einem Retina Display, scharf dargestellt wird, muss es mit
mindestens zweifacher Breite und Höhe zur Verfügung gestellt werden. 
Denn: Eine Pixelgrafik, die bei gewöhnlicher Auflösung das ganze Display
ausfüllt, würde auf einem Retina Display der gleichen
Größe nur ein Viertel des Displays einnehmen. Ein Pixel der Grafik
entspricht auch auf dem Retina-Display einem Pixel. 
Es werden aber auf der gleichen Fläche viermal so viele Pixel, nun allerdings nur mit 
einem Viertel der Größe, abgebildet. Damit
die Pixelgrafiken nicht plötzlich alle zu klein dargestellt werden,
rechnen die Geräte die Grafiken um. Dadurch geht Qualität verloren. 
Pixelgrafiken wirken auf dem
Retina-Display daher teilweise unscharf. Um dieses Problem zu umgehen,
prüft Leaflet die Auflösung des Anzeigegerätes. Anschließend
werden die Marker Bilder – sofern eine Grafik mit hohere Auflösung vorhanden ist – 
in hoher Auflösung
angezeigt.</p>
</blockquote>
<h3 id="die-klasse-licon-erweitern">Die Klasse L.Icon erweitern</h3>
<p>So, nun haben Sie einen benutzerdefinierten Marker erstellt und möchten weitere 
Marker kreiere. Schön, dass Leaflet objektorientiertes Arbeiten unterstützt. 
So können Sie sich das Erstellen von neuen Marker Objekten sehr einfach machen. 
Erweitern Sie einfach die Klasse <code>L.Icon</code> und geben alle gemeinsamen Eigenschaften 
hier einmal an. 
Ausschließlich die besonderen Eigenschaften des Markers müssen Sie separat 
für jeden Marker angeben. 
Das nachfolgende Codebeispiel zeigt Ihnen, wie Sie drei unterschiedliche Marker, 
die ein paar gemeinsame Eigenschaften haben, 
mithilfe von einer Eltern-Klasse erstellen können. 
So können die drei Marker von dem Elternteil die gemeinsamen Eigenschaften erben.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.27264, 7.26469], 8);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var LeafIcon = L.Icon.extend({
*options: {
*shadowUrl: 'leaf-shadow.png',
*iconSize:     [38, 95],
*shadowSize:   [50, 64],
*iconAnchor:   [22, 94],
*shadowAnchor: [4, 62],
*popupAnchor:  [-3, -76]
*}
*});
*var greenIcon = new LeafIcon(
*{iconUrl: 'http://leafletjs.com/examples/custom-icons/leaf-green.png'}
*);
*var redIcon = new LeafIcon(
*{iconUrl: 'http://leafletjs.com/examples/custom-icons/leaf-red.png'}
*);
*var orangeIcon = new LeafIcon(
*{iconUrl: 'http://leafletjs.com/examples/custom-icons/leaf-orange.png'}
*);
*L.marker(
*[50.27264, 7.26469], {icon: greenIcon})
*.addTo(mymap).bindPopup("Ich bin ein grüner Marker.");
*L.marker(
*[50.27264, 6.26469], {icon: redIcon})
*.addTo(mymap).bindPopup("Ich bin ein roter Marker.");
*L.marker(
*[50.27264, 8.26469], {icon: orangeIcon})
*.addTo(mymap).bindPopup("Ich bin ein oranger Marker.");
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_954.html--&gt;</code></pre>
<p>Dieser Programmcodeabschnitt hat Ähnlichkeit mit dem vorherigen Beispiel. 
Wenn Sie genau hinsehen, finden Sie aber Unterschiede. 
Wir erstellen im ersten Schritt kein neues <code>Icon</code> Objekt um dieses Anzuzeigen, 
sondern erweitern die Klasse  <code>L:Icon</code> mit der Klasse  <code>LeafIcon</code>. 
Wir legen nur die gemeinsamen Optionen für das Objekt <code>LeafIcon</code> fest. 
Die URL des Bildes ist die Option, die von Marker zu Marker unterschiedlich ist. 
Deshalb geben wir diese beim Erweitern der Klasse in den Optionen noch nicht an.</p>
<pre><code>var LeafIcon = L.Icon.extend({  
options: {  
shadowUrl: 'leaf-shadow.png',  
iconSize: [38, 95],  
shadowSize: [50, 64],  
iconAnchor: [22, 94],  
shadowAnchor: [4, 62],  
popupAnchor: [-3, -76]  
}  
});</code></pre>
<p>Im zweiten Schritt erstellen wir drei Instanzen des <code>LeafIcon</code>, 
also des erweiterten <code>L.Icon</code>.</p>
<pre><code>var greenIcon = new LeafIcon(
{iconUrl: 'http://leafletjs.com/examples/custom-icons/leaf-green.png'}
);
var redIcon = new LeafIcon(
{iconUrl: 'http://leafletjs.com/examples/custom-icons/leaf-red.png'}
);
var orangeIcon = new LeafIcon(
{iconUrl: 'http://leafletjs.com/examples/custom-icons/leaf-orange.png'}
);</code></pre>
<p>Und zu guter Letzt fügen wir die Marker mit dem zugehörigen Icon 
an die passende Stelle auf der Karte zum Kartenobjekt hinzu.</p>
<pre><code>L.marker(
[50.27264, 7.26469], {icon: greenIcon})
.addTo(mymap).bindPopup("Ich bin ein grüner Marker.");
L.marker(
[50.27264, 6.26469], {icon: redIcon})
.addTo(mymap).bindPopup("Ich bin ein roter Marker.");
L.marker(
[50.27264, 8.26469], {icon: orangeIcon})
.addTo(mymap).bindPopup("Ich bin ein oranger Marker.");</code></pre>
<p><a href="#" id="Fabrikmethode2"></a></p>
<blockquote>
<p>Sie haben vielleicht bemerkt, dass wir das Schlüsselwort <code>new</code> für die Erstellung 
von <code>LeafIcon</code> Instanzen verwendet haben. Warum haben wir vorher alle Leafelt Objekte 
ohne das Schlüsselwort <code>new</code> erstellt? Die Antwort ist einfach: 
Die echten Leaflet Klassen sind
mit einem Großbuchstaben – beispielsweise  <code>**L**.Icon</code>  – benannt und diese
müssen mit  <code>new</code>  erstellt
werden. Es gibt aber Shortcuts mit Kleinbuchstaben – <code>L.icon</code> – 
die aus Bequemlichkeitsgründen von den Leaflet-Programmierern
für Sie erstellt wurden:
<code>**L.icon** = function icon(options) {</code><br />
<code>return new L.Icon(options);</code><br />
<code>};</code><br />
Die Funktion <code>L.icon</code> können Sie sich auf Github in der 
Datei <a href="https://github.com/Leaflet/Leaflet/blob/7ed780cd35474f2acf0f17e7394807ff0973a031/src/layer/marker/Icon.js#L153">icon.js</a> 
ansehen.<br />
Leaflet setzt hier das Entwurfsmuster 
<a href="https://de.wikipedia.org/w/index.php?title=Fabrikmethode&amp;oldid=183961607">Fabrikmethode</a> 
ein. Das Muster beschreibt, wie ein Objekt
durch Aufruf einer Methode, anstatt durch direkten Aufruf eines
Konstruktors, erzeugt wird. Dies hatte ich im Kapitel 
<a href="#Fabrikmethode1">Wir beginnen mit einer einfachen Karte</a> 
schon einmal erwähnt.</p>
</blockquote>
<p>Im nachfolgenden Bild sehen Sie das Ergebnis. 
Jeder Marker wird nun mit einem individuellen Icon erstellt. 
Die meisten Optionen sind gleich – allerdings hat jeder Marker seine eigene Farbe.</p>
<p><img src="../Images/976.png" alt="(Drei Marker mit unterschiedlichen Icons, die mithilfe einer Elternklasse erstellt wurden.)" /></p>
<p><em>Abbildung: Drei Marker mit unterschiedlichen Icons, die mithilfe einer Elternklasse erstellt wurden.</em></p>
<h2 id="ein-marker-plugin">Ein Marker Plugin</h2>
<p><a href="#" id="inEinMarkerPlugin"></a></p>
<p>Sie wissen nun, wie Sie einen Marker mit einem standardisierten Aussehen einfügen 
und können einen Marker mit einem eigenen Image belegen. 
Leider haben Sie aber kein eigenes Image und haben auch nicht viel Erfahrung 
mit einem Grafikprogramm. 
Sie können kein professionell aussehendes individuelles Image hervorzaubern 
oder haben einfach nicht die Zeit dazu. 
Trotzdem möchten Sie Ihrer Karte ein besonderes Aussehen verleihen. 
In diesem Fall bietet Ihnen dieses Kapitel eine Lösung. 
Ich stelle Ihnen zwei Plugins vor, die Sie bei der Erstellung von individuellen Marker 
Objekten unterstützen.</p>
<h3 id="beautifymarker">BeautifyMarker</h3>
<p><a href="https://github.com/marslan390/BeautifyMarker">Leaflet.BeautifyMarker</a>, 
ist ein einfaches Plugin, das bunte Marker ganz ohne eigene Grafik zu 
einer Leaflet-Karte hinzufügt. 
Trotzdem behalten Sie die volle Kontrolle über den Stil der Marker. 
Konkret heißt das: Sie können über unbegrenzte Farben und viele Eigenschaften verfügen. 
Das Plugin Leaflet.BeautifyIcon bietet auch die Möglichkeit, Schriftart und Glyphen, 
also die grafische Darstellung von Schriftzeichen, anzupassen.</p>
<p><img src="../Images/974.png" alt="Marker, die mithilfe des Plugins [Leaflet.BeautifyMarker](https://github.com/marslan390/BeautifyMarker) erstellt wurden." /></p>
<p><em>Abbildung: Marker, die mithilfe des Plugins <a href="https://github.com/marslan390/BeautifyMarker">Leaflet.BeautifyMarker</a> erstellt wurden.</em></p>
<p>Damit Sie sich dieses besser vorstellen können, habe ich ein Beispiel erstellt.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;link rel="stylesheet" 
*href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css"&gt;
*&lt;link rel="stylesheet" 
*href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css"&gt;
*&lt;link rel="stylesheet" href="leaflet-beautify-marker-icon.css"&gt;
*&lt;script src="leaflet-beautify-marker-icon.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.27264, 7.26469], 8);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*L.marker([50.27264, 7.26469], {
*icon: L.BeautifyIcon.icon(
*{iconSize: [50, 50]}
*),
*draggable: true
*}).addTo(mymap).bindPopup("Ich bin ein beautify Marker");
*options = {
*icon: 'spinner',
*spin: 'true',
*borderColor: '#8A90B4',
*textColor: 'white',
*backgroundColor: '#8A90B4'
*};
*L.marker([50.27264, 6.26469], {
*icon: L.BeautifyIcon.icon(options),
*draggable: true
*}).addTo(mymap).bindPopup("Ich bin ein beautify Marker");
*options = {
*icon: 'plane',
*iconShape: 'marker',
*borderColor: '#8D208B',
*textColor: '#8D208B',
*backgroundColor: 'transparent'
*};
*L.marker([50.27264, 8.26469], {
*icon: L.BeautifyIcon.icon(options),
*draggable: true
*}).addTo(mymap).bindPopup("Ich bin ein beautify Marker");
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_953.html--&gt;</code></pre>
<p>Was müssen Sie tun, wenn Sie das Plugin 
<a href="https://github.com/marslan390/BeautifyMarker">Leaflet.BeautifyMarker</a> 
verwenden möchten? 
Zunächst einmal müssen Sie die notwendigen Skripte und Stylesheet Dateien einbinden. 
Das ist zum einen das Skript und die CSS-Datei zum Plugin selbst. 
Diese Dateien können Sie über die Website <a href="https://github.com/marslan390/BeautifyMarker">https://github.com/marslan390/BeautifyMarker</a> herunterladen. 
Zum anderen können Sie zusammen mit <a href="https://github.com/marslan390/BeautifyMarker">Leaflet.BeautifyMarker</a> 
Drittdienste nutzen. 
Sie können 
<a href="https://fontawesome.com/v4.7.0/">Font Awesome CSS</a> und 
<a href="https://getbootstrap.com/docs/3.4/">Bootstrap CSS</a> 
einbinden. 
Ich habe im Beispiel die CSS-Dateien von Font Awesome und von Boostrap eingebunden, 
um Ihnen dies zu demonstrieren. 
Für dieses Beispiel wäre nur die CSS-Datei von Font Awesome CSS notwendig gewesen.</p>
<p>Weiter müssen Sie nicht tun. Sie können sofort einen Marker mithilfe der Option 
<code>icon: L.BeautifyIcon.icon(options)</code> kreieren.</p>
<pre><code>L.marker([50.27264, 8.26469], {
icon: L.BeautifyIcon.icon(options),
draggable: true
}).addTo(mymap).bindPopup("Ich bin ein beautify Marker");</code></pre>
<p>Sehen Sie sich die Optionen des Plugin <code>Leaflet.BeautifyMarker</code> an. 
Es macht Spaß diese zu erkunden. 
Wie die Optionen wirken, die ich verwendet haben, können Sie sich im nächsten Bild 
teilweise ansehen. Das sich eines der Icons dreht, erkennen Sie allerdings nur, 
wenn Sie die HTML Datei mit der Karte selbst im Browser öffnen.</p>
<p><img src="../Images/975.png" alt="(Eine Leaflet Karte mit `Leaflet.BeautifyMarker`-Markern.)" /></p>
<p><em>Abbildung: Eine Leaflet Karte mit drei verschiedenen <code>Leaflet.BeautifyMarker</code>-Markern.</em></p>
<blockquote>
<p>Ich hatte Ihnen ja schon geschrieben,
dass es jede Menge Plugins für Leaflet gibt und dies gilt für den
Bereich Marker besonders. Die meisten sind auf der Website von
Leaflet aufgelistet. Diese Liste finden Sie unter der Adresse 
<a href="https://leafletjs.com/plugins.html#markers--renderers">https://leafletjs.com/plugins.html#markers--renderers</a>.</p>
</blockquote>
<h2 id="cluster">Cluster</h2>
<p><a href="#" id="inCluster"></a></p>
<p>Je nachdem welche Informationen Sie mit Ihrer Karte weitergeben möchten, 
kann es vorkommen, dass Sie sehr viele Marker benötigen. 
Wenn Sie mit vielen Marker Objekten arbeiten, sollten Sie beachten, 
dass diese das Laden der Karte verlangsamen. 
Außerdem kann es vorkommen, dass Marker nahe nebeneinander liegen und sich 
beim Zoomen überschneiden. 
Dies ist nicht benutzerfreundlich. 
Schön wäre es, wenn bei einer Detailansicht alle Marker zu sehen sind – 
diese aber beim Hineinzoomen in die Karte zu Clustern zusammengefasst werden. 
So hat der Benutzer alle Informationen passend zur Kartenanzeige.</p>
<p>In diesem Kapitel erfahren Sie, wie Sie 
das Plugin <a href="https://github.com/Leaflet/Leaflet.markercluster">Leaflet.markercluster</a> 
zum Clustern von Marker Objekten verwenden und so eine große Anzahl von Marker 
Objekten auf einer Karte benutzerfreundlich und übersichtlich darstellen können. 
Sehen Sie sich das nachfolgende Beispiel an, um zu verstehen, wie das Clustern von 
Marker Objekten funktioniert.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;link rel="stylesheet" href="MarkerCluster.css"/&gt;
*&lt;link rel="stylesheet" href="MarkerCluster.Default.css"/&gt;
*&lt;script src="leaflet.markercluster-src.js"&gt;&lt;/script&gt;
*&lt;script src="points.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.219264, 7.19469], 13);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var markers = L.markerClusterGroup(
*);
*for (var i = 0; i &lt; points.length; i++) {
*var a = points[i];
*var title = a[2];
*var marker = L.marker(new L.LatLng(a[0], a[1]), { title: title });
*marker.bindPopup(title);
*markers.addLayer(marker);
*}
*mymap.addLayer(markers);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_952.html--&gt;</code></pre>
<p>Das haben wir gemacht: Als erstes haben wir die notwendigen Dateien zum Plugin 
<a href="https://github.com/Leaflet/Leaflet.markercluster">Leaflet.markercluster</a> 
eingebunden. Damit wir auch genug Marker zum Clustern zur Verfügung haben, 
haben wir dann Punkte über eine externe Datei eingebunden. 
Die Datei <code>points.js</code> enthält 380 Punkte und sieht auszugsweise wie folgt aus:  </p>
<pre><code>var points = [ 
[50.2210922667, 7.2209316333, "2"],  
[50.2210819833, 7.2213903167, "3"],
...
];  </code></pre>
<p>Zu guter Letzt haben wir mit </p>
<pre><code>var markers = L.markerClusterGroup(
);</code></pre>
<p>ein Objekt vom Typ <code>markerClusterGroup</code> erzeugen und diesem Objekt jeden einzelnen 
Marker hinzufügen. 
Das Objekt <code>markerClusterGroup</code> übernimmt nun die ganze Arbeit für uns.</p>
<p>So wie in der nachfolgenden Abbildung zu sehen ist, könnte Ihre Karte aussehen.</p>
<p><img src="../Images/952.png" alt="Viele Marker auf einer Leaflet Karte, die in Cluster gruppiert sind." /></p>
<p><em>Abbildung: Viele Marker auf einer Leaflet Karte, die in Cluster gruppiert sind..</em></p>
<h3 id="optionen-methoden-und-ereignisse">Optionen, Methoden und Ereignisse</h3>
<p>Sie können einem Cluster jede Menge Optionen mitgeben und sehr viele 
Methoden und Ereignisse nutzen. 
Zum Beispiel können sie die standardmäßig aktivierte Option <code>showCoverageOnHover</code> mit</p>
<p><code>var markers = L.markerClusterGroup(</code><br />
<code>{</code><strong><code>showCoverageOnHover : false</code></strong><code>}</code><br />
<code>);</code>  </p>
<p>ausschalten. Aktiviert bewirkt diese Option das Folgende: 
Wenn Sie die Maus über einen Cluster bewegen, blendet sich ein Polygon ein, 
dass die Grenzen des Bereichs in dem die Marker sich befinden, anzeigt.
Alle Optionen, Methoden und Ereignisse finden Sie in der Dokumentation zum Plugin 
auf Github: <a href="https://github.com/Leaflet/Leaflet.markercluster">https://github.com/Leaflet/Leaflet.markercluster</a>.</p>
<h2 id="marker-animieren">Marker animieren</h2>
<p><a href="#" id="inMarkeranimieren"></a></p>
<h3 id="hupfende-marker">Hüpfende Marker</h3>
<p>Wenn Sie einen Marker animieren möchten, unterstützt Sie beispielsweise das 
Plugin <a href="https://github.com/maximeh/leaflet.bouncemarker">leaflet.bouncemarker</a>. 
Wie Sie den hüpfenden Marker in Ihre Karte einbinden, zeige ich Ihnen wieder 
anhand eines Beispiels.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="bouncemarker.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.27264, 7.26469], 12);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*L.marker([50.27264, 7.26469],
*{
*bounceOnAdd: true,
*bounceOnAddOptions: {duration: 5000, height: 100},
*bounceOnAddCallback: function() {alert("Gelandet!");}
*}
*).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_951.html--&gt;</code></pre>
<p>Als Ergebnis sehen Sie einen Marker, der sofort nachdem die Karte im Browser geladen ist, 
in die Karte spring und dann noch eine Weile auf und ab hüpft. 
Nach dem der Marker gelandet ist, öffnet sich ein Pop-up-Fenster mit der Meldung: 
Gelandet!.</p>
<h3 id="animierte-marker">Animierte Marker</h3>
<h4 id="ein-marker-bewegt-sich">Ein Marker bewegt sich</h4>
<p>Es gibt sehr viele spannende Ideen, die man mit einer Karte umsetzen kann. 
Möchten Sie vielleicht mit Ihrem Marker einen Weg beschreiben? 
Dann ist das Plugin 
<a href="https://github.com/openplans/Leaflet.AnimatedMarker">Leaflet.AnimatedMarker</a> 
vielleicht etwas für Sie. 
Mit diesem Plugin können Sie einen Marker so animieren, 
dass er einer Linie folgt. 
Vielleicht möchten Sie einen Marker in Form eines Autos darstellen, 
das auf einer Straße fährt?</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="AnimatedMarker.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.27264, 7.26469], 9);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var line = L.polyline(
*[[50.68510, 7.94136],[50.68576, 6.94149],[51.68649, 6.94165]]),
*animatedMarker = L.animatedMarker(line.getLatLngs(), {
*distance: 2000,
*interval: 1000,
*});
*mymap.addLayer(animatedMarker);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_950.html--&gt;</code></pre>
<h4 id="einen-marker-bewegung-versetzen-und-wieder-stoppen">Einen Marker in Bewegung versetzen und wieder stoppen</h4>
<p>Wenn Sie die Bewegung des Markers beeinflussen möchten, 
unterstützt Sie das Plugin <a href="https://github.com/openplans/Leaflet.AnimatedMarker">Leaflet.AnimatedMarker</a> auch. 
Bauen Sie zum Testen zwei Schaltenflächen ein, 
über die Sie den Maker anhalten oder starten können.
<a href="https://github.com/openplans/Leaflet.AnimatedMarker">Leaflet.AnimatedMarker</a> 
bietet Ihnen Methoden mit passender Funktionalität. Sie müssen diese Methoden nur 
der passenden Schaltfläche zuordnen. </p>
<p>Das nächste Beispiel will Ihnen eine Idee zur Umsetzung dieser Aufabenstellung geben.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="AnimatedMarker.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
*&lt;button onclick="start()"&gt;Start&lt;/button&gt;
*&lt;button onclick="stop()"&gt;Stop&lt;/button&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.27264, 7.46469], 9);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var line = L.polyline(
*[[50.68510, 7.94136],[50.68510, 7.84136],[50.68510, 7.74136],[50.68510, 7.64136],
*[50.68510, 7.5136],[50.68510, 7.44136],[50.68510, 7.34136],[50.68510, 7.24136]]),
*animatedMarker = L.animatedMarker(line.getLatLngs(), {
*autoStart: false,
*distance: 200,
*interval: 100
*});
*mymap.addLayer(animatedMarker);
*function start(){animatedMarker.start();}
*function stop(){animatedMarker.stop();}
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_949.html--&gt;</code></pre>
<p>Wie Sie sehen, können Sie die Funktionen <code>start()</code> und <code>stop()</code>, 
die Ihnen das Plugin 
<a href="https://github.com/openplans/Leaflet.AnimatedMarker">Leaflet.AnimatedMarker</a> 
zur Verfügung stellt, nutzen.</p>
<h4 id="plugins-kombinieren">Plugins kombinieren</h4>
<p>Und natürlich können Sie Plugins auch kombinieren. 
Ihrer Kreativität sind keine Grenzen gesteckt. 
Schon allein mit den beiden gerade gezeigten 
Plugins 
<a href="https://github.com/openplans/Leaflet.AnimatedMarker">Leaflet.AnimatedMarker</a> 
und 
<a href="https://github.com/maximeh/leaflet.bouncemarker">leaflet.bouncemarker</a> 
können Sie einen Marker auf der Karte Aktionen ausführen lassen und 
ihn am Schluss gekonnt aus dem Bild hüpfen lassen. 
Sehen Sie selbst, probieren Sie das nächste Beispiel aus!</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="AnimatedMarker.js"&gt;&lt;/script&gt;
*&lt;script src="bouncemarker.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
*&lt;button onclick="start()"&gt;Start&lt;/button&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*b = new L.Marker([51.68649, 6.94165], {bounceOnAdd: true});
*var line = L.polyline(
*[[50.68510, 7.94136],[50.68576, 6.94149],[51.68649, 6.94165]]),
*animatedMarker = L.animatedMarker(line.getLatLngs(), {
*autoStart: false,
*distance: 2000,
*interval: 10,
*onEnd: function() {
*b.addTo(mymap);
*b.bounce({duration: 100, height: 50});
*mymap.removeLayer(animatedMarker);
*setTimeout('mymap.removeLayer(b)', 900);
*}
*});
*mymap.addLayer(animatedMarker);
*function start(){animatedMarker.start();}
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_948.html--&gt;</code></pre>
<h2 id="leaflet-data-visualization-framework-dvf">Leaflet Data Visualization Framework (DVF)</h2>
<p><a href="#" id="inLeafletDataVisualizationFramework"></a></p>
<p>Möchten Sie gerne mit Ihrer Karte Daten visualisieren. 
Heatmaps und Choroplethenkarten sind aber nicht das Richtige für Sie? 
Sie können Daten mithilfe von Markern in überzeugende Karten verwandeln. 
Hierbei unterstützt Sie das Plugin
<a href="https://github.com/humangeo/leaflet-dvf">Leaflet Data Visualization Framework (DVF)</a>. 
Leider ist dieses Plugin zu dem Zeitpunkt, 
zu dem ich dieses Kapitel geschrieben haben, 
nicht mit der neuesten Leaflet Version kompatibel. 
Deshalb verwende ich im Beispiel eine ältere Leaflet Version.</p>
<h3 id="das-plugin-data-visualization-framework">Das Plugin Data Visualization Framework</h3>
<p>Das erste Beispiel zeigt Ihnen, wie Sie Formen als Marker darstellen können. 
Hier geht es noch nicht um das Visualisieren von Daten, sondern eher darum, 
die Möglichkeiten diese Plugins zu sehen und ein Gefühl für die Anwendung zu bekommen. </p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
*&lt;link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" /&gt;
*&lt;script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"&gt;&lt;/script&gt;
*&lt;link rel="stylesheet" href="dvf.css" /&gt;
*&lt;script src="leaflet-dvf.js"&gt;&lt;/script&gt;
*&lt;script src="leaflet-dvf.markers.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var marker = new L.MapMarker([50.27264, 7.26469],
*{
*radius: 30,
*fillOpacity:0.5,
*fillColor:'orange',
*color:'purple',
*innerRadius:7,
*numberOfSides:4,
*rotation:10
*});
*mymap.addLayer(marker);
*var polygonmarker = new L.RegularPolygonMarker([50.27264, 6.26469],
*{
*numberOfSides: 3,
*rotation: 10,
*radius: 10,
*fillColor:'green',
*fillOpacity:1,
*opacity:1,
*weight:1,
*radius:30
*});
*mymap.addLayer(polygonmarker);
*var star = new L.StarMarker([50.27264, 8.26469],
*{
*numberOfPoints:8,
*opacity:1,
*weight:2,
*fillOpacity:0,
*radius:30});
*mymap.addLayer(star);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_947.html--&gt;</code></pre>
<p>Die nächste Abbildung zeigt Ihnen die drei im vorherigen Beispiel erstellen Marker.</p>
<p><img src="../Images/972a.png" alt="Drei mithilfe des [Leaflet Data Visualization Framework (DVF)](https://github.com/humangeo/leaflet-dvf) erstellte Marker." /></p>
<p><em>Abbildung: Drei mithilfe des <a href="https://github.com/humangeo/leaflet-dvf">Leaflet Data Visualization Framework (DVF)</a> erstellte Marker.</em></p>
<h3 id="diagramme-als-marker">Diagramme als Marker</h3>
<p>Das außergewöhnlichste an diesem Plugin ist meiner Meinung nach die Einfachheit, 
mit der Diagramme als Marker dargestellt werden können. 
Sehen sich dies im nachfolgenden Beispiel an.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
*&lt;link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" /&gt;
*&lt;script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"&gt;&lt;/script&gt;
*&lt;link rel="stylesheet" href="dvf.css" /&gt;
*&lt;script src="leaflet-dvf.js"&gt;&lt;/script&gt;
*&lt;script src="leaflet-dvf.markers.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {doubleClickZoom:false}).setView([50.27264, 7.26469], 7);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var options = {
*data: {
*'data1': 20,
*'data2': 50,
*'data3': 10,
*'data4': 20
*},
*chartOptions: {
*'data1': {
*fillColor: 'blue',
*minValue: 0,
*maxValue: 50,
*maxHeight: 30,
*displayText: function (value) {
*return 'Mein Text';
*}
*},
*'data2': {
*fillColor: 'red',
*minValue: 0,
*maxValue: 50,
*maxHeight: 30,
*},
*'data3': {
*fillColor: 'green',
*minValue: 0,
*maxValue: 50,
*maxHeight: 30,
*},
*'data4': {
*fillColor: 'yellow',
*minValue: 0,
*maxValue: 50,
*maxHeight: 30,
*}
*},
*weight: 1,
*color: '#000000',
*radius:30,
*fillOpacity:1
*};
*var bar = new L.BarChartMarker([50.27264, 7.26469], options);
*mymap.addLayer(bar);
*var radial = new L.RadialBarChartMarker([50.27264, 8.26469], options);
*mymap.addLayer(radial);
*var pie= new L.PieChartMarker([50.27264, 6.26469], options);
*mymap.addLayer(pie);
*var cox = new L.CoxcombChartMarker([50.97264, 7.26469], options);
*mymap.addLayer(cox);
*var stack = new L.StackedRegularPolygonMarker([50.97264, 8.26469], options);
*mymap.addLayer(stack);
*var radialmeter= new L.RadialMeterMarker([50.97264, 6.26469], options);
*mymap.addLayer(radialmeter);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_946.html--&gt;</code></pre>
<p>Ich habe wenige Daten für dieses Beispiel künstlich erstellt. 
Diese Daten habe ich in einer Variable im Programmcode fix eingetragen. 
Dies ist nicht Sinn der Sache. In der Regel will man dynamische Daten visualisieren. 
Das Prinzip wird so aber meiner Meinung nach klar. 
Das Beispiel zeigt Ihnen, wie Sie Daten in Form eines Diagramms mithilfe des 
Leaflet Data Visualization Framework auf Ihrer Leaflet Karte einblenden können. 
Und das nachfolgende Bild zeigt Ihnen das Ergebnis.</p>
<p><img src="../Images/972.png" alt="Mithilfe des [Leaflet Data Visualization Framework (DVF)](https://github.com/humangeo/leaflet-dvf) erstellte Marker, die Diagramme beinhalten." /></p>
<p><em>Abbildung: Mithilfe des <a href="https://github.com/humangeo/leaflet-dvf">Leaflet Data Visualization Framework (DVF)</a> erstellte Marker, die Diagramme beinhalten.</em></p>
<h2 id="diesem-kapitel-haben-wir">In diesem Kapitel haben wir …</h2>
<p>In diesem Kapitel haben wir der Leaflet Karte eine individuelle Note gegeben. 
Wir haben uns angesehen, wie Sie Marker beliebig gestalten können. 
Dabei haben wir einen Ausflug in die objektorientierte Programmierung gemacht. 
Insbesondere bei der Erstellung von vielen individuellen Marker Objekten kann man sich 
durch eine mögliche Vererbung viel Arbeit und viele Programmcodezeilen sparen. 
Außerdem haben wir uns verschiedene Plugins angesehen – man muss ja nicht immer das Rad 
selbst neu erfinden.  </p>
<p>Sie haben Ihre digitale Karte bereits im Griff. 
Sie können diese gestalten und Daten auf ihr visualisieren. 
Nun kann es sein, dass Sie selbst keine großen Datenbestände zum Anzeigen haben. 
Vielleicht bietet das ESRI Inc. (Environmental Systems Research Institute) Daten, 
die zum Thema Ihrer Website passen? 
Im nächsten Kapitel erfahren Sie, wie Sie Daten und Anwendungen dieses Institutes 
verwenden können.  </p><h1 id="esri-environmental-systems-research-institute">ESRI - Environmental Systems Research Institute</h1>
<p><a href="#" id="EnvironmentalSystemsResearchInstitute"></a></p>
<p>Wenn Sie intensiver mit digitalen Landkarten arbeiten, 
möchten Sie sicherlich auch einmal Daten eines Geoinformationssystems (GIS) auf 
Ihrer Karte anzeigen.</p>
<blockquote>
<p>Ein <a href="https://de.wikipedia.org/w/index.php?title=Geoinformationssystem&amp;oldid=183596912">Geoinformationssystem</a>
ist ein Informationssystem zur Erfassung, Bearbeitung, Organisation,
Analyse und Präsentation von Daten, die einen Bezug zu einer Stelle
auf unserer Erde haben. Zu einem Geoinformationssystem gehören dabei
die notwendige Hardware, die notwendige Software, die Daten und die
Anwendungen selbst.</p>
</blockquote>
<p>Wenn Sie Daten eines Geoinformationssystems nutzen möchten, 
werden Sie früher oder später über den Begriff 
<a href="https://de.wikipedia.org/w/index.php?title=Shapefile&amp;oldid=183295349">Shapefile</a> 
oder Shape Datei stolpern. 
Aber auch wenn Sie nie auf den Begriff 
Shape Datei 
stoßen werden Sie vielleicht einmal einen Webservice nutzen, 
der Endpunkt eines ARCServers ist. 
Außerdem werden Sie sicher auch das 
<a href="https://de.wikipedia.org/w/index.php?title=ESRI&amp;oldid=182723856">ESRI Inc (Environmental Systems Research Institute)</a> 
kennenlernen. 
Dieses Institut ist ein US-amerikanischer Softwarehersteller. 
Das ESRI hat sich auf Geoinformationssysteme spezialisiert. 
Das Unternehmen hat unter anderem die Anwendung 
<a href="https://de.wikipedia.org/w/index.php?title=ArcGIS&amp;oldid=183028892">ArcGIS</a> 
erstellt und das Dateiformat Shapefiles eingeführt.</p>
<blockquote>
<p>Die wesentlichen Produkte des ESRI sind
Geoinformationssysteme. Die Namen der verschiedenen
Geoinformationssysteme des ESRI enthalten in der Regel den Namensteil
ArcGIS. Es gibt ArcGIS Anwendungen für Server und für Clients.</p>
</blockquote>
<p>Bitte lassen Sie sich durch die vielen neuen Begriffe nicht verunsichern. 
Natürlich gibt es Leaflet Plugins, die Ihnen beim Integrieren dieser Services zur 
Hand geht. Außerdem sehen wir uns alles Schritt für Schritt und nacheinander an.</p>
<h2 id="diesem-kapitel-werden-wir">In diesem Kapitel werden wir …</h2>
<p>In diesem Teil werden wir uns als erstes die Karten, 
die das ESRI anbietet, ansehen. 
Danach schauen wir, was sich hinter dem Begriff Shapefile versteckt. 
Außerdem werden wir ESRI Webservices kennen lernen. 
Unter anderem einen <code>L.esri.DynamicMapLayer</code>, Geocoding und 
einen <code>L.esri.FeatureLayer</code> – hier konkret einen <code>Query Layer</code>. 
Mit letztgenanntem können Sie Daten, die Sie nicht benötigen, 
einfach aus der gegebenen Datenmenge herausfiltern. Das kann bei großen Datenmenge 
praktisch sein.</p>
<h2 id="lesribasemaplayer-erweitert-ltilelayer">L.esri.BasemapLayer erweitert L.TileLayer</h2>
<p>Mit der Klasse <code>L.esri.BasemapLayer</code> können Sie Karten, 
die das Esri anbietet, auf Ihrer Website als Leaflet Karte anzeigen.</p>
<blockquote>
<p>Die <a href="https://github.com/esri/esri-leaflet#terms">Nutzungsbedingungen</a> 
für ESRI Dienste gelten für Leaflet Anwendungen. Diese können Sie
auf der Website <a href="https://github.com/esri/esri-leaflet#terms">https://github.com/esri/esri-leaflet#terms</a> 
nachlesen.</p>
</blockquote>
<h3 id="basemaps-und-optionale-layer-von-esri">Basemaps und optionale Layer von ESRI</h3>
<p><a href="#" id="EnvironmentalSystemsResearchInstituteBasemaps"></a>
Sie möchten Basemaps von ESRI verwenden. 
Wir haben im Kapitel <a href="#EineKarteMitLeafletErstellenSchoeneKartenlayer">Schöne Kartenlayer</a> schon Karten von anderen Kartenanbietern 
eingebunden. 
Dieses Kapitel erweitert die Erklärungen im Kapitel 
<a href="#EineKarteMitLeafletErstellenSchoeneKartenlayer">Schöne Kartenlayer</a> um 
ein weiteres Beispiel – nämlich die Karten des 
ESRI Instituts.</p>
<h4 id="basemaps">Basemaps</h4>
<p>Basemaps von ESRI bieten eine weltweite Abdeckung bei einer Vielzahl von Zoom Stufen. 
Dabei können die folgenden Themenbereiche wählen.</p>
<ul>
<li>Streets </li>
<li>Topographic </li>
<li>NationalGeographic </li>
<li>Oceans </li>
<li>Gray </li>
<li>DarkGray </li>
<li>Imagery </li>
<li>ShadedRelief </li>
<li>Terrain </li>
<li>USATopo (Diese Karte wird nur für die USA angeboten) </li>
</ul>
<p>Wenn Ihnen eine der Basiskarten grundsätzlich gut gefällt, 
diese Ihnen aber zu wenig Informationen bietet, können Sie weitere optionale 
Ebenen über diese Basisebene einblenden. 
ESRI bietet speziell für jede Basisebene eine optionale Ebene 
mit weiteren Informationen.</p>
<h4 id="optionale-label-layer">Optionale Label Layer</h4>
<p>Label Layer sind optionale Ebenen, 
die zusätzliche Textbeschriftungen zu den Basiskarten hinzufügen. 
ESRI bietet Ihnen sieben verschiedene optionale Schichten. 
Jede Ebene ist speziell für eine Basiskarte kreiert worden. Wenn Sie möchten, können Sie diese aber auch quer Beet kombinieren. Konkret bietet ESRI die Layer</p>
<ul>
<li>OceansLabels:</li>
<li>GrayLabels:</li>
<li>DarkGrayLabels:</li>
<li>ImageryLabels:</li>
<li>ImageryTransportation:</li>
<li>ShadedReliefLabels</li>
<li>TerrainLabels</li>
</ul>
<p>Alle möglichen Basiskarten mit optionalen Ebenen können Sie auch in der 
Dokumentation des Leaflet Plugins nachlesen. 
Genau finden Sie diese Informationen unter der Adresse 
<a href="https://esri.github.io/esri-leaflet/api-reference/layers/basemap-layer.html">https://esri.github.io/esri-leaflet/api-reference/layers/basemap-layer.html</a>.</p>
<blockquote>
<p>Wenn Sie möchten, können Sie die Anzeige von
Basemaps bei höheren Auflösungen auf Retina-Geräten mit der Option 
<code>detectRetina</code> optimal einstellen. Im nachfolgenden Programmcodeausschnitt wird die
Basemap auf einem Retina Display in Retina-Auflösungen ausgegeben.
Was ein Retina Display ist, habe ich Ihnen im Kapitel 
<a href="#RetinaDisplay">Custom Markers</a> in einem Hinweis erklärt. 
Die <a href="http://leafletjs.com/reference-1.2.0.html#tilelayer-detectretina">Option <code>detectRetina</code></a> 
ist eine Leaflet Funktion.  </p>
</blockquote>
<pre><code>...
L.esri.basemapLayer('DarkGray', {  
detectRetina: true  
}).addTo(map);  
...</code></pre>
<p>Wenn Sie die Option <code>detectRetina</code> mit <code>true</code> belegt haben und 
ein Website-Besucher Ihre Karte auf einem Geräte mit einem Retina-Display öffnet, 
wird Leaflet anstelle der Bilddateien zur aktuellen Zoom-Stufe 
die vierfache Anzahl der Bildkacheln der nächsthöheren Zoom-Stufe anfordern 
und anzeigen. Wie die Bilddateien für eine Zoom-Stufe berechnet werden, 
können Sie im Kapitel <a href="#EineKarteMitLeafletErstellenWieweissLeafletWelcheKartenangezeigtwerdensollen">Wie weiß Leaflet welche Kacheln angezeigt werden sollen</a> 
nachlesen.</p>
<h3 id="ein-erstes-beispiel">Ein erstes Beispiel</h3>
<p>Das nachfolgende Beispiel zeigt Ihnen, wie Sie eine ESRI Basiskarte 
in Leaflet anzeigen können.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="esri-leaflet-debug.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.27264, 7.26469], 7);
*var gray = L.esri.basemapLayer('Gray').addTo(mymap);
*var graylabels = L.esri.basemapLayer('GrayLabels').addTo(mymap);
*gray.setOpacity(0.5);
*gray.on('load', alertme);
*function alertme(){
*alert("Fertig!");
*}
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_945.html--&gt;</code></pre>
<p>Was haben wir gemacht? 
Fangen wir mit dem Wichtigen an: 
Wichtig ist, dass wir das Skript zum ESRI Leaflet Plugin einbinden. 
Ich habe dies mit der Zeile <code>&lt;script src="esri-leaflet-debug.js"&gt;&lt;/script&gt;</code> getan. 
Im Echtsystem können Sie die komprimierte Version verwenden, 
also <code>&lt;script src="esri-leaflet.js"&gt;&lt;/script&gt;</code>. 
Die aktuellste Version dieses Skripts können Sie von der 
Adresse <a href="http://esri.github.io/esri-leaflet/download/">http://esri.github.io/esri-leaflet/download</a> 
kopieren. Nach dem Einbinden des Plugins haben wir mit der 
Zeile <code>var gray = L.esri.basemapLayer('Gray').addTo(mymap);</code> das 
<code>L.esri.basemapLayer</code> Objekt erstellt und es auch sofort zur Karte hinzugefügt. 
Zusätzlich haben wir die Karte mit <code>gray.setOpacity(0.5);</code> transparent 
dargestellt und dem Ereignis <code>on('load')</code> die Funktion <code>alertme()</code> zugeordnet. 
Immer dann, wenn die Karte fertig geladen ist, soll die Funktion <code>alertme()</code> 
ausgeführt werden. 
Genau bedeutet das, dass immer, wenn die Karte fertig geladen ist, 
ein Hinweisfenster erscheint. Verschieben Sie die Karte einmal. 
Dabei werden Sie sehen, dass das Ereignis <code>on('load')</code> auch immer dann, 
wenn die Karte erschoben wird, eintritt.</p>
<p>Die beiden nachfolgenden Abbildungen zeigen Ihnen die Basiskarte mit dem Namen 
gray – einmal mit und einmal ohne optionale Ebene.</p>
<p><img src="../Images/943.png" alt="Die Basiskarte Gray mit optionale Ebene" /></p>
<p><em>Abbildung: Die Basiskarte Gray mit optionale Ebene.</em></p>
<hr />
<p><img src="../Images/944.png" alt="Die Basiskarte Gray ohne optionale Ebene" /></p>
<p><em>Abbildung: Die Basiskarte Gray ohne optionale Ebene.</em></p>
<h3 id="unterschiedliche-basemaps-auswahlen">Unterschiedliche Basemaps auswählen</h3>
<p>Im nächsten Beispiel habe ich im HTML-Dokument eine Auswahllist 
über der Karte eingefügt. 
So können Sie zwischen den verschiedenen ESRI Karten schnell hin und her 
wechseln und sich so einen Überblick über das Kartenangebot verschaffen.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="esri-leaflet-debug.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
*&lt;select
*style ="position: absolute;top: 10px;right:10px;z-index: 400;"
*id="basemaps"
*onChange="changeBasemap(basemaps)"
*&gt;
*&lt;option value="Topographic"&gt;Topographic&lt;/option&gt;
*&lt;option value="Streets"&gt;Streets&lt;/option&gt;
*&lt;option value="NationalGeographic"&gt;National Geographic&lt;/option&gt;
*&lt;option value="Oceans"&gt;Oceans&lt;/option&gt;
*&lt;option value="Gray"&gt;Gray&lt;/option&gt;
*&lt;option value="DarkGray"&gt;Dark Gray&lt;/option&gt;
*&lt;option value="Imagery"&gt;Imagery&lt;/option&gt;
*&lt;option value="ShadedRelief"&gt;Shaded Relief&lt;/option&gt;
*&lt;option value="Terrain"&gt;Terrain&lt;/option&gt;
*&lt;option value="USATopo"&gt;USATopo    &lt;/option&gt;
*&lt;/select&gt;
*&lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.27264, 7.26469], 7);
 var layer = L.esri.basemapLayer('Gray').addTo(mymap);
*function changeBasemap(basemaps){
*var basemap = basemaps.value;
*if (layer) {
*mymap.removeLayer(layer);
*}
*layer = L.esri.basemapLayer(basemap);
*mymap.addLayer(layer);
*}
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_944.html--&gt;</code></pre>
<p>Was haben wir genau gemacht? 
Hier gibt es nichts weltbewegend Neues. 
Eine Auswahlliste haben wir schon oft im Buch verwendet. 
Wenn ein Website-Besucher den aktiven Listeneintrag der Auswahlliste ändert, 
wird die aktuelle Kartenebene mit <code>mymap.removeLayer(layer)</code> entfernt. 
Danach wird eine neue Ebene mit der gewünschten Option erstellt – 
<code>layer = L.esri.basemapLayer(basemap)</code> – und diese wird dann zum Kartenobjekt hinzugefügt 
<code>mymap.addLayer(layer)</code>.  </p>
<p>Im Ergebnis können Sie sich mithilfe der Auswahlliste alle ESRI Karten ansehen. 
Oder Sie können es einem Website-Besucher ermöglichen die Karte, 
die dieser am schönsten findet, für seine Ansicht zu aktivieren.</p>
<p><img src="../Images/942.png" alt="Dieses Bild zeigt die ESRI Basiskarte Imagery." /></p>
<p><em>Abbildung: Dieses Bild zeigt die ESRI Basiskarte Imagery.</em></p>
<h2 id="shapefiles">Shapefiles</h2>
<p>Das Dateiformat Shapefile wurde von der Firma ESRI für die Software ArcView entwickelt. 
Shape Dateien sind speziell für die Verarbeitung von Geodaten entwickelt worden.</p>
<h3 id="was-genau-verbirgt-sich-hinter-dem-begriff-shapefile">Was genau verbirgt sich hinter dem Begriff Shapefile</h3>
<p>Ein <a href="https://de.wikipedia.org/w/index.php?title=Shapefile&amp;oldid=183295349">Shapefile</a> ist keine einzelne Datei. 
In der Regel handelt es sich um mehrere Dateien, 
die zu einem Zip-Archiv zusammengefasst sind. 
In diesem Zip-Archiv müssen mindestens die drei nachfolgend genannten 
Dateitypen vorhanden sein:</p>
<ul>
<li>Eine Datei mit der Endung  <code>.shp</code>  dient zur Speicherung der Geometriedaten. </li>
<li>Eine Datei mit der Endung  <code>.dbf</code>  enthält Attribute oder Eigenschaften. </li>
<li>Eine Datei mit der Endung  <code>.shx</code>  dient als eine Art Index. Mithilfe dieser Datei sind die Geometriedaten in der Datei  <code>.shp</code>  mit den Eigenschaften in der  <code>.dbf</code>-Datei verknüpft. </li>
</ul>
<blockquote>
<p>Weitere Informationen zu Shapefiles und wie Sie diese selbst erstellen können, 
finden Sie auf der Website 
<a href="http://desktop.arcgis.com/de/arcmap/10.3/manage-data/shapefiles/creating-a-new-shapefile.htm">http://desktop.arcgis.com/de/arcmap/10.3/manage-data/shapefiles/creating-a-new-shapefile.htm</a>.</p>
</blockquote>
<h3 id="wie-kommen-sie-ein-shapefiles">Wie kommen Sie an ein Shapefiles</h3>
<p>Natürlich können Sie selbst ein Shapefile erstellen. 
Das ist aber gar nicht einfach und außerdem nicht Thema dieses Buches. 
Einfach ist es aber, an Shapefiles von anderen heranzukommen. 
Insbesondere Daten, die von öffentlichem Interesse sind, 
werden oft zum Download als Shapefile angeboten. 
Suchen einfach einmal in einer Suchmaschine nach Websites, die 
den Text <em>Open Data</em> enthalten.</p>
<p>Bei einer Suche nach <em>Open Data</em> in einer Suchmaschine im Internet habe ich 
unter anderem das Schienennetz der Deutschen Bahn als Shapefile gefunden:<br />
<a href="http://data.deutschebahn.com/dataset/geo-strecke">http://data.deutschebahn.com/dataset/geo-strecke</a>. 
Höchstwahrscheinlich interessieren Sie sich für Daten in der Nähe Ihres Wohnortes. 
Dann geben Sie zum Suchbegriff <em>Open Data</em> einfach den Namen einer 
Stadt in der Nähe Ihres Wohnortes ein. 
Eine Suche nach <em>Open Data</em> in der Nähe von <em>Koblenz</em> hat mich zu einer Website 
des Landesvermessungsamtes Koblenz geführt. 
Die Website 
<a href="https://lvermgeo.rlp.de/de/geodaten/opendata/">https://lvermgeo.rlp.de/de/geodaten/opendata/</a> 
informiert über das Angebot des Landesvermessungsamtes - 
insbesondere über das Angebot an offenen Daten. 
Einige dieser Daten, zum Beispiel die Flurgrenzen, stehen als Shapefile zur Verfügung.</p>
<p>Wenn Sie per Internetsuche keine passenden Daten finden, können Sie auf der 
Website von Openstreetmap, insbesondere auf der 
Unterseite <a href="https://wiki.openstreetmap.org/wiki/Shapefiles">https://wiki.openstreetmap.org/wiki/Shapefiles</a> 
nach weiteren Anbietern suchen. 
Neben weiteren Informationen zum Shapefile Format gibt es hier auch eine Liste mit 
Anbietern von Shapefiles.</p>
<blockquote>
<p>Es muss nicht an Ihnen liegen, wenn Sie bei der Arbeit mit Geodaten auf
einen Fehler stoßen.
Insbesondere dann nicht, wenn Sie Daten von anderen in Ihre Arbeit
einbinden. Da das Shapefile Format kompliziert ist, ist es gut, dass
es im Internet Websites gibt, auf denen man eine Shapefile Datei
testen kann. Eine dieser Websites ist 
<a href="http://leaflet.calvinmetcalf.com">http://leaflet.calvinmetcalf.com</a>.
<img src="../Images/969.png" alt="Test eines Shapefiles mithilfe der Website [http://leaflet.calvinmetcalf.com](http://leaflet.calvinmetcalf.com)." />
<em>Abbildung: Test eines Shapefiles mithilfe der Website <a href="http://leaflet.calvinmetcalf.com">http://leaflet.calvinmetcalf.com</a>. Das getestet Shapefile <code>vg2500_geo84.zip</code> finden Sie in den Beispieldateien </em></p>
</blockquote>
<h3 id="wie-binden-sie-shapefiles-ihre-leaflet-karte-ein">Wie binden Sie Shapefiles in Ihre Leaflet Karte ein?</h3>
<h4 id="deutsche-verwaltungsgrenzen-als-shapefile-der-leaflet-karte">Deutsche Verwaltungsgrenzen als Shapefile in der Leaflet Karte</h4>
<p>Die Shape Datei, die ich im nächsten Beispiel verwende, habe ich von der 
Website <a href="https://www.arcgis.com/home/item.html?id=ae25571c60d94ce5b7fcbf74e27c00e0">https://www.arcgis.com/home/item.html?id=ae25571c60d94ce5b7fcbf74e27c00e0</a> kopiert. 
Die Firma ESRI bietet auf dieser Website mit ArcGIS ein Geoinformationssystem, 
dass die Verwendung, Erstellung und Freigabe von Geodaten einfach macht. 
Ich habe mir den oben verlinkten Datensatz mit den Verwaltungsgrenzen 
von Deutschland kopiert. Die Datei landet unter dem Namen <code>vg2500_geo84.zip</code> 
bei mir auf dem Computer.</p>
<p><img src="../Images/970.png" alt="Download eines Shapefiles von der Adresse https://www.arcgis.com." /></p>
<p><em>Abbildung: Download eines Shapefiles von der Adresse arcgis.com.</em></p>
<p>Wie ich die Shape Datei mit Leaflet in eine Karte integriere, 
zeigt Ihnen das nachfolgende Beispiel. 
Natürlich gibt es dafür auch wieder ein Leaflet Plugin. 
Die Website zum Plugin <code>Leaflet.Shapefile</code> finden Sie auf Github unter 
der Adresse 
<a href="https://github.com/calvinmetcalf/leaflet.shapefile">https://github.com/calvinmetcalf/leaflet.shapefile</a>. 
Die Datei zum Plugin heißt <code>leaflet.shpfile.js</code>. 
Der gleiche Entwickler bietet auch ein Skript zum Analysieren 
der Shape Datei unter der Adresse 
<a href="https://github.com/calvinmetcalf/shapefile-js">https://github.com/calvinmetcalf/shapefile-js</a> an. 
Diese Datei heißt <code>shp.js</code>. Diese beiden Dateien müssen Sie in Ihre HTML-Datei einbinden.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="shp.js"&gt;&lt;/script&gt;
*&lt;script src="leaflet.shpfile.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.27264, 7.26469], 6);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var shpfile = new L.Shapefile('vg2500_geo84.zip');
*shpfile.addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_943.html--&gt;</code></pre>
<p>Die vier mit dem Stern markierten Zeilen zeigen schon alles Notwendige. 
Und was haben wir genau gemacht? Im Kopfbereich unserer Beispiel HTML-Datei 
haben wir zwei Skripte eingebunden. Einmal das Skript <code>leaflet.shpfile.js</code> 
zum Leaflet Plugin und dann das Skript <code>shp.js</code> zum Analysieren der Shape Datei. 
Danach haben wir mit der Zeile <code>var shpfile = new L.Shapefile('vg2500_geo84.zip')</code> 
eine Ebene mit den Daten der Shape Datei erstellt. 
Zum Schluss haben wir diese Ebene zum Kartenobjekt hinzugefügt: <code>shpfile.addTo(mymap)</code>.</p>
<p>Als Ergebnis sehen Sie nun alle Verwaltungsgrenzen, 
also die reinen Geometrien. 
Eigenschaften, die in der Shape Datei enthalten sind, 
werden in diesem Beispiel noch nicht angezeigt. 
Das Anzeigen von Eigenschaften und das Zuordnen anderer Stile habe 
ich für das nächste Beispiel aufgehoben.</p>
<p><img src="../Images/967.png" alt="Eine Karte auf der ein Shapefile, dass die deutschen Verwaltungsgrenzen enthält, angezeigt wird." /></p>
<p><em>Abbildung: Eine Karte, auf der ein Shapefile, dass die deutschen Verwaltungsgrenzen enthält, angezeigt wird.</em></p>
<h4 id="deutsche-verwaltungsgrenzen-mit-optionen">Deutsche Verwaltungsgrenzen mit Optionen</h4>
<p>Im nächsten Beispiel sehen Sie, 
wie Sie das Aussehen der Formen in der Shape Datei beeinflussen könne.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;script src="shp.js"&gt;&lt;/script&gt;
 &lt;script src="leaflet.shpfile.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.27264, 7.26469], 6);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
 var shpfile = new L.Shapefile('vg2500_geo84.zip',
 {
*style:function(feature)
*{
*return {color:"black",fillColor:"red",fillOpacity:.75}
*}
*}
*);
*shpfile.addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_942.html--&gt;</code></pre>
<p>Das vorhergehende Beispiel manipuliert die Option <code>style</code>. 
Die Belegung der Option <code>style</code> mit 
<code>color:"black",fillColor:"red",fillOpacity:.75</code> färbt die Grenzen 
der Shape Datei schwarz und füllt die Formen mit der Farbe Rot – 
bei einer Transparenz von 75 Prozent.</p>
<p>Das rot gefärbte Deutschland können Sie sich in der nächsten Abbildung ansehen.</p>
<p><img src="../Images/968.png" alt="Eine Karte auf der ein Shapefile, dass die deutschen Verwaltungsgrenzen enthält, angezeigt wird." /></p>
<p><em>Abbildung: Eine Karte, auf der ein Shapefile, dass die deutschen Verwaltungsgrenzen enthält, angezeigt wird. In diesem Beispiel wurden die Farben geändert.</em></p>
<h4 id="ein-pop-fenster">Ein Pop-up-Fenster</h4>
<p>Schön wäre es, wenn man für jede Verwaltungseinheit 
den Namen in einem Pop-up Fenster angezeigt bekommen würde – 
und zwar genau dann, wenn man die Fläche auf der Karte anklickt. 
Im nächsten Beispiel sehen Sie, wie Sie dies umsetzen können.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;script src="shp.js"&gt;&lt;/script&gt;
 &lt;script src="leaflet.shpfile.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.27264, 7.26469], 5);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var shpfile = new L.Shapefile(
*'vg2500_geo84.zip',
*{
*onEachFeature:function(feature, layer)
*{
*layer.bindPopup(feature.properties.GEN);
*}
*}
*);
 shpfile.addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;-- index_941.html --&gt;</code></pre>
<p>In diesem Beispiel haben wir die Option  <code>onEachFeature</code>  verwendet. Wir haben dieser Option eine anonyme Funktion zugeordnet in der wir jedem Feature in der Shape Datei mithilfe von  <code>layer.bindPopup(feature.properties.GEN)</code>  ein Pop-up Fenster zugewiesen haben. Im Pop-up Fenster erscheint der Text, der bei dem Feature im Attribut  <code>GEN</code>  als Eigenschaft eingetragen ist. Wenn Sie sich nun fragen, woher Sie wissen können, dass es als Eigenschaft ein Attribut  <code>GEN</code>  gibt, dann warten Sie bis zum nächsten Beispiel. Dort werde ich Ihnen zeigen, wie Sie alle Optionen auslesen können.</p>
<p>Probieren Sie aber zunächst dieses Beispiel selbst aus. Öffnen Sie die Karte und klicken Sie einen Landkreis an. Wie in der nachfolgenden Abbildung zu sehen ist, sollte sich auch auf Ihrer Karte ein Pop-up Fenster öffnen.</p>
<p>Auf diese Art und Weise können Sie auch
das Aussehen einer Form, abhängig vom Wert eines Attributes
gestalten.</p>
<p><img src="../Images/966.png" alt="Eine Karte auf der ein Shapefile, dass die deutschen Verwaltungsgrenzen enthält, angezeigt wird." /></p>
<p><em>Abbildung: Eine Karte, auf der ein Shapefile, dass die deutschen Verwaltungsgrenzen enthält, angezeigt wird. In diesem Beispiel wird der Name der Verwaltungseinheit angezeigt, wenn man mit der Maus die entsprechende Form anklickt.</em></p>
<h4 id="ein-pop-fenster-mit-allen-informationen-des-features">Ein Pop-up-Fenster mit allen Informationen des Features</h4>
<p>Sie wissen nicht, welche Eigenschaften in der Shape Datei genau für die 
Geometrien enthalten sind – Sie möchten sich aber gerne einen Überblick über 
diese Eigenschaften verschaffen. Das nächste Beispiel zeigt Ihnen, 
wie Sie die Informationen nur mit JavaScript in Erfahrung bringen können.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;script src="shp.js"&gt;&lt;/script&gt;
 &lt;script src="leaflet.shpfile.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.27264, 7.26469], 5);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
 var shpfile = new L.Shapefile(
 'vg2500_geo84.zip',
 {
*onEachFeature:function(feature, layer)
*{
*var holder=[];
*for (var key in feature.properties){
*holder.push(key+": "+feature.properties[key]+"&lt;br&gt;");
*popupContent=holder.join("");
*}
*layer.bindPopup(popupContent);
*}});
*shpfile.addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_940.html--&gt;</code></pre>
<p>Für die Beantwortung dieser Fragestellung nutzen wir auch 
wieder die Option <code>onEachFeature</code>. 
In dieser Option erstellen wir eine Variable, genau ein Array, mit dem Namen 
<code>holder</code>. Als nächstes durchlaufen wir in einer Schleife alle Schlüssel, 
die in den Eigenschaften der Shape Datei, also in <code>feature.properties</code> enthalten sind. 
Wir fügen mit 
<a href="https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/Global_Objects/Array/push"><code>push()</code></a> 
jeden Eintrag in das Array <code>holder</code> ein und separieren diesen von dem 
nächsten Eintrag mit 
<a href="https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/Global_Objects/Array/join"><code>join()</code></a>. 
Den Text mit allen Schlüssel-Wert-Paaren fügen wir am Schluss als Pop-up 
Text zum Layer hinzu.  </p>
<p>Als Ergebnis sehen Sie alle möglichen Schlüssel-Wert-Paare 
in einem Pop-up Fenster über Ihrer Karte, sobald Sie eine Fläche anklicken.</p>
<p><img src="../Images/965.png" alt="Eine Karte auf der ein Shapefile, dass die deutschen Verwaltungsgrenzen enthält, angezeigt wird." /></p>
<p><em>Abbildung: Eine Karte, auf der ein Shapefile, dass die deutschen Verwaltungsgrenzen enthält, angezeigt wird. In diesem Beispiel werden alle Informationen zur Verwaltungseinheit angezeigt, wenn man mit der Maus die entsprechende Form anklickt.</em></p>
<h2 id="esri-services">ESRI Services</h2>
<p>Sie wissen nun wie Sie eine ESRI Basiskarte laden, 
wie Sie mit dem Plugin ESRI-Leaflet grundsätzlich umgehen und wie Sie Dateien 
im Format Shapefile nutzen können.</p>
<p>ESRI bietet aber noch eine ganze Menge mehr. 
Sie können ArcGIS Server-Web-Services nutzen. 
Das ESRI Plugin unterstützt Sie auch bei der Verbindung mit einem 
Web Service, der sich auf einer ArcGIS Server-Website befindet und 
für Client-Anwendungen zur Verfügung gestellt wird. 
Mit einem ArcGIS Web Service kann entweder eine weitere 
<a href="http://esri.github.io/esri-leaflet/api-reference/#layers">Ebene</a> 
für eine Karte zur Verfügung gestellt oder eine bestimmte 
<a href="http://esri.github.io/esri-leaflet/api-reference/#tasks">Aufgabe</a> bearbeitet werden.</p>
<p>Eine Ebene kann dabei neben dem </p>
<ul>
<li><code>L.esri.BasemapLayer</code>, den Sie ja schon kennengelernt haben, </li>
<li>ein <code>L.esri.DynamicMapLayer,</code> </li>
<li>ein <code>L.esri.ImageMapLayer</code>, </li>
<li>ein  <code>L.esri.RasterLayer</code>, </li>
<li>ein <code>L.esri.TiledMapLayer</code>, </li>
<li>ein  <code>L.esri.FeatureLayer</code>, </li>
<li>ein  <code>L.esri.Cluster.FeatureLayer</code> oder </li>
<li>ein <code>L.esri.Heat.FeatureLayer</code> sein.  </li>
</ul>
<p>Eine Aufgabe könnte das Einschränken der Anzeige auf bestimmte Objekte mit 
<code>L.esri.Query</code> sein oder das Zuordnen von Adressen zu Koordinaten mit <code>L.esri.Geocoding</code>.</p>
<p>Im nächsten Kapitel beginnen wir damit, 
das wir eine Ebene, nämlich einen <code>L.esri.DynamicMapLayer</code>, 
mithilfe eines Web Services nutzen. 
Wenn Sie dieses Beispiel durchgearbeitet haben, 
können Sie alle anderen Layer ebenfalls verwenden. 
Die Vorgehensweise ist bei jedem einheitlich. 
Der einzige Unterschied besteht im Angebot der möglichen Methoden und Optionen. 
Da aber die Dokumentation zum Plugin sehr gut ist, 
dürfte dies keine Schwierigkeit darstellen. 
Die Dokumentation zu den Layern finden Sie unter der Adresse 
<a href="http://esri.github.io/esri-leaflet/api-reference/#layers">http://esri.github.io/esri-leaflet/api-reference/#layers</a>.</p>
<h3 id="lesridynamicmaplayer">L.esri.DynamicMapLayer</h3>
<p>Für das nachfolgende Beispiel habe ich Daten des 
<a href="http://www.stadt-koeln.de/politik-und-verwaltung/geoportal/">Geoportals Köln</a> genutzt. 
Dieses Portal bietet den Zugriff auf offene Daten, Dienste und Anwendungen 
verschiedener Herkunft. Das Geoportal Köln zentralisieren nach eigenen Angaben 
Informationen aus den Bereichen Umwelt, Verkehr, Vermessung und Planung. 
Jeder hat die Möglichkeit die Geodaten des Geoportal Köln zu nutzen, 
anzusehen und zu analysieren. Informationen zum Geoportal Köln finden Sie auf der 
Website der Stadt Köln, genau unter der Adresse 
<a href="http://www.stadt-koeln.de/politik-und-verwaltung/geoportal">http://www.stadt-koeln.de/politik-und-verwaltung/geoportal</a>. 
Die Dokumentation zur Schnittstelle des Web Services finden Sie unter 
der Adresse <a href="https://geoportal.stadt-koeln.de/arcgis/">https://geoportal.stadt-koeln.de/arcgis/</a>. 
Wenn Sie dann auf den Eintrag <em>Behindertenparkplätze</em> klicken sehen Sie die Angaben, 
die speziell unser nachfolgendes Beispiel betreffen.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;script src="esri-leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.97264, 7.00469], 12);
 L.esri.basemapLayer('Gray').addTo(mymap);
*var url = 
*"https://geoportal.stadt-koeln.de/arcgis/rest/services/Behindertenparkplaetze/MapServer";
*var dMap = L.esri.dynamicMapLayer({
*url: url,
*opacity : 0.25,
*useCors: false
*}).addTo(mymap);
*dMap.bindPopup(
*function(err, featureCollection, response){
*return featureCollection.features[0].properties.Bezeichnung +
*'&lt;br&gt;Anzahl: ' +
*featureCollection.features[0].properties.Anzahl;
*});
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_939.html--&gt;</code></pre>
<p>Als erstes haben wir im vorherigen Beispiel das Skript zum Esri Leaflet Plugin 
eingebunden. Als nächstes haben wir die URL, unter welcher der betreffende Service 
angeboten wird, in die Variabel <code>url</code> gespeichert. 
Danach haben wir mit dem Code</p>
<pre><code>var dMap = L.esri.dynamicMapLayer({
url: url,
opacity : 0.25,
useCors: false
}).addTo(mymap);</code></pre>
<p>ein <code>L.esri.dynamicMapLayer</code>-Objekt erstellt und diesem gleichzeitig Optionen 
übergeben. Unter anderem die URL. Zuletzt haben wir dann mit dem Code</p>
<pre><code>dMap.bindPopup(  
function(err, featureCollection, response){  
return featureCollection.features[0].properties.Bezeichnung +  
'&lt;br&gt;Anzahl: ' +  
featureCollection.features[0].properties.Anzahl;  
});</code></pre>
<p>jedem Feature ein Pop-up hinzugefügt und in dieses Pop-up die Eigenschaften 
<code>Bezeichnung</code> und  <code>Anzahl</code> 
als Text eingetragen. 
Welche Eigenschaften Ihnen ein Web Service zur Verfügung stellt, 
finden Sie in der Dokumentation zum jeweiligen Service. 
Die Adresse zur Dokumentation des hier verwendeten Services hatte 
ich Ihnen weiter oben schon genannt.</p>
<p>Die nachfolgende Abbildung zeigt Ihnen alle 
– im Web Service Behindertenparkplätze des Geoportals Köln eingetragenen – Parkplätze.</p>
<p><img src="../Images/938.png" alt="Eine Karte, auf der die Behindertenparkplatze in der Stadt Köln mithilfe eines Webservices angezeigt werden." /></p>
<p><em>Abbildung: Eine Karte auf der die Behindertenparkplatze in der Stadt Köln mithilfe eines Webservices angezeigt werden. Sie können Informationen zum Parkplatz in einem Pop-up einsehen.</em></p>
<h3 id="geocoding">Geocoding</h3>
<p>Was ist <a href="https://de.wikipedia.org/w/index.php?title=Georeferenzierung&amp;oldid=174938538">Geocoding</a>? 
Geocoding bezeichnet die Umwandlung von Adressen wie <em>'Kirchstraße 13, 56571 Muster'</em> 
in geografische Koordinaten wie <em>'50.423021 Breite'</em> und <em>'7.083739 Länge'</em>. 
Nur so können Sie nämlich einen Marker auf einer Karte platzieren oder 
die Karte an einer bestimmten Adresse zentriert öffnen.</p>
<blockquote>
<p>Nicht nur ESRI bietet Geocoding Dienste an. Auch OpenStreetMap bietet 
Ihnen diesen Service. <a href="https://nominatim.openstreetmap.org">Nominatim</a> 
ist eine Anwendung, mithilfe derer OpenStreetMap Daten anhand von
Texten durchsucht werden können. Diese Texte sind in der Regel eine
Adresse oder ein Teil einer Adresse. Falls der Suchtext mit einer 
Eigenschaft eines OpenStreetMap-Objektes, übereinstimmt, wird die Koordinate zu
diesem Objekt auf eine Suchanfrage hin zurückgegeben. 
Sie finden die Anwendung Nominatim unter der Adresse 
<a href="https://nominatim.openstreetmap.org">https://nominatim.openstreetmap.org</a> im Internet.  </p>
</blockquote>
<blockquote>
<p>Da Nominatim auf OpenStreetMap Daten beruht,
können Sie sich nicht darauf verlassen, dass alle Adressen
eingetragen sind. OSM ist keine kommerzielle Firma, sondern ein
Projekt das auf der Mitarbeit von Freiwilligen beruht. Dafür können
Sie aber selbst Einfluss auf den Datenbestand nehmen. Bei
OpenStreetMap kann jeder mitmachen: 
<a href="http://wiki.openstreetmap.org/wiki/DE:Getting_Involved">http://wiki.openstreetmap.org/wiki/DE:Getting_Involved</a>.
Ein Pluign, dass unter anderem Nominatim als Service nutze, ist das Plugin 
<a href="https://github.com/perliedman/leaflet-control-geocoder">Leaflet Control Geocoder</a>. Dieses sehen wir uns im nächsten Kapitel an.</p>
</blockquote>
<p>Ich zeige Ihnen in diesem Kapitel anhand des 
<a href="https://github.com/Esri/esri-leaflet-geocoder">ESRI Leaflet Geocoder Plugins</a> folgendes:</p>
<ul>
<li>Ich zeige Ihnen, wie Sie eine Adresse in eine Koordinate umwandeln können. </li>
<li>Ich zeige Ihnen, wie Sie eine Koordinate in eine Adresse umwandeln können. </li>
<li>Ich zeige Ihnen, wie Sie eine Karte so öffnen können, 
dass eine bestimmte Adresse zentriert angezeigt wird. </li>
</ul>
<h4 id="nach-eingabe-einer-adresse-den-passenden-ort-auf-der-karte-f">Nach Eingabe einer Adresse den passenden Ort auf der Karte finden</h4>
<p>Sie zeigen eine Karte auf Ihrer Website an und möchten es anderen ermöglichen, 
zu einer bestimmten Adresse auf der Karte zu navigieren, nachdem Sie diese Adresse 
in einem Textfeld eingetragen haben. Dann integrieren Sie doch einfach ein ESRI 
Leaflet Geocoder Control in Ihre Karte. Wie Sie dies tun können zeigt Ihnen das 
nächste Beispiel.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="esri-leaflet.js"&gt;&lt;/script&gt;
*&lt;link rel="stylesheet" href="esri-leaflet-geocoder.css"&gt;
*&lt;script src="esri-leaflet-geocoder.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 300px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.97264, 7.00469], 12);
 L.esri.basemapLayer('Gray').addTo(mymap);
 var searchControl = L.esri.Geocoding.geosearch().addTo(mymap);
 var results = L.layerGroup().addTo(mymap);
*searchControl.on('results', function(data) {
*results.clearLayers();
*for (var i = data.results.length - 1; i &gt;= 0; i--) {
*results.addLayer(L.marker(data.results[i].latlng));
 }
 });
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_938.html--&gt;</code></pre>
<p>Zur Darstellung des Textfeldes für die Eingabe der Adresse ist es notwendig zwei 
weitere Skripte einzubinden. 
Neben dem Skript <code>esri-leaflet.js</code> sollten Sie auch noch die Dateien 
<code>esri-leaflet-geocoder.css</code> und <code>esri-leaflet-geocoder.js</code> 
in Ihr HTML-Dokument einbinden. 
Die notwendigen Dateien hierfür finden Sie unter der 
Adresse <a href="https://github.com/Esri/esri-leaflet-geocoder">https://github.com/Esri/esri-leaflet-geocoder</a>. 
Als nächstes wird dann mit 
<code>var searchControl = L.esri.Geocoding.geosearch().addTo(mymap);</code> 
das Eingabefeld für die zu suchende Adresse erstellt und zur Karte hinzugefügt. 
Dieses Eingabefeld nennt Leaflet auch Control. 
Wir brauchen eine Ebene, die die Suchergebnisse richtig verarbeitet. 
Diese erstellen wir mit der Zeile <code>var results = L.layerGroup().addTo(mymap);</code>. 
Zum Schluss können wir dann das Ereignis <code>on("results")</code> 
des Objektes <code>searchControl</code> mit einer Funktion belegen.</p>
<pre><code>searchControl.on('results', function(data) {
results.clearLayers();
for (var i = data.results.length - 1; i &gt;= 0; i--) {
results.addLayer(L.marker(data.results[i].latlng));
}
});</code></pre>
<p>Wenn es neue Suchergebnisse gibt, dann werden alle alten Suchergebnisse von 
der Ebene entfernt und die neuen Suchergebnisse als Marker auf der Ebene platziert.</p>
<blockquote>
<p>Ihre Adresse wird
nicht auf der Karte gefunden? Das ESRI Leaflet Geocoder Control
findet mithilfe der <a href="http://esri.github.io/esri-leaflet/api-reference/controls/geosearch.html">Methode <code>geosearch()</code></a> 
standardmäßig nur Adressen, die aktuell auch sichtbar auf der Karte
sind. Erst wenn Ihre - sicher vorhandene - Adresse auch bei einer Zoom-Stufe von 0 nicht
gefunden wird, stimmt etwas nicht. Falls Sie lieber sofort die ganze
Welt durchsuchen möchten, dann sollten Sie die Option 
<code>useMapBounds</code> des Objektes, das Ihnen die Funktion <code>L.esri.Geocoding.geosearch()</code> 
liefert, mit <code>false</code>  belegen.</p>
</blockquote>
<p>Die erste Ansicht der Karte nach dem Hinzufügen des ESRI Leaflet Geocoder Control 
Plugins ist nicht spektakulär. 
Sie sehen in der linken oberen Ecke eine kleine Lupe. 
Wenn Sie diese anklicken, öffnet sich ein Textfeld. 
In dieses Textfeld können Sie nun die Adresse eingeben, 
nach der Sie suchen möchten. 
Standardmäßig werden Ihnen alternative Eingaben vorgeschlagen. 
Sie können das Verhalten des Plugins mit vielen Optionen beeinflussen. 
Sehen sich die Dokumentation unter Adresse 
<a href="http://esri.github.io/esri-leaflet/api-reference/controls/geosearch.html">http://esri.github.io/esri-leaflet/api-reference/controls/geosearch.html</a> an. 
Vielleicht ist da sogar eine Option dabei, auf die Sie selbst nicht gekommen wären, 
die sie aber als nützlich ansehen.</p>
<p><img src="../Images/937.png" alt="Nach Eingabe einer Adresse den passenden Ort auf der Karte finden." /></p>
<p><em>Abbildung: Nach Eingabe einer Adresse den passenden Ort auf der Karte finden.</em></p>
<h4 id="mithilfe-eines-parameters-der-url-den-passenden-ort-finden">Mithilfe eines Parameters in der URL den passenden Ort finden</h4>
<p>Manchmal kommt es vor, dass Sie eine Karte schon an einer bestimmten Adresse zentriert öffnen möchten. Wie Sie so etwas umsetzten können, zeigt Ihnen das nächste Beispiel.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="esri-leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="esri-leaflet-geocoder.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 300px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
*var x = location.search;
* var y = x.split("=");
*var temp=y[1];
*var address = decodeURIComponent(temp);
 var mymap = L.map('mapid', {}).setView([50.97264, 7.00469], 3);
 L.esri.basemapLayer('Gray').addTo(mymap);
*L.esri.Geocoding.geocode()
*.text(address)
*.run(function(err, result, response){
*L.marker(result.results[0].latlng)
*.addTo(mymap);
*mymap.setView(result[0].latlng,13);
*}
*);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_937.html--&gt;</code></pre>
<p>Was haben wir genau gemacht? Angenommen, wir haben in der Adresszeile des Browsers 
den Text  <code>?test=56751 Gering</code>  an die URL angefügt. Dieser Text würde im 
Beispiel als erstes in der Variablen <code>x</code> gespeichert. 
Hierzu wird die <a href="https://wiki.selfhtml.org/wiki/JavaScript/Location/search">Eigenschaft <code>location.search</code></a> 
zu Hilfe genommen. Diese Eigenschaft speichert eine Zeichenkette die, 
durch ein Fragezeichen getrennt, zur aktuellen URL gehört. 
Die Variable <code>x</code> enthält also nun den Text <code>test=56751 Gering</code>. 
Diesen Text haben wir dann mithilfe von <code>x.split("=")</code> 
an der Position des Gleichheitszeichens getrennt und die beiden 
Teile als Array in der Variablen <code>y</code> gespeichert. 
Den Adressteil können wir nun über <code>y[1]</code> abrufen. 
Wir müssen die Adresse vor der Eingabe in eine Suchfunktion aber noch dekodieren. 
In der URL wurde diese nämlich kodiert. 
<code>var address = decodeURIComponent(temp)</code> 
macht aus <code>56751%20Gering</code> wieder <code>56751 Gering</code> und speichert den 
dekodierten Text in der Variablen <code>address</code> ab.<br />
Und diesen Text können wir nun als Suchtext in die Methode <code>text()</code> 
des Geocode Objektes eingeben und auf dem Ergebnis die Methode <code>run()</code> ausführen.</p>
<blockquote>
<p>Weitere Informationen zu <code>decodeURIComponent()</code> finden Sie unter der Adresse
<a href="https://wiki.selfhtml.org/wiki/JavaScript/decodeURIComponent">https://wiki.selfhtml.org/wiki/JavaScript/decodeURIComponent</a>.</p>
</blockquote>
<pre><code>L.esri.Geocoding.geocode()
.text(address)
.run(function(err, result, response){
L.marker(result.results[0].latlng)
.addTo(mymap);
}
);
mymap.setView(result.results[0].latlng,13);  
});</code></pre>
<p>Die Rückruffunktion, die daraufhin ausgeführt wird, erstellt einen Marker 
für das erste Ergebnis und zentriert diesen Marker, 
bei einer Zoom-Stufe von 13, in der Karte. Eine 
<a href="https://de.wikipedia.org/wiki/R%C3%BCckruffunktion">Rückruffunktion</a> ist eine 
Funktion, die einer anderen Funktion als Parameter übergeben und von dieser erst 
später, unter definierten Bedingungen mit definierten Argumenten, aufgerufen wird. 
Eine solche Funktion kennen Sie sicher auch unter dem englischen Namen 
<code>callback function</code>.</p>
<blockquote>
<p>Möchten Sie die Suchanfrage genauer formulieren? 
Dann ersetzen Sie den Text </p>
<pre><code>L.esri.Geocoding.geocode()  
.text('Amselweg 7, Koblenz, Rheinland Pfalz, 65065')  
.run(function(err, results, response){  
...  
});</code></pre>
<p>mit</p>
<pre><code>L.esri.Geocoding.geocode()
.address('Amselweg 7')
.city('Koblenz').region('Rheinland Pfalz')
.postal(65065)
.run(function(err, results, response){
...
});</code></pre>
</blockquote>
<p>Welche Funktionen Sie genau verwenden können, 
ist in der Dokumentation beschrieben: 
<a href="https://esri.github.io/esri-leaflet/api-reference/tasks/geocode.html">https://esri.github.io/esri-leaflet/api-reference/tasks/geocode.html</a>.</p>
<p>Voilà! Wenn sie an die URL, unter der Sie Ihre Leaflet Karte abegelegt haben, 
den Text <code>?test=56751 Gering</code> anhängen, wird Ihnen die in der 
nachfolgenden Abbildung dargestellte Karte angezeigt.</p>
<p><img src="../Images/936.png" alt="Mithilfe eines Parameters in der URL den passenden Ort finden." /></p>
<p><em>Abbildung: Mithilfe eines Parameters in der URL den passenden Ort finden.</em></p>
<h4 id="nach-klick-auf-die-karte-die-passende-adresse-ausgeben">Nach Klick auf die Karte die passende Adresse ausgeben</h4>
<p>Umgekehrtes Geocoding ist die Bezeichnung für die Umwandlung geografischer Koordinaten in, 
für Menschen gut lesbare, Adressen.
Sie wissen ja schon, dass Leaflet bei einem Klick mit der Maus auf die 
Karte die Koordinaten in einem Objekt speichert. 
Nun möchten Sie aber gerne anstelle der Koordinaten wissen, 
welche Adresse Sie gerade angeklickt haben. Das nächste Beispiel zeigt ihnen, 
wie Sie dies erreichen können.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;script src="esri-leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="esri-leaflet-geocoder.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 300px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.97264, 7.00469], 12);
 L.esri.basemapLayer('Gray').addTo(mymap);
*mymap.on('click', function(e){
*var r = L.marker();
*L.esri.Geocoding.reverseGeocode()
*.latlng(e.latlng)
*.run(function(error, result, response){
*mymap.removeLayer(r);
*r = L.marker(result.latlng)
*.addTo(mymap)
*.bindPopup(result.address.Match_addr)
*.openPopup();
 });
 });
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_936.html--&gt;</code></pre>
<p>Das haben wir gemacht? Wir haben veranlasst, dass immer zu dem Zeitpunkt, 
zu dem jemand auf die Karte klickt, eine umgekehrte Geocoding Suche gestartet wird. 
Genau habe wir dies mit dem Programmcode, der in der Funktion 
<code>mymap.on('click', function(e){}</code> 
ausgeführt wird, erreicht. Gleichzeitig wird ein Marker an der Position, 
die angeklickt wurde, erstellt. 
Das Ergebnis der Suche – also die gefundene Adresse – wird schlussendlich als Text 
in einem Pop-up zum Marker angezeigt.</p>
<p>Wie dieses Pop-up aussieht, können Sie sich in der nächsten Abbildung ansehen.</p>
<p><img src="../Images/936.png" alt="Nach Klick auf die Karte die passende Adresse ausgeben." /></p>
<p><em>Abbildung: Nach Klick auf die Karte die passende Adresse ausgeben.</em></p>
<p>Die Dokumentation zum ESRI Reverse Geocoding finden Sie unter der Internetadresse 
[<a href="http://esri.github.io/esri-leaflet/api-reference/tasks/reverse-geocode.html](http://esri.github.io/esri-leaflet/api-reference/tasks/reverse-geocode.html">http://esri.github.io/esri-leaflet/api-reference/tasks/reverse-geocode.html](http://esri.github.io/esri-leaflet/api-reference/tasks/reverse-geocode.html</a>]. </p>
<h3 id="feature-services">Feature Services</h3>
<p>Im vorletzten Kapitel haben wir mit dem 
<code>L.esri.dynamicMapLayer</code> Daten über einen Webservice geladen. 
Dabei wurden alle zur Verfügung stehenden Daten auf der Karte angezeigt. 
Das kann sehr unübersichtlich werden. Meist bietet ein Webservice große Datenmengen an. 
Sie möchten sicherlich nur die für Sie und Ihre Anwender relevanten Daten auf Ihrer 
Karte anzeigen. Eine Lösung für diese Aufgabe erarbeiten wir in diesem Kapitel.</p>
<p>In diesem Beispiel werden wir die 
<a href="https://esri.github.io/esri-leaflet/api-reference/layers/feature-layer.html">Klasse <code>L.esri.featureLayer</code></a> 
instanziieren. Vorher haben wir mit der 
Klasse <a href="https://esri.github.io/esri-leaflet/api-reference/layers/dynamic-map-layer.html"><code>L.esri.dynamicMapLayer</code></a> 
gearbeitet. Vielleicht fragen Sie sich nun, wie die beiden Klassen sich genau 
unterscheiden. 
ESRI erklärt dies wie folgt: Mit einem 
<a href="http://resources.arcgis.com/de/help/main/10.2/index.html#//0154000002w8000000">Feature-Service</a> 
können Sie Funktionen über das Internet bereitstellen. 
Mit dem <a href="http://resources.arcgis.com/de/help/main/10.2/index.html#//0154000002m7000000">Karten-Service</a> 
können Sie Karten im Web bereitstellen. 
Meiner Meinung nach ist ein <em>Feature Service</em> ein spezieller <em>Karten-Service</em> – 
denn ein Feature Service setzt eine Karte voraus.</p>
<blockquote>
<p>Interessieren Sie sich für die
technologische Entwicklung beim ESRI? Die wichtigsten Informationen
zur ArcGIS Plattform und zu ergänzenden Technologien können Sie auf
dem Blog GIS IQ – <a href="https://gis-iq.esri.de">https://gis-iq.esri.de/</a>
– mitverfolgen.</p>
</blockquote>
<h4 id="attribute">Attribute</h4>
<p>So, nun kommen wir zum praktischen Beispiel. Wir konfigurieren eine Abfrage zum 
Filtern von Daten. Konkret verwenden wir Daten zur Bodengeologie, deren Daten 
über die Adresse 
<a href="http://services.arcgis.com/OLiydejKCZTGhvWg/ArcGIS/rest/services/BodenGeologie/FeatureServer">http://services.arcgis.com/OLiydejKCZTGhvWg/ArcGIS/rest/services/BodenGeologie/FeatureServer</a> 
bereit gestellt werden.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="esri-leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
*&lt;select id="bodengeologieID"&gt;
*&lt;option value=""&gt;Reset&lt;/option&gt;
*&lt;option value="PARAMADOTXT='Saure regionalmetamorphe Gesteine'"&gt;Saure regionalmetamorphe Gesteine&lt;/option&gt;
*&lt;option value="PARAMADOTXT='fluvioglaziale Sedimente'"&gt;fluvioglaziale Sedimente&lt;/option&gt;
*&lt;option value="PARAMADOTXT='Kalkstein'"&gt;Kalkstein&lt;/option&gt;
*&lt;option value="PARAMADOTXT='Geschiebelehm/Geschiebemergel'"&gt;Geschiebelehm/Geschiebemergel&lt;/option&gt;
*&lt;option value="PARAMADOTXT='Mergel'"&gt;Mergel&lt;/option&gt;
*&lt;option value="PARAMADOTXT='Toniger Lehm'"&gt;Toniger Lehm&lt;/option&gt;
*&lt;option value="PARAMADOTXT='Tiefengesteine bzw. Plutonite'"&gt;Tiefengesteine bzw. Plutonite&lt;/option&gt;
*&lt;option value="PARAMADOTXT='keine Informationen'"&gt;keine Informationen&lt;/option&gt;
*&lt;option value="PARAMADOTXT='Basische bis ultrabasische vulkanischen Gesteine (Vulkanite)'"&gt;Basische bis ultrabasische vulkanischen Gesteine (Vulkanite)&lt;/option&gt;
*&lt;option value="PARAMADOTXT='Löss'"&gt;Löss&lt;/option&gt;
*&lt;option value="PARAMADOTXT='Residualton'"&gt;Residualton&lt;/option&gt;
*&lt;option value="PARAMADOTXT='Fluviale Tone, Schluffe und Lehme'"&gt;Fluviale Tone, Schluffe und Lehme&lt;/option&gt;
*&lt;option value="PARAMADOTXT='Sandstein'"&gt;Sandstein&lt;/option&gt;
*&lt;option value="PARAMADOTXT='Sande der Flussterrassen'"&gt;Sande der Flussterrassen&lt;/option&gt;
*&lt;option value="PARAMADOTXT='Tonstein'"&gt;Tonstein&lt;/option&gt;
*&lt;option value="PARAMADOTXT='Steiniger Lehm'"&gt;Steiniger Lehm&lt;/option&gt;
*&lt;option value="PARAMADOTXT='Residuallehm'"&gt;Residuallehm&lt;/option&gt;
*&lt;option value="PARAMADOTXT='Schiefer'"&gt;Schiefer&lt;/option&gt;
*&lt;/select&gt;
 &lt;div style="height: 700px" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.27264, 7.26469], 12);
 L.esri.basemapLayer('Gray').addTo(mymap);
*var url = 
*'http://services.arcgis.com/OLiydejKCZTGhvWg/ArcGIS/rest/services/BodenGeologie/FeatureServer/0';
*var bodengeologie = document.getElementById('bodengeologieID');
*var bodengeologieLayer  = L.esri.featureLayer({
*url: url
*}).addTo(mymap);
*var popupTemplate = "&lt;h3&gt;Details:&lt;/h3&gt;\n\
*PARAMADOTXT: {PARAMADOTXT}&lt;br&gt;";
*bodengeologieLayer.bindPopup(function (layer){
*return L.Util.template(popupTemplate, layer.feature.properties)
*});
*bodengeologie.addEventListener('change', function(){
*bodengeologieLayer.setWhere(bodengeologie.value);
*});
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_935.html--&gt;</code></pre>
<p>Was macht der Programmcode in diesem Beispiel konkret. 
Zunächst wird mit dem Befehl 
<code>var bodengeologieLayer = L.esri.featureLayer({ url: url }).addTo(mymap);</code> ein 
<code>L.esri.featureLayer</code> Objekt erstellt und dieses zur Karte hinzugefügt. 
Der nächste Schritt ist das Filtern der Daten. 
Dies erreichen wir mit der Zeile <code>bodengeologieLayer.</code><strong><code>setWhere</code></strong><code>(bodengeologie.value);</code>.</p>
<p>Das Ergebnis sehen Sie in der nächsten Abbildung. 
Wenn Sie in der Auswahlliste den Eintrag <em>Schiefer</em> auswählen, 
werden nur die Regionen in denen Schiefer vorkommt, auf der Karte als Bereich angezeigt.</p>
<p><img src="../Images/935a.png" alt="Karte zur Veranschaulichung der Bodengeologie mithilfe eines [Feature Layer Service](https://esri.github.io/esri-leaflet/api-reference/services/feature-layer-service.html)." /></p>
<p><em>Abbildung: Karte zur Veranschaulichung der Bodengeologie mithilfe eines <a href="https://esri.github.io/esri-leaflet/api-reference/services/feature-layer-service.html">Feature Layer Service</a>.</em></p>
<h4 id="abstand-visualisieren">Abstand visualisieren</h4>
<p>Ein weiteres Merkmal, das auf Landkarten oft wichtig ist, 
ist die Entfernung zu einem Punkt. Oft möchte man gerne wissen, 
welche Objekte sich innerhalb eines bestimmten Abstands zu einer 
bestimmten Koordinate befinden. Diese Fragestellung beantwortet das nächste Beispiel.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html lang="de"&gt;
 &lt;head&gt;
 &lt;meta charset="utf-8"/&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="esri-leaflet.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid', {}).setView([50.27264, 7.26469], 12);
 L.esri.basemapLayer('Gray').addTo(mymap);
 var url = 'http://services.arcgis.com/OLiydejKCZTGhvWg/ArcGIS/rest/services/BodenGeologie/FeatureServer/0';
 var bodengeologie = document.getElementById('bodengeologieID');
 var bodengeologieLayer  = L.esri.featureLayer({
 url: url
 }).addTo(mymap);
*var nearbyIds = [];
*mymap.on('click', function(e){
*bodengeologieLayer.query().nearby(e.latlng, 5000).ids(function(error, ids){
*for (var j = 0; j &lt; nearbyIds.length; j++) {
*bodengeologieLayer.setFeatureStyle(nearbyIds[j],{
*color: '#3388FF',
*}
*);
*}
*nearbyIds = ids;
*for (var i = 0; i &lt; ids.length; i++) {
*bodengeologieLayer.setFeatureStyle(ids[i], {
*color: '#BA454E',
*});
*}
*});
*});
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_934.html--&gt;</code></pre>
<p>Was passiert hier? 
Zunächst werden im Beispiel Bodengeologien mithilfe des Objektes 
<code>L.esri.featureLayer</code> zur Karte hinzugefügt. 
Soweit gibt es keinen Unterschied zum vorherigen Beispiel. 
Danach rufen wir die Funktion <code>nearby()</code> des 
<a href="https://esri.github.io/esri-leaflet/api-reference/tasks/query.html">Objektes <code>L.esri.Query()</code></a> 
für jeden Marker auf. 
Alle die Marker, die sich in einem Abstand von 5000 Metern befinden, 
werden im Anschluss rot (#BA454E) gefärbt. Alle anderen bekommen die Farbe Blau (#3388FF);</p>
<p>Das Ergebnis sehen Sie im nächsten Bild. 
Sobald Sie einen Punkt auf der Karte anklicken, werden alle Geologien im Abstand 
von 5000 Metern um die angeklickte Stelle rot hervorgehoben.</p>
<p><img src="../Images/935b.png" alt="Karte zur Veranschaulichung der Bodengeologie mithilfe eines [Feature Layer Service](https://esri.github.io/esri-leaflet/api-reference/services/feature-layer-service.html)." /></p>
<p><em>Abbildung: Karte zur Veranschaulichung der Bodengeologie mithilfe eines <a href="https://esri.github.io/esri-leaflet/api-reference/services/feature-layer-service.html">Feature Layer Service</a>. Außerdem werden per Klick die Bodengeologien die in einem bestimmten Abstand zur angeklickten Position liegen farblich hervorgehoben.</em></p>
<h2 id="diesem-kapitel-haben-wir">In diesem Kapitel haben wir …</h2>
<p>In diesem Teil haben wir uns als erstes die Karten, 
die ESRI anbietet, angesehen. 
Danach haben wir mit einem Shapefile gearbeitet und ESRI Webservices genutzt. 
Sie wissen nun was ein <code>L.esri.DynamicMapLayer,</code> 
was Geocoding und was ein <code>L.esri.FeatureLayer</code> ist.</p><h1 id="routing">Routing</h1>
<p><a href="#" id="Routing"></a></p>
<p>Last, but not least möchte ich Ihnen ein 
Routing Plugin vorstellen, nämlich die 
<a href="https://github.com/perliedman/leaflet-routing-machine">Leaflet Routing Machine</a> 
von Per Liedmann.</p>
<blockquote>
<p>Auch das ESRI bietet ein Routing Plugin. Jede Leaflet Erweiterung hat 
ihre Vorteile und ihre Nachteile. Falls Sie die Routing Version des
Environmental Systems Research Institute ESRI einsetzen möchten,
finden Sie alle Informationen hierfür unter der Adresse
<a href="https://github.com/jgravois/lrm-esri">https://github.com/jgravois/lrm-esri</a>.</p>
</blockquote>
<h2 id="diesem-kapitel-werden-wir">In diesem Kapitel werden wir …</h2>
<p>Als erstes sehen wir uns kurz an, was sich hinter dem Begriff Routing versteckt. 
Danach werden wir das Plugin Leaflet Routing Machine in unsere Leaflet Karte integrieren. 
Dieses Plugin stellt zwei Textfelder zur Eingabe von Adressen zur Verfügung und berechnet 
auf Anforderung eine Route zwischen diesen beiden Adressen. 
Im weiteren Verlauf nutzen wir Optionen, um die Routenberechnung flexibler und 
benutzerfreundlicher zu machen.</p>
<h2 id="allgemeines-zum-thema-routing">Allgemeines zum Thema Routing…</h2>
<p>Fangen wir von vorne an. Es ist nämlich meiner Meinung nach auch spannend, 
einmal etwas über den Tellerrand zu blicken. Reicht es Ihnen, wenn sie zwei 
Adressen eingeben könnten und einen Weg zwischen diesen beiden Adressen als Ergebnis 
ausgegeben bekommen? Oder, möchten Sie auch etwas genauer wissen, 
was sich hinter dem Begriff Routing verbirgt? Wenn ersteres auf Sie zutrifft, 
dann lesen Sie am besten im nächsten Kapitel weiter. 
Ansonsten ist meine kurze Zusammenfassung hier im Kapitel vielleicht interessant für Sie.</p>
<p>Auch wenn die vielen Informationen auf einer Karte komplex erscheinen: 
Das Berechnen einer Route kann von einer Software oder einem Dienst effizient 
durchgeführt werden. Dazu müssen die Daten der Karte, auf der die 
Berechnung ausgeführt werden soll, bestimmte Informationen enthalten. 
Die Daten von OpenStreetMap beinhalten Informationen, 
um Routen für verschiedene Profile berechnen zu können. 
Eine Route kann zum Beispiel für die Nutzung eines Autos oder eines Fahrrads 
unterschiedlich berechnet werden. Auch Optionen wie<br />
<em>'zu Fuß'</em>  oder  <em>'mit dem Pferd'</em>  sind mit OpenStreetMap Daten möglich.</p>
<p>Damit die Software zur Routenberechnung fehlerfrei funktioniert, 
müssen diese Daten qualitativ gut sein. Das bedeutet, 
dass Linien – also zum Beispiel Straßen – die verbunden sein sollen, 
auch wirklich verbunden sind. Umgekehrt dürfen Straßen, die sich auf 
verschieden Ebenen kreuzen - zum Beispiel bei Brücken oder Tunneln, nicht verbunden sein. 
Das bedeutet auch, dass Poller oder Absperrpfosten, an denen kein Auto vorbeikommt, 
auch als solche eingezeichnet sind. Ganz wichtig ist es, dass Abbiegeverbote 
an Kreuzungen auf der Karte klar gekennzeichnet sind. 
Wie OpenStreetMap das macht, können Sie unter anderem auf der Website 
<a href="https://wiki.openstreetmap.org/w/index.php?title=OSM_tags_for_routing&amp;oldid=1214478">https://wiki.openstreetmap.org/w/index.php?title=OSM_tags_for_routing</a> 
nachlesen.</p>
<p>Um bei der Routen-Berechnung die schnellste Route bestimmen zu können, 
sind Geschwindigkeitsangaben notwendig. OpenStreetMap speichert für jede 
Straße den Standardhöchstwert für deutsche Straßen. 
Dieser Standardwerte kann jedoch für bestimmte Straßen anders sein. 
In diesem Fall ist es notwendig, dass beim Erstellung des Straßen-Objektes 
die zulässige Höchstgeschwindigkeit hinzufügt wird. 
Dies geschieht mit einer speziellen Eigenschaft oder mit einem speziellen Tag. 
Nebenbei haben auch andere Faktoren, wie Kurven, Steigungen oder Straßenbelag 
einen Einfluss auf die Geschwindigkeit – und dieser ist je nach Profil noch 
einmal unterschiedlich. Eine Steigung verringert die Geschwindigkeit 
eines Fahrrades stärker, als die eines Autos. 
Dafür wird der Fußgänger in Kurven nicht so viel an Geschwindigkeit verlieren 
wie ein Fahrrad.</p>
<p>Aber auch dann, wenn die Kartendaten sehr gut und fehlerfrei sind, 
ist es nicht trivial die ideale Software zur Routen-Berechnung zu erstellen. 
Hinzu kommen nämlich noch die Besonderheiten des Personenkreises, 
für den die Route erstellt werden soll. Welche Wege sollen für Radfahrer 
berücksichtigt werden? Es gibt Radfahrer, die nicht gerne durch die Stadt 
fahren sondern lieber im Wald unterwegs ist. Andere ziehen eine asphaltierte 
Straße mitten durch die Stadt einem matschigen Feldweg vor. 
Wie wählen wir die beste Strecke für einen Radfahrer, der überwiegend bei Dunkelheit 
trainiert? Oft kommt es sicher auch vor, dass eine Radtour geplant wird, 
bei der so viele Sehenswürdigkeiten wie möglich unmittelbar am Weg liegen sollten. </p>
<p><strong>Sie erkennen</strong>: Die Berechnung einer optimalen Route ist etwas sehr Individuelles!</p>
<p>Sehen wir uns also an inwieweit die Dienste, die das Plugin Leaflet Routing Machine nutzt, 
diese Anforderungen erfüllt.</p>
<h2 id="leaflet-routing-maching">Leaflet Routing Maching</h2>
<p>Nachfolgende finden Sie das erste Beispiel für diesen Themenbereich.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="leaflet-routing-machine.js"&gt;&lt;/script&gt;
*&lt;link rel="stylesheet" href="leaflet-routing-machine.css" /&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 13);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var control = L.Routing.control({
*waypoints: [
*L.latLng(50.273543, 7.262993),
*L.latLng(50.281168, 7.276211)
*],
*}).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_932a.html--&gt;</code></pre>
<p>Was haben wir genau gemacht? Zunächst einmal haben wir die für die Verwendung der 
<a href="http://www.liedman.net/leaflet-routing-machine">Leaflet Routing Machine</a> 
erforderlichen Dateien eingebunden. Verantwortlich hierfür sind die Zeilen</p>
<pre><code>&lt;script src="leaflet-routing-machine.js"&gt;&lt;/script&gt;
&lt;link rel="stylesheet" href="leaflet-routing-machine.css"/&gt;</code></pre>
<p>Die aktuellen Dateien zum Plugin finden Sie unter der 
Adresse <a href="https://github.com/perliedman/leaflet-routing-machine/releases">https://github.com/perliedman/leaflet-routing-machine/releases</a>. 
Als nächstes haben wir mit dem Textblock</p>
<pre><code>var control = L.Routing.control({
waypoints: [
L.latLng(50.273543, 7.262993),
L.latLng(50.281168, 7.276211)
],
}).addTo(mymap);</code></pre>
<p>ein <code>L.Routing.control</code> erstellt und dieses zur Karte hinzugefügt. 
Die Koordinaten, zwischen denen eine Route berechnet werden soll, 
haben wir mit der Option <code>waypoints</code> an das Control übergeben. </p>
<p>Sie können einen Router, also eine Software, 
die die Route berechnen soll, mit dem Eintrag 
<code>router: L.Routing.mapbox('pk.ihrkey')</code> 
festgelegt. Für die Nutzung des Mapbox Routers benötigen Sie ein 
Zugriffstoken. Dieses können Sie unter der Adresse 
<a href="https://www.mapbox.com/api-documentation/#access-tokens">https://www.mapbox.com/api-documentation/#access-tokens</a> 
anfordern. 
In dieser Dokumentation finden Sie auch weitere Informationen 
zum Router und zu den Lizenzbedingungen. Im nächsten Programmcodeblock habe ich 
das vorhergehende Beispiel so abgeändert, dass der Router von Mapbox angewendet wird.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
 &lt;script src="leaflet-routing-machine.js"&gt;&lt;/script&gt;
 &lt;link rel="stylesheet" href="leaflet-routing-machine.css" /&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 13);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
 var control = L.Routing.control({
 waypoints: [
 L.latLng(50.273543, 7.262993),
 L.latLng(50.281168, 7.276211)
 ],
*router: L.Routing.mapbox('pk.IhrKey')
 }).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_932b.html--&gt;</code></pre>
<blockquote>
<p>Wenn Sie die Option <code>router</code> nicht belegen, 
wird standardmäßig die Open Source Routing Machine –
<a href="http://project-osrm.org">http://project-osrm.org</a> –
genutzt. Für diesen freien Router benötigen Sie kein Zugriffstoken.
Leider ist dieser aber nicht so zuverlässig wie Mapbox. 
Bedenken Sie, es handelt sich um eine Demoversion, die Sie frei nutzen können 
und einem geschenkten Gaul schaut man schließlich nicht ins Maul! </p>
</blockquote>
<p>Die nächste Abbildung zeigt Ihnen unseren bisherigen Stand. 
Die Route wird berechnet und im rechten oberen Teil angezeigt. 
Anders als gewünscht werden Sie aber über eine Straße, auf der viele Autos fahren, geführt. 
Dabei möchten Sie gerne wandern. Außerdem sind die Texte in englischer Sprache. 
Das geht sicher besser!</p>
<p><img src="../Images/927.png" alt="Eine Karte auf der eine Route angezeigt wird." /></p>
<p><em>Abbildung: Eine Karte auf der eine Route angezeigt wird.</em></p>
<h2 id="options">Options</h2>
<p><a href="#" id="leafletroutingmachineoptions"></a></p>
<p>Der nächste Programmcode zeigt Ihnen am Beispiel von  Mapbox, 
wie Sie die Sprache und das Routing Profil verändern können.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="leaflet-routing-machine.js"&gt;&lt;/script&gt;
*&lt;link rel="stylesheet" href="leaflet-routing-machine.css" /&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 13);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var control = L.Routing.control({
*waypoints: [
*L.latLng(50.273543, 7.262993),
*L.latLng(50.281168, 7.276211)
*],
*router: L.Routing.mapbox('pk.IhrKey',
*{
*profile: 'mapbox/walking',
*language: 'de'
*}),
*}).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_931b.html--&gt;</code></pre>
<p>Der Mapbox Router bietet Ihnen unter anderem die Optionen 
<code>profil</code> und <code>language</code>. 
Die Namen sagen es schon aus. Als 
<a href="https://www.mapbox.com/api-documentation/#retrieve-directions">Profil</a> 
können Sie einstellen, ob Sie wandern, radeln oder lieber 
mit dem Auto fahren möchten. 
Die Option <a href="https://www.mapbox.com/api-documentation/#instructions-languages">language</a> 
bietet Ihnen eine Menge unterschiedlicher Sprachen. 
Möchten Sie noch etwas anderes ändern? 
Die Dokumentation zum Router von Mapbox finden Sie unter der Adresse 
<a href="https://www.mapbox.com/api-documentation/#introduction">https://www.mapbox.com/api-documentation/#introduction</a>.</p>
<blockquote>
<p>Wenn Sie lieber eine andere Software zur
Berechnung der Route nutzen möchten, können Sie dies tun. Die
Leaflet Routing Machine bietet Ihnen viele Möglichkeiten. Weitere
Informationen, Demos und Tutorials zur Leaflet Routing Machine finden
Sie auf der Website: 
<a href="http://www.liedman.net/leaflet-routing-machine">http://www.liedman.net/leaflet-routing-machine</a>.</p>
</blockquote>
<p>Auch der Router des Projektes <a href="http://project-osrm.org">http://project-osrm.org</a> bietet 
Ihnen Optionen. Soweit ich weiß, kann auf dem Demoserver aber nur das Profil 
<code>driving</code> genutzt werden. Aber die Sprache können Sie benutzerdefiniert anpassen. 
Wie dies geht zeigt Ihnen das nächste Beispiel.</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="leaflet-routing-machine.js"&gt;&lt;/script&gt;
 &lt;link rel="stylesheet" href="leaflet-routing-machine.css" /&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 13);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var control = L.Routing.control({
*waypoints: [
*L.latLng(50.273543, 7.262993),
*L.latLng(50.281168, 7.276211)
*],
*router: new L.Routing.OSRMv1(
*{
*language: 'de',
*}
*)
*}).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_931.html--&gt;</code></pre>
<blockquote>
<p>Sie können die URL, von der die Route abgefragt wird, auch direkt eingeben. Im Falle von 
<a href="http://project-osrm.org">http://project-osrm.org</a> könnte dies wie folgt aussehen:
<a href="https://router.project-osrm.org/route/v1/driving/7.262993,50.273543;7.276211,50.281168">https://router.project-osrm.org/route/v1/driving/7.262993,50.273543;7.276211,50.281168</a>. 
<img src="../Images/926a.png" alt="Direkter Aufruf OSRM-Server." />
<em>Abbildung: Direkter erfolgreichewr Aufruf OSRM-Server.</em><br />
Falls Ihnen die Meldung <em>'Too Many Requests'</em> angezeigt wird, müssen Sie nichts falsch gemacht haben. 
In dem Fall ist der Server gerade überlastet. Versuchen Sie es einfach später noch einmal.
<img src="../Images/926b.png" alt="Direkter Aufruf OSRM-Server." />
<em>Abbildung: Direkter fehlerhafter Aufruf OSRM-Server.</em></p>
</blockquote>
<p>Im nächsten Bild sehen Sie, dass das Routing im Mapbox Beispiel 
nun eher zu einem Wanderer 
passt und die Texte sind auch in deutscher Sprache. 
Das ist schon einmal gut. 
Aber es geht ja meist noch besser. </p>
<p><img src="../Images/926.png" alt="Eine Karte auf der eine Route für Wanderer in deutscher Sprache angezeigt wird." /></p>
<p><em>Abbildung: Eine Karte auf der eine Route für Wanderer in deutscher Sprache angezeigt wird.</em></p>
<p>Wahrscheinlich möchten Sie, dass die Adressen, zwischen denen geroutet wird, 
variabel auf der Karte verändert werden können. 
Genau das wollte ich als nächstes umsetzen 
und deshalb habe ich dies im nächsten Beispiel auch gemacht.</p>
<h2 id="geocoding-und-routing">Geocoding und Routing</h2>
<p><a href="#" id="inleafletroutingmachninegeocoding"></a></p>
<p>Bisher wurde die Route ausschließlich anhand von Koordinaten berechnet. 
Menschen nutzen aber lieber Texte in Form von Adressen. 
Das Sie mithilfe von Geocoding Adressen in Koordinaten verwandelt können – 
beziehungsweise Koordinaten in Adressen verwandeln  können – 
haben Sie im Kapitel <a href="#ingeocoding">Geocoding ESRI</a> schon lesen können. 
Hier im Beispiel kombinieren wir nun Routing und Geocoding. Sehen Sie selbst:</p>
<pre><code> &lt;!DOCTYPE HTML&gt;
 &lt;html&gt;
 &lt;head&gt;
 &lt;title&gt;Eine OSM Karte mit Leaflet&lt;/title&gt;
 &lt;link rel="stylesheet" href="../leaflet/leaflet.css" /&gt;
 &lt;script src="../leaflet/leaflet.js"&gt;&lt;/script&gt;
*&lt;script src="leaflet-routing-machine.js"&gt;&lt;/script&gt;
*&lt;script src="Control.Geocoder.js"&gt;&lt;/script&gt;
*&lt;link rel="stylesheet" href="Control.Geocoder.css" /&gt;
*&lt;link rel="stylesheet" href="leaflet-routing-machine.css" /&gt;
 &lt;/head&gt;
 &lt;body&gt;
 &lt;div style="height: 700px;" id="mapid"&gt;&lt;/div&gt;
 &lt;script&gt;
 var mymap = L.map('mapid').setView([50.27264, 7.26469], 13);
 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(mymap);
*var control = L.Routing.control({
*waypoints: [
*L.latLng(50.273543, 7.262993),
*L.latLng(50.281168, 7.276211)
*],
*router: L.Routing.mapbox('pk.IhrKey',
*{
*language: 'de'
*}),
*geocoder: L.Control.Geocoder.nominatim({})
*}).addTo(mymap);
 &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
&lt;!--index_930.html--&gt;</code></pre>
<p>In diesem Beispiel haben wir das vorhergehende Beispiel mit dem 
Plugin <a href="https://github.com/perliedman/leaflet-control-geocoder">Geocoder Control</a> 
erweitert. Konkret haben wir mithilfe der Zeilen</p>
<pre><code>&lt;script src="Control.Geocoder.js"&gt;&lt;/script&gt;
&lt;link rel="stylesheet" href="Control.Geocoder.css"/&gt;</code></pre>
<p>die Skript-Datei und die CSS-Datei des 
<a href="https://github.com/perliedman/leaflet-control-geocoder">Geocoder Control</a> 
von Per Liedmann eingebunden. 
Die aktuellste Version dieses Plugins können Sie unter der 
Adresse <a href="https://github.com/perliedman/leaflet-control-geocoder/releases">https://github.com/perliedman/leaflet-control-geocoder/releases</a> 
herunterladen. 
Danach haben wir die Option <code>geocoder</code> des Plugins Leaflet Routing Machine mit dem 
Wert <code>L.Control.Geocoder.nominatim({})</code> belegt. 
Und das war es schon!  </p>
<p>Als Ergebnis sehen Sie nun zwei Textfelder im oberen rechten Bereich auf Ihrer Karte. 
In diese können Sie Adressen eingeben und so Ihre Route benutzerfreundlich abändern.</p>
<p><img src="../Images/925.png" alt="Eine Karte auf der eine Route angezeigt wird." /></p>
<p><em>Abbildung: Eine Karte auf der eine Route angezeigt wird. Sie können die Route ändern, indem Sie eine Adresse in einem der Textfelder rechts oben eingeben.</em></p>
<h2 id="diesem-kapitel-haben-wir">In diesem Kapitel haben wir ...</h2>
<p>Gegenstand dieses Kapitels war Routing. 
Wir haben uns kurz angesehen, was Kartendaten bieten müssen, 
um die Berechnung einer Route zu ermöglichen. 
Dass die Kartendaten aber nicht alles sind und eine Route etwas sehr 
Individuelles sein kann, wurde dabei auch klar. 
Danach haben wir das Plugin Leaflet Routing Machine in unsere 
Leaflet Karte integriert und mithilfe von Optionen und Geocoding 
flexibler und benutzerfreundlicher gemacht.</p><h1 id="auf-wiedersehen">Auf Wiedersehen</h1>
<p>Ich hoffe, dass Ihnen der Rundgang durch LeafletJs gefallen hat und Sie jede 
Menge für sich mitnehmen konnten.</p></html>